<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:xt="http://ns.inria.org/xtiger" xml:lang="en">
<head>                  
  <!-- Use UTF-8 and avoid the xml protocol declaration at the top for Internet Explorer -->
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=8;" />   
  <meta name="description" content="XTiger XML document template" />
  <meta name="keywords" content="template, XTiger" />

  <title>XTiger XML and AXEL Interactive (GUI) test case : 'date' primitive editor plugin</title>
  
  <xt:head version="1.1" templateVersion="1.0" label="TestCase">   
  </xt:head>

  <link rel="stylesheet" href="../../3rd-part/jquery/css/ui-lightness/jquery-ui-1.8.18.custom.css" type="text/css" charset="utf-8" />
  <script src="../../3rd-part/jquery/js/jquery-1.7.1.min.js" type="text/javascript"></script> -->
  <script src="../../3rd-part/jquery/js/jquery-ui-1.8.18.custom.min.js" type="text/javascript"></script>

  <link rel="stylesheet" href="../../axel/axel.css" type="text/css"></link>
  <script type="text/javascript" src="../../axel/axel.js"></script>
  <script type="text/javascript" src="../../src/filters/date.js"></script>
  <script type="text/javascript" src="/Users/stephane/Home/dev/axel-forms/templates/aws.js"></script>
  <script src="/Users/stephane/Home/apps/exist-1.4.1-dev/webapp/projets/oppidum/resources/lib/moreaxel/event.js"></script>

  <script type="text/javascript">
    var form;
    var dates;
    function noLaterThanToday(value) {
      return isNaN(new Date(value).getDay()) ? $.datepicker.formatDate('dd/mm/yy', new Date()) : value;
    }
    function init() {
      var today;
      form = new xtiger.util.Form('../../axel/bundles');
      form.setTemplateSource(document);
      form.enableTabGroupNavigation();
      if (! form.transform()) { 
        alert(this .form.msg); 
      } else {
        today = $.datepicker.formatDate('dd/mm/yy', new Date())
        dates = xray('#minmax-test');
        dates.get(0).configure('maxDate', today);
        dates.get(1).configure('maxDate', today);
        // FIXME: plugin API with dump() to get data ?
        $('#minmax-test > .from').bind('axel-update', 
          function(ev, editor) { dates.get(1).configure('minDate', editor._data); });
        $('#minmax-test > .to').bind('axel-update', 
          function(ev, editor) { dates.get(0).configure('maxDate', noLaterThanToday(editor._data)); });
      }
    }
    xtdom.addEventListener(window,  'load', init, false);
  </script>

  <!-- Template styling -->
  <style type="text/css">
    p.explic {
      font-size: 90%;
    }
    .avertissement {
      color: green;
    }
  </style>

</head>
<body>
  
<h1>Interactive (GUI) test case for <tt>'date'</tt> editor</h1>

<h2><xt:use types="text" label="Title">Click to edit a page title</xt:use></h2> 

<!-- Test Case 1 -->

<h3>Click to edit the date, the first time it should be set to the current date</h3>

<p>Check the calendar region is 'fr' and format is 'ISO_8601'</p>

<p>Date : <xt:use types="text" param="filter=date;date_region=fr;date_format=ISO_8601" label="Date"/></p>

<!-- Test Case 2 -->

<h3>Select and click to edit the optional date, it should not be editable while not selected</h3>

<p>Check the calendar region is 'en'  and format is 'RSS'</p>

<p>Date : <xt:use types="text"  param="filter=date;date_region=en;date_format=RSS" label="Date" option="unset"/></p>

<!-- Test Case 3 -->

<h3>Click on the plus icon to create and edit a list of dates</h3>

<p>List of dates : </p>

<ul>
  <xt:repeat minOccurs="0" maxOccurs="*" label="Dates">
    <li class="date"><xt:menu-marker/><xt:use types="text" param="filter=date" label="Date"/></li>
  </xt:repeat>
</ul>

<!-- Test Case 4 -->

<h3>Click to edit the date, the first time it should be set to the current date</h3>

<p>Check calendars are constrained to select a date range.</p>

<p id="minmax-test">From : <span class="from"><xt:use types="text" param="filter=date event;date_region=fr;date_format=ISO_8601" label="From"/></span> to <span class="to"><xt:use types="text" param="filter=date event;date_region=fr;date_format=ISO_8601" label="To"/></span></p>

<p>End of the test</p>
</body> 
</html>
