/* ***** BEGIN LICENSE BLOCK *****
 *
 * Copyright (C) 2009-2012  Stéphane Sire
 *
 * This file contains files from the Adaptable XML Editing Library (AXEL)
 * Version 1.3.0 (Rev git rep)
 *
 * Adaptable XML Editing Library (AXEL) is free software ; you can redistribute it 
 * and/or modify it under the terms of the GNU Lesser General Public License (the "LGPL")
 * as published by the Free Software Foundation ; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * The library is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY ; 
 * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR 
 * PURPOSE. See the GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this library ; 
 * if not, write to the Free Software Foundation, Inc., 59 Temple Place, Suite 330, 
 * Boston, MA 02111-1307 USA.
 *
 * Web site : http://media.epfl.ch/Templates/
 * 
 * Contributors(s) : Stephane Sire, Antoine Yersin, Jonathan Wafellmann, Useful Web Sàrl 
 * 
 * ***** END LICENSE BLOCK ***** */
 if(typeof xtiger=="undefined"||!xtiger){var xtiger={};xtiger.COMPONENT=1;xtiger.REPEAT=2;xtiger.USE=3;xtiger.BAG=4;xtiger.ATTRIBUTE=5;xtiger.UNKNOWN=-1}xtiger.parser={};xtiger.editor={};xtiger.cross={};xtiger.util={};if(typeof xtdom=="undefined"||!xtdom){xtdom={}}xtiger.util.Session=function(){this.store={}};xtiger.util.Session.prototype={save:function(c,b){this.store[c]=b},load:function(b){return this.store[b]}};xtiger.session=function(b){if(!b._xtigerSession){b._xtigerSession=new xtiger.util.Session()}return b._xtigerSession};xtiger.util.Resources=function(){this.bundles={};xtiger.bundles={}};xtiger.util.Resources.prototype={_mountBundle:function(d,g){var b=this.bundles[d];var e=xtiger.bundles[d];for(var c in b){e[c]=g+d+"/"+b[c]}},addBundle:function(d,b){this.bundles[d]=b;xtiger.bundles[d]={};for(var c in b){xtiger.bundles[d][c]=b[c]}},setBase:function(b){if(b.charAt(b.length-1)!="/"){b=b+"/"}for(var c in this.bundles){this._mountBundle(c,b)}}};xtiger.resources=new xtiger.util.Resources();xtiger.util.FactoryRegistry=function(){this.store={}};xtiger.util.FactoryRegistry.prototype={registerFactory:function(c,b){if(this.store[c]){alert("Error (AXEL) attempt to register an already registered factory : '"+c+"' !")}else{this.store[c]=b}},getFactoryFor:function(b){if(!this.store[b]){alert("Fatal Error (AXEL) unkown factory required : '"+b+"' \nYour editor will NOT be generated !")}else{return this.store[b]}}};xtiger.registry=new xtiger.util.FactoryRegistry();xtiger.factory=function(b){return xtiger.registry.getFactoryFor(b)};xtdom.counterId=0;xtdom.genId=function(){return xtdom.counterId++};xtdom.createTextNode=function(b,c){return b.createTextNode(c)};xtdom.hasAttribute=function(c,b){return c.hasAttribute(b)};xtdom.removeElement=function(b){var c=b.parentNode;if(!c){return}c.removeChild(b)};xtdom.containsXT=function(c){if(c.nodeType==xtdom.ELEMENT_NODE){if(xtdom.isXT(c)){return true}else{if(c.childNodes&&c.childNodes.length>0){for(var b=0;b<c.childNodes.length;b++){if(xtdom.containsXT(c.childNodes[b])){return true}}}}}return false};xtdom.getMenuMarkerXT=function(g,e){var h,d,c=false;var b=xtdom.getElementsByTagNameXT(g,"menu-marker");if(b.length>0){for(d=0;d<b.length;d++){h=b.item(d);if(((e===undefined)&&(!xtdom.hasAttribute(h,"target")))||(h.getAttribute("target")===e)){c=h;break}}}return c};xtdom.getTagNameXT=function(c){var b=(xtiger.ATTRIBUTE==xtdom.getNodeTypeXT(c))?"name":"label";return c.getAttribute(b)};xtdom.extractDefaultContentXT=function(c){var d;if(xtiger.ATTRIBUTE==xtdom.getNodeTypeXT(c)){d=c.getAttribute("default")}else{if(c.childNodes){for(var b=0;b<c.childNodes.length;b++){var g;var e=c.childNodes[b];if(e.nodeType==xtdom.ELEMENT_NODE){g=e.innerHTML}else{g=e.nodeValue}if(d){d+=g}else{d=g}}}}if(d&&(-1===d.search(/\S/))){d=null}return d};xtdom.getFirstElementChildOf=function(d){var c;for(var b=0;b<d.childNodes.length;b++){if(d.childNodes[b].nodeType==xtdom.ELEMENT_NODE){c=d.childNodes[b];break}}return c};xtdom.moveNodesAfter=function(b,d){var e;if(d.nextSibling){var c=d.nextSibling;while(e=b.shift()){c.parentNode.insertBefore(e,c)}}else{while(e=b.shift()){d.parentNode.appendChild(e)}}};xtdom.moveChildrenOfAfter=function(d,c){var e;if(c.nextSibling){var b=c.nextSibling;while(e=d.firstChild){d.removeChild(e);b.parentNode.insertBefore(e,b)}}else{while(e=d.firstChild){d.removeChild(e);c.parentNode.appendChild(e)}}};xtdom.importChildOfInto=function(c,d,g){for(var b=0;b<d.childNodes.length;b++){var e=d.childNodes[b];var h=xtdom.importNode(c,d.childNodes[b],true);g.appendChild(h)}};xtdom.replaceNodeByChildOf=function(d,b,e){var c=d.parentNode;var g;while(g=b.firstChild){b.removeChild(g);c.insertBefore(g,d,true);if(e){e.push(g)}}c.removeChild(d)};xtdom.removeChildrenOf=function(b){b.innerHTML=""};xtdom.moveChildOfInto=function(c,b,d){var e;while(e=c.firstChild){c.removeChild(e);b.appendChild(e);if(d){d.push(e)}}};xtdom.getInlineDisplay=function(b){var c="";if((b.style)&&(b.style.display)){c=b.style.display}return c};xtdom.getSelectedOpt=function(c){for(var b=0;b<c.options.length;b++){if(c.options[b].selected){break}}return b};xtdom.setSelectedOpt=function(c,b){c.selectedIndex=b};xtdom.addClassName=function(c,b){if(c.className){if(c.className.search(b)==-1){if(c.className.length==0){c.className=b}else{c.className+=" "+b}}}else{c.className=b}};xtdom.removeClassName=function(d,c){if(d.className){var b=d.className.search(c);if(b!=-1){d.className=d.className.substr(0,b)+d.className.substr(b+c.length)}}};xtdom.replaceClassNameBy=function(e,b,c){var d=e.className.search(b);if(d!=-1){e.className=e.className.substr(0,d)+c+e.className.substr(d+b.length)}else{xtdom.addClassName(e,c)}};xtdom.getComputedStyle=function(b,c){if(!b||!b.ownerDocument){return null}var d=b.ownerDocument;if(window.getComputedStyle){return window.getComputedStyle(b,null).getPropertyValue(c)}else{if(b.currentStyle){c=c.replace(/\-(\w)/g,function(e,g){return g.toUpperCase()});return b.currentStyle[c]}}return null};xtdom.findPos=function(c){var d=curtop=0;if(c.offsetParent){d=c.offsetLeft;curtop=c.offsetTop;if(document.defaultView){var b=document.defaultView.getComputedStyle(c,null).getPropertyValue("position")}else{if(document.uniqueID){var b=c.currentStyle.position}}if(c.scrollTop&&(b=="absolute")){curtop-=c.scrollTop}if(c.scrollLeft&&(b=="absolute")){d-=c.scrollLeft}while(c=c.offsetParent){d+=c.offsetLeft;curtop+=c.offsetTop;if(document.defaultView){var b=document.defaultView.getComputedStyle(c,null).getPropertyValue("position")}else{if(document.uniqueID){var b=c.currentStyle.position}}if(c.scrollTop&&(b=="absolute")){curtop-=c.scrollTop}if(c.scrollLeft&&(b=="absolute")){d-=c.scrollLeft}}}return[d,curtop]};xtdom.findPosAsSibling=function(c,e){var d=_curtop=0;var g=e;if(g.offsetParent){d+=g.offsetLeft;_curtop+=g.offsetTop;while(g=g.offsetParent){if(c.defaultView){var b=c.defaultView.getComputedStyle(g,null).getPropertyValue("position")}else{if(a){if(g.scrollTop&&b=="absolute"){_curtop-=g.scrollTop}}}if(g.scrollLeft&&(b=="absolute")){d-=g.scrollLeft}if(b=="absolute"||b=="fixed"||b=="relative"){break}d+=g.offsetLeft;_curtop+=g.offsetTop}}return[d,_curtop]};xtdom.isOffsetAncestorOf=function(c,d){var b=c.offsetParent;while(b!=null){if(b===d){return true}b=b.offsetParent}return false};xtdom.findPostitionFrom=function(c,d){if(!c||!d){return null}var b=c.ownerDocument;var e=d;while(!xtdom.isOffsetAncestor(c,e)){e=e.offsetParent}};xtdom.getWindowLimitFrom=function(e){var d=0,c=0,i=0,h=0;var b=e.ownerDocument;var g=b.defaultView||b.parentWindow;if(typeof(g.innerWidth)=="number"){d=g.innerWidth;c=g.innerHeight}else{if(b.documentElement&&(b.documentElement.clientWidth||b.documentElement.clientHeight)){d=b.documentElement.clientWidth;c=b.documentElement.clientHeight}else{if(b.body&&(b.body.clientWidth||b.body.clientHeight)){d=b.body.clientWidth;c=b.body.clientHeight}}}if(typeof(g.pageYOffset)=="number"){h=g.pageYOffset;i=g.pageXOffset}else{if(document.body&&(document.body.scrollLeft||document.body.scrollTop)){h=document.body.scrollTop;i=document.body.scrollLeft}else{if(document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)){h=document.documentElement.scrollTop;i=document.documentElement.scrollLeft}}}return[d+i,c+h]};xtiger.util.DOMDataSource=function(c){var e;this.xml=null;this.flow={};this.stack=[];if(c){if(c.constructor==={}.constructor){for(var b in c){e=c[b];if(e){(b=="document")?this.initFromDocument(e):this.initFlowFromDocument(e,b)}}}else{this.initFromDocument(c)}}};xtiger.util.DOMDataSource.prototype={hasData:function(){return(null!=this.xml)},_setRootNode:function(b){this.xml=b},_setFlowNode:function(b,c){this.flow[b]=[0,c]},_initFromTide:function(b){var g=b.childNodes;for(var d=0;d<g.length;d++){var e=g.item(d);if(e.nodeType==xtdom.ELEMENT_NODE){if(this.xml==null){this._setRootNode(e)}else{this._setFlowNode(xtdom.getLocalName(e),e)}}}},initFromDocument:function(d){this.xml=null;if(d&&d.documentElement){var b=d.documentElement;var c=b.nodeName=="tide"||b.nodeName=="xt:tide";if(c){this._initFromTide(b)}else{this._setRootNode(b)}}return(this.xml!=null)},initFlowFromDocument:function(d,c){var b=(d&&d.documentElement)?this._setFlowNode(c,d.documentElement):false;return b!=false},initFromString:function(g){var b=true;try{var h=xtiger.cross.makeDOMParser();var d=h.parseFromString(g,"text/xml");this.initFromDocument(d)}catch(c){alert("Exception : "+c.message);b=false}return b},openFlow:function(d,b,c){if(this.flow[d]){if(0===this.flow[d][0]){if(c&&(d==c)){this.flow[d]=[d,this.flow[d][1]]}else{this.flow[d]=this.makeRootVector(this.flow[d][1])}}this.stack.push([d,b]);return this.flow[d]}return false},closeFlow:function(c,b){var d=(this.stack.length>0)?this.stack[this.stack.length-1]:false;if(d&&(c==d[0])){this.stack.pop();if(this.stack.length>0){this.flow[c]=b}return d[1]}return false},nameFor:function(b){if(b instanceof Array){return xtdom.getLocalName(b[0])}else{return null}},lengthFor:function(b){if(b instanceof Array){return b.length-1}else{return 0}},makeRootVector:function(b){var e=[b];if(b){var h=b.childNodes;for(var d=0;d<h.length;d++){var g=h.item(d);if(g.nodeType==xtdom.ELEMENT_NODE){e.push(g)}}}return e},getRootVector:function(){return this.makeRootVector(this.xml)},hasDataFor:function(c,b){var d=false;if("@"==c.charAt(0)){if(b!==-1){d=xtdom.hasAttribute(b[0],c.substr(1))}}else{if((b instanceof Array)&&(b.length>1)){if(b[1]&&(b[1].nodeType==xtdom.ELEMENT_NODE)){var g=xtdom.getLocalName(b[1]);var e=c.search(g);d=(e!=-1)&&(((e+g.length)==c.length)||(c.charAt(e+g.length)==" "))}}}return d},getDataFor:function(b){if((b instanceof Array)&&(b.length>1)){return b[1]}else{return null}},isEmpty:function(b){var c=false;if((b instanceof Array)&&(b.length>1)){if(b.length==2){if(typeof(b[1])=="string"){c=(b[1].search(/\S/)==-1)}}}else{c=true}return c},getPointAtIndex:function(b,g,m){var j;var d=m.splice(g,1)[0];var l=d.childNodes;if((l.length==1)&&(l.item(0).nodeType==xtdom.TEXT_NODE)){var h=l.item(0).data;j=[d,h]}else{j=[d];for(var e=0;e<l.length;e++){var o=l.item(e);if(o.nodeType==xtdom.ELEMENT_NODE){j.push(o)}}if(j.length==1){j.push(null)}}return j},hasVectorFor:function(c,b){if(b instanceof Array){for(var d=1;d<b.length;d++){if((b[d]!==null)&&(b[d].nodeType==xtdom.ELEMENT_NODE)&&(xtdom.getLocalName(b[d])==c)){return true}}}return false},getVectorFor:function(c,b){if(b instanceof Array){for(var d=1;d<b.length;d++){if((b[d]!==null)&&(b[d].nodeType==xtdom.ELEMENT_NODE)&&(xtdom.getLocalName(b[d])==c)){return this.getPointAtIndex(c,d,b)}}}return -1},hasAttributeFor:function(c,b){return(b instanceof Array)&&(b[0].getAttribute(c)!=null)},getAttributeFor:function(d,c){var e=-1;if(c instanceof Array){var g=c[0];var b=g.getAttribute(d);if(b){g.removeAttribute(d);e=[g,b]}}return e},hasVectorForAnyOf:function(e,b){if(b instanceof Array){for(var d=1;d<b.length;d++){for(var c=0;c<e.length;c++){if((b[d]!==null)&&(b[d].nodeType==xtdom.ELEMENT_NODE)&&xtdom.getLocalName(b[d])==e[c]){return true}}}}return false},getVectorForAnyOf:function(e,b){if(b instanceof Array){for(var d=1;d<b.length;d++){for(var c=0;c<e.length;c++){if((b[d]!==null)&&(b[d].nodeType==xtdom.ELEMENT_NODE)&&xtdom.getLocalName(b[d])==e[c]){return this.getPointAtIndex(e[c],d,b)}}}}return -1}};xtiger.util.PseudoNode=function(b,c){this.type=b;this.discard=false;if(b===xtiger.util.PseudoNode.ELEMENT_NODE){this.name=c;this.attributes=null;this.content=null}else{this.content=c}};xtiger.util.PseudoNode.TEXT_NODE=0;xtiger.util.PseudoNode.ELEMENT_NODE=1;xtiger.util.PseudoNode.MIXED_NODE=2;xtiger.util.PseudoNode.NEWLINE="\n";xtiger.util.PseudoNode.prototype={indent:["","  "],discardNodeIfEmpty:function(){this.discard=true},mix:function(){var b;if(this.type!==xtiger.util.PseudoNode.MIXED_NODE){if(this.content&&!(this.content instanceof Array)){b=this.content;this.content=[b]}this.type=xtiger.util.PseudoNode.MIXED_NODE}},addChild:function(b){if((this.type!==xtiger.util.PseudoNode.MIXED_NODE)&&(xtiger.util.PseudoNode.TEXT_NODE===b.type)){this.content=b}else{if(!this.content){this.content=[]}if(this.content instanceof Array){this.content.push(b)}else{xtiger.cross.log("error","Mixed content ["+this.content+"] in "+this.name)}}},addAttribute:function(b,c){if(!this.attributes){this.attributes={}}this.attributes[b]=c},getIndentForLevel:function(e,d){var b=d?0:e;if(typeof this.indent[b]!=="string"){var c=this.indent[b-1];c+=this.indent[1];this.indent[b]=c}return this.indent[b]},dumpAttributes:function(){var b,c="";for(b in this.attributes){c+=" ";c+=b;c+='="';c+=xtiger.util.encodeEntities(this.attributes[b]);c+='"'}return c},dump:function(e,c){if(xtiger.util.PseudoNode.TEXT_NODE==this.type){return xtiger.util.encodeEntities(this.content)}else{var d=this.getIndentForLevel(e,c);if(this.content){d+="<";d+=this.name;if(this.attributes){d+=this.dumpAttributes()}d+=">";if(this.content instanceof Array){if((this.type!==xtiger.util.PseudoNode.MIXED_NODE)&&!c){d+=xtiger.util.PseudoNode.NEWLINE}for(var b=0;b<this.content.length;b++){d+=this.content[b].dump(e+1,this.type===xtiger.util.PseudoNode.MIXED_NODE)}if((this.type!==xtiger.util.PseudoNode.MIXED_NODE)&&!c){d+=this.getIndentForLevel(e,c)}}else{d+=xtiger.util.encodeEntities(this.content.content)}d+="</";d+=this.name;d+=">"}else{d+="<";d+=this.name;if(this.attributes){d+=this.dumpAttributes()}else{if(this.discard){return""}}d+="/>"}if(!c){d+=xtiger.util.PseudoNode.NEWLINE}return d}}};xtiger.util.DOMLogger=function(){this.stack=[];this.curTop=null;this.curAttr=null;this.curFlow=null;this.root=null;this.flow={};this.flowStack=[]};xtiger.util.DOMLogger.prototype={discardNodeIfEmpty:function(){if(this.curTop){this.curTop.discardNodeIfEmpty()}},allowMixedContent:function(){if(this.curTop){this.curTop.mix()}},openAttribute:function(b){this.curAttr=b},openFlow:function(c,b){if(!this.flow[c]){this.flow[c]=[null,null]}this.flowStack.push([c,this.curTop,this.curFlow]);this.curTop=this.flow[c][1];this.curFlow=c;return true},closeFlow:function(b){var c=(this.flowStack.length>0)?this.flowStack[this.flowStack.length-1]:false;if(c&&(b==c[0])){this.flowStack.pop();this.flow[b][1]=this.curTop||this.flow[b][0];this.curTop=c[1];this.curFlow=c[2];return true}return false},closeAttribute:function(b){if(this.curAttr!=b){alert("Attempt to close an attribute "+b+" while in attribute "+this.curAttr+"!")}this.curAttr=null},openTag:function(b){var d=new xtiger.util.PseudoNode(xtiger.util.PseudoNode.ELEMENT_NODE,b);if(!this.root){this.root=d}else{if(this.curFlow&&(!this.flow[this.curFlow][0])){if(this.curFlow==b){this.flow[this.curFlow][0]=d}else{var c=new xtiger.util.PseudoNode(xtiger.util.PseudoNode.ELEMENT_NODE,this.curFlow);this.flow[this.curFlow][0]=c;c.addChild(d)}}}if(this.curTop){this.curTop.addChild(d)}this.stack.push(this.curTop);this.curTop=d},closeTag:function(b){this.curTop=this.stack.pop()},emptyTag:function(b){this.openTag(b);this.closeTag(b)},write:function(b){if(this.curAttr){this.curTop.addAttribute(this.curAttr,b)}else{var c=new xtiger.util.PseudoNode(xtiger.util.PseudoNode.TEXT_NODE,b);this.curTop.addChild(c)}},writeAttribute:function(b,c){this.curTop.addAttribute(b,c)},_dump:function(b,c){if(b=="document"){if(this.root){return this.root.dump(c)}else{return xtiger.util.PseudoNode.prototype.indent[c]+"<document/>\n"}}else{if(this.flow[b]){return this.flow[b][0].dump(c)}else{return xtiger.util.PseudoNode.prototype.indent[c]+"<"+b+"/>\n"}}},dump:function(c){var b;var h=c||"document";if((h instanceof Array)||(h=="*")){if(((h instanceof Array)&&(h[0]=="*"))||((h=="*")&&(xtiger.util.countProperties(this.flow)>0))){b=["document"];for(var e in this.flow){b.push(e)}}else{b=(h=="*")?"document":h}}else{b=h}if(b instanceof Array){var d=[];d.push('<xt:tide xmlns:xt="'+xtiger.parser.nsXTiger+'">\n');for(var g=0;g<b.length;g++){d.push(this._dump(b[g],1))}d.push("</xt:tide>\n");return d.join("")}else{return this._dump(b,0)}},close:function(){}};xtiger.cross.UA={IE:!!(window.attachEvent&&navigator.userAgent.indexOf("Opera")===-1),opera:navigator.userAgent.indexOf("Opera")>-1,webKit:navigator.userAgent.indexOf("AppleWebKit/")>-1,gecko:navigator.userAgent.indexOf("Gecko")>-1&&navigator.userAgent.indexOf("KHTML")===-1,mobileSafari:!!navigator.userAgent.match(/Apple.*Mobile.*Safari/)};xtiger.cross.events={DOWN:(window.Modernizr&&window.Modernizr.touch)?"touchstart":"mousedown"};if(!(xtiger.cross.UA.gecko||xtiger.cross.UA.webKit||xtiger.cross.UA.IE||xtiger.cross.UA.opera||xtiger.cross.UA.mobileSafari)){xtiger.cross.log("warning","XTiger Forms could not detect user agent name, assuming a Gecko like browser");xtiger.cross.UA.gecko=true}xtiger.util.countProperties=function(d){var c=0;for(var b in d){if(d.hasOwnProperty(b)){c++}}return c};xtiger.util.encodeEntities=function(c){if(typeof(c)!="string"){return c}var b=c;if(c.indexOf("&")!=-1){b=b.replace(/&(?![a-zA-Z]{3,5};)/g,"&amp;")}if(c.indexOf("<")!=-1){b=b.replace(/</g,"&lt;")}if(c.indexOf(">")!=-1){b=b.replace(/>/g,"&gt;")}return b};xtiger.util.decodeEntities=function(c){if(c.indexOf("&amp;")!=-1){var b=c.replace(/&amp;/g,"&");if(c.indexOf("<")!=-1){return b.replace(/&lt;/g,"<")}return b}return c};xtiger.util.decodeParameters=function(c,h){if(!c){return}var b=c.split(";");for(var g=0;g<b.length;g++){var i=b[g].indexOf("=");if(i>0){var e=b[g].substr(0,i);var d=e.replace(/^\s+/,"").replace(/\s+$/,"");if(d.length>0){if(d=="class"){d="hasClass"}h[d]=b[g].substr(i+1).replace(/^\s+/,"").replace(/\s+$/,"")}}}};xtiger.util.mixin=function mixin(e,d){var c={};for(var b in d){if((typeof c[b]=="undefined")||(c[b]!=d[b])){e[b]=d[b]}}if(xtiger.cross.UA.IE&&(typeof(d.toString)=="function")&&(d.toString!=e.toString)&&(d.toString!=c.toString)){e.toString=d.toString}return e};xtiger.util.array_map=function array_map(e,b){if(!(typeof e=="object"&&typeof b=="function")){return e}var c=[];for(var d=0;d<e.length;d++){c[d]=b(e[d])}return c};xtiger.util.array_filter=function array_filter(e,b){if(!(typeof e=="object"&&typeof b=="function")){return e}var c=[];for(var d=0;d<e.length;d++){if(b(e[d])){c.push(e[d])}}return c};xtiger.util.array_contains=function array_contains(d,c){if(typeof d!="object"){return false}for(var b=0;b<d.length;b++){if(d[b]==c){return true}if(typeof(d[b])=="object"&&typeof(c)=="object"){if(xtiger.util.object_compare(d[b],c)){return true}}}return false};xtiger.util.object_compare=function object_compare(b,c){for(_prop in b){if(typeof(c[_prop])=="undefined"){return false}}for(_prop in b){if(b[_prop]){switch(typeof(b[_prop])){case"object":if(!xtiger.util.object_compare(b[_prop],c[_prop])){return false}break;case"function":if(typeof(c[_prop])=="undefined"||(_prop!="equals"&&b[_prop].toString()!=c[_prop].toString())){return false}break;default:if(b[_prop]!=c[_prop]){return false}}}else{if(c[_prop]){return false}}}for(_prop in c){if(typeof(b[_prop])=="undefined"){return false}}return true};xtiger.cross.getXHRObject=function(){var c=false;if(window.XMLHttpRequest){c=new XMLHttpRequest()}else{if(window.ActiveXObject){try{c=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){try{c=new ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}}}if(!c){alert("Your browser does not support XMLHTTPRequest")}return c};xtiger.cross.loadDocument=function(c,b){var h=xtiger.cross.getXHRObject();try{h.open("GET",c,false);h.send(null);if((h.status==200)||(h.status==0)){if(h.responseXML){return h.responseXML}else{if(b){b.logError("$$$ loaded but it contains no XML data",c)}}}else{if(b){var d=h.statusText?"("+h.statusText+")":"";b.logError("HTTP error while loading $$$, status code : "+h.status+d,c)}}}catch(g){if(b){b.logError("Exception while loading $$$ : "+(g.message?g.message:g.name),c)}}return false};xtiger.cross.log=function(b,c){switch(b){case"error":case"fatal":xtiger.cross.print("[XX] "+c);break;case"warning":xtiger.cross.print("[!!] "+c);break;case"info":break;case"debug":xtiger.cross.print("[dd] "+c);break;default:}};xtiger.cross.print=function(c){try{if(typeof(opera)!="undefined"&&opera.log){opera.postError(c)}else{if(typeof(console)!="undefined"){if(/^\[!!\]/.test(c)&&console.warn){console.warn(c)}else{if(/^\[XX\]/.test(c)&&console.error){console.error(c)}else{if(console.log){console.log(c)}}}}else{if(typeof(window.console)!="undefined"&&window.console.log){window.console.log(c)}}}}catch(b){alert(c+"\nUnable to print on console ("+b.message+")")}};if(typeof DOMParser=="undefined"){xtiger.util.DOMParser=function(){};xtiger.util.DOMParser.prototype.parseFromString=function(e,g){if(typeof ActiveXObject!="undefined"){var c=new ActiveXObject("MSXML.DomDocument");c.loadXML(e);return c}else{if(typeof XMLHttpRequest!="undefined"){var b=new XMLHttpRequest;b.open("GET","data:"+(g||"application/xml")+";charset=utf-8,"+encodeURIComponent(e),false);if(b.overrideMimeType){b.overrideMimeType(g)}b.send(null);return b.responseXML}}};xtiger.cross.makeDOMParser=function(){return new xtiger.util.DOMParser()}}else{xtiger.cross.makeDOMParser=function(){return new DOMParser()}}if(!document.createTreeWalker){xtiger.util.TreeWalker=function(d,b,c){this.nodeList=new Array();this.nodeType=b;this.filter=c;this.nodeIndex=-1;this.currentNode=null;this.findNodes(d)};xtiger.util.TreeWalker.prototype={nextNode:function(){this.nodeIndex+=1;if(this.nodeIndex<this.nodeList.length){this.currentNode=this.nodeList[this.nodeIndex];return true}else{this.nodeIndex=-1;return false}},findNodes:function(c){if(c.nodeType==this.nodeType&&this.filter(c)==xtdom.NodeFilter.FILTER_ACCEPT){this.nodeList.push(c)}if(c.nodeType==1){for(var b=0;b<c.childNodes.length;b++){this.findNodes(c.childNodes[b])}}}};xtiger.cross.makeTreeWalker=function(d,c,b){return new xtiger.util.TreeWalker(d,c,b)}}else{if(xtiger.cross.UA.webKit||xtiger.cross.UA.IE){xtiger.cross.makeTreeWalker=function(d,c,b){return document.createTreeWalker(d,c,b,false)}}else{xtiger.cross.makeTreeWalker=function(e,c,b){var d={acceptNode:b};return document.createTreeWalker(e,c,d,false)}}}xtdom.getNodeTypeXT=function(b){var c=b.nodeName.toLowerCase();if((c=="use")||(c=="xt:use")){return xtiger.USE}else{if((c=="component")||(c=="xt:component")){return xtiger.COMPONENT}else{if((c=="repeat")||(c=="xt:repeat")){return xtiger.REPEAT}else{if((c=="bag")||(c=="xt:bag")){return xtiger.BAG}else{if((c=="attribute")||(c=="xt:attribute")){return xtiger.ATTRIBUTE}else{return xtiger.UNKNOWN}}}}}};xtdom.ELEMENT_NODE=1;xtdom.ATTRIBUTE_NODE=2;xtdom.TEXT_NODE=3;xtdom.CDATA_SECTION_NODE=4;xtdom.COMMENT_NODE=8;if((typeof NodeFilter=="undefined")||!NodeFilter){xtdom.NodeFilter={SHOW_ELEMENT:1,FILTER_ACCEPT:1,FILTER_SKIP:3}}else{xtdom.NodeFilter={SHOW_ELEMENT:NodeFilter.SHOW_ELEMENT,FILTER_ACCEPT:NodeFilter.FILTER_ACCEPT,FILTER_SKIP:NodeFilter.FILTER_SKIP}}xtdom.getWindow=function getWindow(b){if(window.document==b){return window}if(window.frames.length>0){for(var c=0;c<window.frames.length;c++){if(window.frames[c].document==b){return window.frames[c]}}}xtiger.cross.log("warning","The window object was not found.");return window};if(!xtiger.cross.UA.IE){xtdom.isXT=function isXT(c){var b=c.namespaceURI;return(b==xtiger.parser.nsXTiger)||(b==xtiger.parser.nsXTiger_deprecated)};xtdom.isUseXT=function isUseX(b){return(b.nodeName=="use"||b.nodeName=="xt:use")};xtdom.isBagXT=function(b){return(b.nodeName=="bag"||b.nodeName=="xt:bag")};xtdom.getElementsByTagNameXT=function(b,c){var d=b.getElementsByTagName(c);if(0==d.length){d=b.getElementsByTagName("xt:"+c)}return d};xtdom.getLocalName=function(b){return b.localName};xtdom.getTextContent=function(b){if(b.textContent){return b.textContent}else{if(b.text){return b.text}else{return""}}};xtdom.createElement=function(c,b){return c.createElementNS("http://www.w3.org/1999/xhtml",b)};xtdom.createElementNS=function(d,b,c){return d.createElementNS(c,b)};xtdom.importNode=function(d,c,b){return d.importNode(c,b)};xtdom.cloneNode=function(d,c,b){return c.cloneNode(b)};xtdom.setAttribute=function(c,b,d){c.setAttribute(b,d)};xtdom.getStyleAttribute=function(b){return b.getAttribute("style")};xtdom.getEventTarget=function(b){return b.target};xtdom.addEventListener=function(d,c,e,b){d.addEventListener(c,e,b)};xtdom.removeEventListener=function(d,c,e,b){d.removeEventListener(c,e,b)};xtdom.removeAllEvents=function(b){alert("removeAllEvents should not be called on this browser")};xtdom.preventDefault=function(b){b.preventDefault()};xtdom.stopPropagation=function(b){b.stopPropagation()};xtdom.focusAndSelect=function(b){try{b.focus();b.value=""}catch(c){}};xtdom.focusAndMoveCaretTo=function(c,b){try{c.focus();if(c.setSelectionRange){c.setSelectionRange(b,b)}}catch(d){}}}if(xtiger.cross.UA.IE){xtdom.hasAttribute=function(c,b){return c.getAttribute(b)!=null};xtdom.isXT=function(b){return xtiger.parser.isXTigerName.test(b.nodeName)};xtdom.isUseXT=function(b){var c=b.nodeName.toUpperCase();return(c==="USE"||c==="XT:USE")};xtdom.isBagXT=function(b){var c=b.nodeName.toUpperCase();return(c==="BAG"||c==="XT:BAG")};xtdom.getElementsByTagNameXT=function(b,c){var d=b.getElementsByTagName(c);if(0==d.length){d=b.getElementsByTagName("xt:"+c)}return d};xtdom.getLocalName=function(b){return b.nodeName};xtdom.getTextContent=function(b){if(b.innerText){return b.innerText}else{if(b.text){return b.text}else{return""}}};xtdom.createElement=function(c,b){return c.createElement(b)};xtdom.createElementNS=function(d,b,c){if(c==xtiger.parser.nsXTiger){return d.createElement("xt:"+b)}else{return d.createElement(c+":"+b)}};xtdom.importNode=function(h,g,b){var l;switch(g.nodeType){case xtdom.ELEMENT_NODE:var e=g.nodeName.indexOf(":");var j=(e==-1)?g.nodeName:g.nodeName.substr(e+1);var d=xtdom.createElement(h,j);if(g.attributes&&g.attributes.length>0){for(var c=0;c<g.attributes.length;c++){xtdom.setAttribute(d,g.attributes[c].name,g.attributes[c].value)}}if(b&&g.childNodes&&g.childNodes.length>0){for(var c=0;c<g.childNodes.length;c++){l=xtdom.importNode(h,g.childNodes[c],b);if(l){d.appendChild(l)}}}return d;break;case xtdom.TEXT_NODE:case xtdom.CDATA_SECTION_NODE:return xtdom.createTextNode(h,g.nodeValue);break;case xtdom.COMMENT_NODE:break}};xtdom.cloneNode=function(d,c,b){var e=c.cloneNode(b);xtdom.removeAllEvents(e);return e};xtdom.setAttribute=function(c,b,d){if(b=="class"){c.className=d}else{c.setAttribute(b,d)}};xtdom.getStyleAttribute=function(b){if(b.style){return b.style.cssText}else{if(b.attributes[0]&&b.attributes[0].nodeName=="style"){return b.attributes[0].nodeValue}}};xtdom.getEventTarget=function(b){return(b&&b.srcElement)?b.srcElement:window.event.srcElement};xtdom.addEventListener=function(d,c,e,b){d.attachEvent("on"+c,e);if(!d.events){d.events=new Array()}d.events.push([c,e])};xtdom.removeEventListener=function(d,c,e,b){d.detachEvent("on"+c,e)};xtdom.removeAllEvents=function(c){if(c.events){for(var b=0;b<c.events.length;b++){xtdom.removeEventListener(c,c.events[b][0],c.events[b][1],true)}c.events=new Array()}};xtdom.preventDefault=function(b){b.returnValue=false};xtdom.stopPropagation=function(b){b.cancelBubble=true};xtdom.focusAndSelect=function(b){try{b.focus();var d=b.createTextRange();d.moveStart("character",0);d.moveEnd("character",b.value.length);d.select()}catch(c){}};xtdom.focusAndMoveCaretTo=function(c,b){try{c.focus();var g=c.createTextRange();g.collapse(false);g.select()}catch(d){}}}xtiger.parser.NATIVE=0;xtiger.parser.CONSTRUCTED=1;xtiger.parser.nsXTiger="http://ns.inria.org/xtiger";xtiger.parser.nsXTiger_deprecated="http://wam.inrialpes.fr/xtiger";xtiger.parser.nsXHTML="http://www.w3.org/1999/xhtml";xtiger.parser.isXTiger=/<[^>]*[(component)(use)(repeat)(service)]/i;xtiger.parser.isXTigerName=/[(component)(use)(repeat)(service)]/i;xtiger.parser.Component=function(c,b){this.nature=c;this.tree=b;this.str=null};xtiger.parser.Component.prototype={isNative:function(){return(xtiger.parser.NATIVE==this.nature)},hasBeenExpanded:function(){return(xtiger.parser.NATIVE==this.nature)||(this.str!=null)},getSource:function(){if(!this.str){this.str=this.tree.innerHTML}return this.str},getTree:function(){return this.tree},getClone:function(c){var b=xtdom.cloneNode(c,this.tree,true);return b},importStructTo:function(b){var c=xtdom.importNode(b,this.tree,true);this.tree=c}};xtiger.parser.Iterator=function(c,b){this.transformer=b;this.unionList=new Object();this.componentLib=new Object();this.transformer.coupleWithIterator(this);this.acquireComponentStructs(c);this.acquireUnion(c);this.acquireHeadLabel(c)};xtiger.parser.Iterator.prototype={hasType:function(b){return this.componentLib[b]?true:false},defineType:function(b,c){this.componentLib[b]=c},defineUnion:function(b,c){this.unionList[b]=c},getComponentForType:function(b){return this.componentLib[b]},acquireHeadLabel:function(b){var c;var d=xtdom.getElementsByTagNameXT(b,"head");if(d&&(d.length>0)){c=d[0].getAttributeNode("label");if(!c){d=xtdom.getElementsByTagNameXT(d[0],"head");if(d&&(d.length>0)){c=d[0].getAttributeNode("label")}}}this.headLabel=c?c.value:undefined},acquireComponentStructs:function(b){var c=xtdom.getElementsByTagNameXT(b,"component");var d=new Array();for(var g=0;g<c.length;g++){var e=c[g].getAttribute("name");if(e){d.push(e);this.componentLib[e]=new xtiger.parser.Component(xtiger.parser.CONSTRUCTED,c[g])}}this.unionList.anyComponent=d},acquireUnion:function(i){var h=xtdom.getElementsByTagNameXT(i,"union");for(var c=0;c<h.length;c++){var d;var b=h[c].getAttributeNode("name").value;d=h[c].getAttributeNode("include").value.split(" ");var g=this.flattenUnionTypes(d);var e=" "+g.join(" ")+" ";d=h[c].getAttributeNode("exclude");if(d){d=l.value.split(" ");var l=this.flattenUnionTypes(d);for(var j=0;j<l.length;j++){e=e.replace(new RegExp(" "+l[j]+" ")," ")}}e=e.substring(1,e.length-1);this.unionList[b]=e.split(" ")}this.unionList.any=this.unionList.anySimple.concat(this.unionList.anyElement,this.unionList.anyComponent)},flattenUnionTypes:function(e){var c=[];for(var g=0;g<e.length;g++){if(this.unionList[e[g]]!=null){var b=this.unionList[e[g]];for(var d=0;d<b.length;d++){c.push(b[d])}}else{c.push(e[g])}}return c},importComponentStructs:function(c){xtiger.cross.log("info","imports template component structures to target document");for(var b in this.componentLib){this.componentLib[b].importStructTo(c)}},transform:function(b,c){this.curDoc=c;this.transformer.prepareForIteration(this,c,this.headLabel);this.transformIter(b);this.transformer.finishTransformation(b)},transformIter:function(b){if(b.nodeType==xtdom.ELEMENT_NODE){var c=xtdom.getNodeTypeXT(b);if(xtiger.COMPONENT==c){this.changeComponent(b)}else{this.transformer.saveContext(b);switch(c){case xtiger.USE:this.changeUse(b);break;case xtiger.REPEAT:this.changeRepeat(b);break;case xtiger.ATTRIBUTE:this.changeAttribute(b);break;case xtiger.BAG:this.changeBag(b);break;default:this.continueWithChildOf(b)}this.transformer.restoreContext(b)}}},continueWithChildOf:function(b){var d=new Array();for(var c=0;c<b.childNodes.length;c++){if(xtdom.containsXT(b.childNodes[c])){d.push(b.childNodes[c])}}this.transformItems(d)},transformItems:function(b){if(b.length==0){return}var d;if(b[0]=="OPAQUE"){b.shift();var c=this.transformer.popContext();while(d=b.shift()){this.transformer.saveContext(d,true);this.transformIter(this.transformer.getNodeFromOpaqueContext(d));this.transformer.restoreContext(d,true)}this.transformer.pushContext(c)}else{while(d=b.shift()){this.transformIter(d)}}},changeComponent:function(c){var d=[];var b=xtdom.createElement(this.curDoc,"div");this.transformer.genComponentBody(c,b);this.transformer.genComponentContent(c,b,d);this.transformItems(d);this.transformer.finishComponentGeneration(c,b);xtdom.replaceNodeByChildOf(c,b)},changeRepeat:function(c){var d=[];var b=xtdom.createElement(this.curDoc,"div");this.transformer.genRepeatBody(c,b,d);this.transformer.genRepeatContent(c,b,d);this.transformItems(d);this.transformer.finishRepeatGeneration(c,b);xtdom.replaceNodeByChildOf(c,b)},changeUse:function(c){var g=[];var b=xtdom.createElement(this.curDoc,"div");var e="use";var d=c.getAttribute("types").split(" ");d=this.flattenUnionTypes(d);this.transformer.genIteratedTypeBody(e,c,b,d);this.transformer.genIteratedTypeContent(e,c,b,g,d);this.transformItems(g);this.transformer.finishIteratedTypeGeneration(e,c,b,d);xtdom.replaceNodeByChildOf(c,b)},changeAttribute:function(c){var g=null;var b=xtdom.createElement(this.curDoc,"div");var e="attribute";var d=[c.getAttribute("types")||c.getAttribute("type")];this.transformer.genIteratedTypeBody(e,c,b,d);this.transformer.genIteratedTypeContent(e,c,b,g,d);this.transformer.finishIteratedTypeGeneration(e,c,b,d);xtdom.replaceNodeByChildOf(c,b)},changeBag:function(d){var c=xtdom.createElement(this.curDoc,"span");xtdom.addClassName(c,"axel-generator-error");var b=xtdom.createTextNode(this.curDoc,"! unsupported Bag element !");c.appendChild(b);d.parentNode.insertBefore(c,d,true);d.parentNode.removeChild(d)}};xtiger.util.Form=function(b){this.baseUrl=b;this.doTab=false;this.loader=this.serializer=null};xtiger.util.Form.prototype={_report:function(b,d,c){this.status=b;this.msg=d;if(0===this.status){if(c){c.logError(d)}else{xtiger.cross.log("error",d)}}},setLoader:function(b){this.loader=b},setSerializer:function(b){this.serializer=b},enableTabGroupNavigation:function(){this.doTab=true},setTemplateSource:function(c,d){this.srcDoc=c;this.srcForm=null;if(c){var b=c.getElementsByTagName("body");if(b&&(b.length>0)){this.srcForm=b[0]}else{try{c.setProperty("SelectionNamespaces","xmlns:xhtml='http://www.w3.org/1999/xhtml'");this.srcForm=c.selectSingleNode("//xhtml:body")}catch(g){}}if(!this.srcForm){this._report(0,"Could not get <body> element from the template to transform",d)}this.curDoc=c;this.targetContainerId=false}else{this._report(0,"The document containing the template is null or undefined",d)}this._report(1,"template source set",d);return(this.status===1)},setTargetDocument:function(d,c,b){this.curDoc=d;this.targetContainerId=c;this.doEmptyTarget=b},transform:function(b){if(!this.srcForm){this._report(0,"no template to transform",b);return false}this.editor=new xtiger.editor.Generator(this.baseUrl);this.parser=new xtiger.parser.Iterator(this.srcDoc,this.editor);if(this.targetContainerId){var e=this.curDoc.getElementById(this.targetContainerId);if(e){if(this.doEmptyTarget){xtdom.removeChildrenOf(e)}xtdom.importChildOfInto(this.curDoc,this.srcForm,e);this.root=e}else{this._report(0,'transformation aborted because target container "'+this.targetContainerId+'" not found in target document',b);return false}this.parser.importComponentStructs(this.curDoc)}else{this.root=this.srcForm}var d=xtiger.session(this.curDoc).load("keyboard");if(!d){d=new xtiger.editor.Keyboard();xtiger.session(this.curDoc).save("keyboard",d);if(this.doTab){var c=new xtiger.editor.TabGroupManager(this.root);d.setTabGroupManager(c);xtiger.session(this.curDoc).save("tabgroupmgr",c)}}xtiger.session(this.curDoc).save("form",this);this.parser.transform(this.root,this.curDoc);this._report(1,"document transformed",b);return(this.status==1)},getEditor:function(){return this.editor},getRoot:function(){return this.root},injectStyleSheet:function(c,b){var d=this.curDoc?this.curDoc.getElementsByTagName("head")[0]:null;if(d){var e=document.createElement("link");e.setAttribute("rel","stylesheet");e.setAttribute("type","text/css");e.setAttribute("href",c);d.appendChild(e);this._report(1,"stylesheet injected",b)}else{this._report(0,"cannot inject editor's style sheet because target document has no head section",b)}return(this.status==1)},loadData:function(c,b){if(c.hasData()){this.editor.loadData(this.root,c,this.loader);this._report(1,"data loaded",b)}else{this._report(0,"data source empty",b)}return(this.status==1)},loadDataFromString:function(d,b){var c=new xtiger.util.DOMDataSource();if(c.initFromString(d)){this.loadData(c,b)}else{this._report(0,"failed to parse string data source",b)}return(this.status==1)},loadDataFromUrl:function(c,b){var g,e;var d=false;g=xtiger.cross.loadDocument(c,b);if(g){d=this.loadData(new xtiger.util.DOMDataSource(g),b)}return d},serializeData:function(b){this.editor.serializeData(this.root,b,this.serializer)},loadDataFromFile:function(c,h,b){try{h.open("GET",c,false);h.send(null);if((h.status==200)||(h.status==0)){if(h.responseXML){this.loadData(new xtiger.util.DOMDataSource(h.responseXML),b)}else{var d=h.responseText;d=d.replace(/^<\?xml\s+version\s*=\s*(["'])[^\1]+\1[^?]*\?>/,"");xtiger.cross.log("warning","attempt to use string parser on "+c+" instead of responseXML");if(!dataSource.initFromString(d)){this._report(0,"failed to create data source for data from file "+c+". Most probably no documentElement",b)}}}else{this._report(0,"failed to load XML data from file "+c+". XHR status : "+h.status,b)}}catch(g){this._report(0,"failed to open XML data file "+c+". Exception : "+g.name+"/"+g.message,b)}return(this.status==1)},postDataToUrl:function(c,i,b){var d=new xtiger.util.DOMLogger();var g=this.editor.serializeData(this.root,d,this.serializer);d.close();try{i.open("POST",c,false);i.setRequestHeader("Content-Type","application/xml; charset=UTF-8");i.send(d.dump("*"));if(i.readyState==4){if((i.status==200)||(i.status==201)||(i.status==0)){this._report(1,i.responseText,b)}else{this._report(0,"can't post data to \""+c+'". Error : '+i.status,b)}}else{this._report(0,"can't post data to \""+c+'". Error readyState is '+i.readyState,b)}}catch(h){i.abort();this._report(0,"can't post data to \""+c+'". Exception : '+h.name+"/"+h.message,b)}return(this.status==1)},saveDataToFile:function(b,j){if(xtiger.cross.UA.gecko){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect")}catch(h){this._report(0,'Permission to save data to file "'+b+'" was denied. Exception : '+h.name+"/"+h.message,j);return false}try{var d=new xtiger.util.DOMLogger();var g=this.editor.serializeData(this.root,d,this.serializer);d.close();var c=Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);c.initWithPath(b);if(c.exists()==false){c.create(Components.interfaces.nsIFile.NORMAL_FILE_TYPE,420)}var i=Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);i.init(c,4|8|32,420,0);var n=Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);n.charset="UTF-8";var l=n.ConvertFromUnicode(d.dump("*"));var m=i.write(l,l.length);i.close();this._report(1,'Data saved to "'+b+'"',j)}catch(h){this._report(0,'Cannot save data to file "'+b+'". Exception : '+h.name+"/"+h.message,j)}}else{this.postDataToUrl(b,xtiger.cross.getXHRObject())}return(this.status==1)}};(function(e){function i(o,m,l){if(o.xttPrimitiveEditor){m.push(o.xttPrimitiveEditor)}if(o.firstChild){d(o.firstChild,o.lastChild,m,l)}}function d(m,l,q,p){var o=m,n=true,r;while(o&&n){if(o.startRepeatedItem&&!p){if(o.startRepeatedItem.getSize()===0){o=o.startRepeatedItem.getLastNodeForSlice(0);o=o.nextSibling;continue}}if(o.beginChoiceItem){r=o.beginChoiceItem;if(r.items[r.curItem][0]!==r.items[r.curItem][1]){d(r.items[r.curItem][0],r.items[r.curItem][1],q,p)}else{i(r.items[r.curItem][0],q,p)}o=r.items[r.items.length-1][1]}else{i(o,q,p)}if(o===l){n=false}o=o.nextSibling}}function h(){this.stack=[]}h.prototype={discardNodeIfEmpty:function(){},write:function(l){this.stack.push(l)},dump:function(){return this.stack.join(" ")}};function b(l,n){var m;this.seethrough=n;this.list=[];for(m=0;m<l.length;m++){i(l[m],this.list,n)}}b.prototype={length:function(){return this.list.length},get:function(l){return this.list[l]},clear:function(l){var m;for(m=0;m<this.list.length;m++){this.list[m].clear(l)}return this},update:function(m){var l;for(l=0;l<this.list.length;l++){this.list[l].update(m)}return this},text:function(){var m,l=new h();for(m=0;m<this.list.length;m++){this.list[m].save(l)}return l.dump()},configure:function(m,n){var l;for(l=0;l<this.list.length;l++){this.list[l].configure(m,n)}return this},apply:function(n,l){var m;for(m=0;m<this.list.length;m++){n(l?this.list[m].getHandle():this.list[m])}return this}};var c=function g(l,o,n){var m;if(typeof l==="string"){if(e.jQuery){m=$(l,n||document).get()}else{xtiger.cross.log("warning",'jQuery missing to interpet wrapped set selector "'+l+'"');m=[]}}else{if(Object.prototype.toString.call(l)==="[object Array]"){m=l}else{if(l){m=[l]}else{xtiger.cross.log("warning","empty wrapped set selector");m=[]}}}return new b(m,o)};c.extend=function j(p,o,m,n){if(m){for(var l in o){if(o.hasOwnProperty(l)){if(n||(typeof p.prototype[l]==="undefined")){p.prototype[l]=o[l]}}}}else{for(var l in o){if(o.hasOwnProperty(l)){if(n||(typeof p[l]==="undefined")){p[l]=o[l]}}}}};e.$axel=c}(window));xtiger.editor.Plugin=function(){};xtiger.editor.Plugin.prototype={pluginEditors:{},getEditorFor:function(e,c){var b;if(c.length===1){var g=e.getAttribute("wrapper");var d=(g)?"string":c[0];b=this.pluginEditors[d]}return b},hasEditorFor:function(e,b){var c;if(this.pluginEditors[b]){c=true}else{var g=e.getAttribute("wrapper");var d=(g)?"string":b;c=(this.pluginEditors[d]!==undefined)}return c}};(function(j){var i=0;function e(m){return m+(i++)}function g(o,n,m){this.type=o;this.spec=n;this.klass=m}g.prototype={createModel:function c(p,o,m){var r=this.klass.generator(p,o,m);if(this.spec.optional){var q=o.getAttribute("option");if(q){var n=xtdom.createElement(m,"input");xtdom.setAttribute(n,"type","checkbox");xtdom.addClassName(n,"axel-option-checkbox");p.insertBefore(n,r)}}return r},createEditorFromTree:function b(o,n,m){var q,p=new this.klass();p._init(o,m,e(this.type));p._parseFromTemplate(n);if(this.spec.filterable){q=p.getParam("filter");if(q){p=this.applyFilters(p,q)}}p.onInit(p.getDefaultData(),p.getOption());p.onAwake();if(this.spec.optional){p._onInitOption();p._onAwakeOption()}return p},createEditorFromSeed:function h(p,q,m,n){var o=new this.klass();o._init(q,m,e(this.type));o._parseFromSeed(p);if(this.spec.filterable){f=o.getParam("filter");if(f){o=this.applyFilters(o,f)}}o.onInit(o.getDefaultData(),o.getOption(),n);o.onAwake();if(this.spec.optional){o._onInitOption();o._onAwakeOption()}return o}};var l={load:function(n,m){this.onLoad(n,m)},save:function(m){this.onSave(m)},_init:function(n,m,o){this._document=m;this._key=o;this._handle=n;this._isModified=false},_parseFromTemplate:function(m){var n;this._param={};xtiger.util.decodeParameters(m.getAttribute("param"),this._param);this._content=xtdom.extractDefaultContentXT(m);n=m.getAttribute("option");this._option=n?n.toLowerCase():null},_parseFromSeed:function(m){this._param=m[1];this._content=m[2];this._option=m[3]},makeSeed:function(){if(!this._seed){this._seed=[this._getKFactory(),this._param,this._content,this._option]}return this._seed},getParam:function(m){return this._param[m]||this._getKParam(m)},getDefaultData:function(){return this._content},getOption:function(){return this._option},configure:function(){},getUniqueKey:function(){return this._key},getDocument:function(){return this._document},getHandle:function(){return this._handle},setModified:function(m){this._isModified=m},isModified:function(){return this._isModified},can:function(m){return typeof this[m]==="function"},execute:function(m,n){return this[m](n)},isOptional:function(){return false},isFocusable:function(){return false},focus:function(){},unfocus:function(){}};var d={_onInitOption:function(){var m=this.getOption();if(m){this._isOptional=true;this._optCheckBox=this._handle.previousSibling;if(m==="unset"){this._isOptionSet=true}(m==="set")?this.set(false):this.unset(false)}else{this._isOptional=false}},_onAwakeOption:function(){var m=this;if(this.isOptional()){xtdom.addEventListener(this._optCheckBox,"click",function(n){m.onToggleOpt(n)},true)}},isOptional:function(){return this._isOptional},isSet:function(){return this._isOptional&&this._isOptionSet},set:function(m){if(m){if(!this.getParam("noedit")){xtiger.editor.Repeat.autoSelectRepeatIter(this.getHandle(true))}xtdom.removeClassName(this.getHandle(),"axel-repeat-unset")}if(!this._isOptionSet){this._isOptionSet=true;if(this._isOptional){xtdom.removeClassName(this.getHandle(),"axel-option-unset");xtdom.addClassName(this.getHandle(),"axel-option-set");this._optCheckBox.checked=true}}},unset:function(m){if(this._isOptionSet){this._isOptionSet=false;if(this._isOptional){xtdom.removeClassName(this._handle,"axel-option-set");xtdom.addClassName(this._handle,"axel-option-unset");this._optCheckBox.checked=false}}},onToggleOpt:function(m){this._isOptionSet?this.unset(true):this.set(true)}};j.plugin=j.plugin||{};j.plugin.register=function(p,o,r,s,n){var q;if(xtiger.editor.Plugin.prototype.pluginEditors[p]){xtiger.cross.log("error",'plugin "'+p+'" has already been registered, registration aborted')}else{xtiger.cross.log("info",'registering plugin "'+p+'"');var m=new Function();m.generator=s;factoklass=new g(p,o,m);m.prototype=(function(x,u){var w=u,v=x;return{_getKFactory:function(){return w},_getKParam:function(y){return v[y]}}}(r,factoklass));j.extend(m.prototype,l);if(o.optional){j.extend(m.prototype,d,false,true)}m.prototype.onInit=n.onInit;m.prototype.onAwake=n.onAwake;m.prototype.onLoad=n.onLoad;m.prototype.onSave=n.onSave;j.extend(m.prototype,n.api,false,true);j.extend(m.prototype,n.methods);if(o.filterable){xtiger.editor.Plugin.prototype.pluginEditors[p]=xtiger.util.filterable(p,factoklass)}else{xtiger.editor.Plugin.prototype.pluginEditors[p]=factoklass}}};j.plugin.list=function(){var m,n=[];for(m in xtiger.editor.Plugin.prototype.pluginEditors){n.push(m)}return n}}($axel));(function(b){var c={};function h(l,n){if(!n){xtiger.cross.log("error",'filter "'+l+'" is undefined');return n}var j={},m=l;n.registerFilter=function o(q,p){if(typeof(p)==="object"){if(j[q]){xtiger.cross.log("warning",'"'+m+'" plugin: filter "'+q+'" is already registred. Overwriting it.')}j[q]=p}};n.applyFilters=function i(p,r){var A={},s=r.split(" "),z=p,x,v,w,q;for(w=0;w<s.length;w++){var u=z;var y=j[s[w]];if(!y){xtiger.cross.log("warning",'"'+m+'" plugin: missing filter "'+s[w]+'"');continue}x=function(){};x.prototype=u;z=new x();if(y){v=y["->"];if(v){for(q in v){if(A[q]===undefined||A[q]!==v[q]){if(v[q]===null){z[q]=null}else{z[v[q]]=u[q]||function(){}}}}}xtiger.util.mixin(z,y)}}return z};return n}function g(j,i){if(c[j]){xtiger.cross.log("error",'attempt to register filter "'+j+'" more than once')}else{c[j]=i}}function e(){var i,j=[];for(i in c){j.push(i)}return j}function d(j){var l,m,i,n;for(l in j){m=c[l];i=j[l];i=(typeof i==="string")?[i]:i;if(m){while(i.length>0){n=i.shift();if(xtiger.editor.Plugin.prototype.pluginEditors[n]){xtiger.editor.Plugin.prototype.pluginEditors[n].registerFilter(l,m)}else{xtiger.cross.log("error",'attempt to register filter "'+l+'" on unkown plugin "'+n+'"')}}}else{xtiger.cross.log("error",'attempt to register unkown filter "'+l+'" on plugin(s) "'+i.join(",")+'"')}}}xtiger.util.filterable=h;b.filter=b.filter||{};b.filter.register=g;b.filter.applyTo=d;b.filter.list=e}($axel));xtiger.util.Logger=function(){this.errors=[]};xtiger.util.Logger.prototype={inError:function(){return(this.errors.length>0)},logError:function(e,d){if(e.indexOf("$$$")!=-1){var b=d.match(/([^\/]*)$/);var c=b?b[1]:d;this.errors.push(e.replace("$$$",'"'+c+'"'))}else{this.errors.push(e)}},printErrors:function(){return this.errors.join(";")}};xtiger.util.fileDialog=function(l,h,j){var c;try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect")}catch(i){alert("Permission to get enough privilege was denied.");return false}var g=Components.interfaces.nsIFilePicker;c=Components.classes["@mozilla.org/filepicker;1"].createInstance(g);if(h){c.appendFilter("My filter",h)}var b;if(l=="open"){b=g.modeOpen}else{if(l=="save"){b=g.modeSave}else{b=g.modeGetFolder}}c.init(window,j,b);var d=c.show();if((d==g.returnOK)||(d==g.returnReplace)){return c.file.path}else{return false}};xtiger.debug={};xtiger.debug.loadDocument=function(d,c){if(window.navigator.appName=="Microsoft Internet Explorer"){var g;try{var b=new ActiveXObject("MSXML2.DOMDocument.6.0");b.async=false;b.resolveExternals=false;b.validateOnParse=false;b.setProperty("ProhibitDTD",false);b.load(d);if(b.parseError.errorCode!=0){g=b.parseError+" "+b.parseError.reason}else{return b}}catch(h){g=h.name}if(g){if(c){c.logError("Error while loading $$$ : "+g,d)}else{alert("ERROR:"+g)}b=null}}else{return xtiger.cross.loadDocument(d,c)}return false};xtiger.editor.Generator=function(b){if(b){xtiger.resources.setBase(b)}this.plugins=new xtiger.editor.Plugin()};xtiger.editor.LABEL_MARK=0;xtiger.editor.REPEAT_MARK=1;xtiger.editor.CHOICE_MARK=2;xtiger.editor.Generator.prototype={markerNames:["xttOpenLabel","xttCloseLabel","startRepeatedItem","endRepeatedItem","beginChoiceItem","endChoiceItem"],isBoundarySafe:function(c){if(!c){alert("Empty node in transformation, the template may contain XHTML errors, please correct it !");return false}if(xtiger.cross.UA.IE&&(c.nodeType!=xtdom.ELEMENT_NODE)){return false}for(var b=0;b<this.markerNames.length;b++){if(c[this.markerNames[b]]){return false}}if((c.nodeType==xtdom.ELEMENT_NODE)&&(c.nodeName.search("menu-marker")!=-1)){return false}return true},verifyBoundaries:function(c,e){var d;if(!this.isBoundarySafe(c.firstChild)){d=xtdom.createElement(this.curDoc,"span");xtdom.addClassName(d,"axel-core-boundary")}if(!this.isBoundarySafe(c.lastChild)){var b=xtdom.createElement(this.curDoc,"span");xtdom.addClassName(b,"axel-core-boundary");c.appendChild(b)}if(d){c.insertBefore(d,c.firstChild)}},getNodeFromOpaqueContext:function(b){xtiger.cross.log("warning",'unexpected call to "getNodeFromOpaqueContext" in "generator.js"');return b},saveContext:function(b,c){if(xtdom.isUseXT(b)||xtdom.isBagXT(b)){this.context.push(b)}},restoreContext:function(b){if(xtdom.isUseXT(b)||xtdom.isBagXT(b)){this.context.pop()}},pushContext:function(b){this.context.push(b)},popContext:function(){return this.context.pop()},savePendingEditor:function(b,d){var c=this.popContext();this.pushContext([c,[b,d]])},getPendingEditor:function(){if(this.context.length>0){var b=this.context[this.context.length-1];if(b instanceof Array){return b[1]}}return false},peekTopContext:function(){var b=this.context[this.context.length-1];return(b instanceof Array?b[0]:b)},coupleWithIterator:function(c){this.iterator=c;var b=new Array("string","number","boolean");c.defineUnion("anySimple",b)},prepareForIteration:function(c,d,b){this.context=[];this.curDoc=d;this.headLabel=b;if(!d){alert("You must specify a document to prepareForIteration !")}},genComponentBody:function(c,b){},genComponentContent:function(c,b,d){xtdom.moveChildOfInto(c,b,d)},finishComponentGeneration:function(m,c){var d=this.getPendingEditor();if(d){var j=d[0];this.verifyBoundaries(c,xtiger.editor.CHOICE_MARK);var b=m.getAttribute("name");j.addChoiceItem(b,c.firstChild,c.lastChild);var o=m.getAttribute("i18n");if(o){var e=d[1];var p=e.getElementsByTagName("option");for(var g=0;g<p.length;g++){var n=p.item(g).firstChild;if(n.data==b){n.data=o;break}}}}if(c.querySelector){var l=c.querySelector("select[class]");if(l){var h=l.getAttribute("class");menuMarker=xtdom.getMenuMarkerXT(c,h);if(menuMarker){menuMarker.parentNode.replaceChild(l,menuMarker)}}}},genRepeatBody:function(c,b){},genRepeatContent:function(c,b,d){xtdom.moveChildOfInto(c,b,d)},finishRepeatGeneration:function(c,b){this.verifyBoundaries(b,xtiger.editor.REPEAT_MARK);var d=new xtiger.editor.Repeat();d.initFromTree(b,c,this.curDoc)},genIteratedTypeBody:function(g,u,b,m){var e,v,r;if(m.length>1){var y=e=xtdom.createElement(this.curDoc,"select");for(var j=0;j<m.length;j++){var d=xtdom.createElement(this.curDoc,"option");var x=xtdom.createTextNode(this.curDoc,m[j]);d.appendChild(x);y.appendChild(d)}var l=u.getAttribute("param");if(l){var j=l.indexOf("=");if(j!=-1){v=l.substr(0,j);r=l.substr(j+1)}}if((v=="name")&&r){xtdom.addClassName(e,r)}else{if((v="marker")&&r){var q=xtdom.createElement(this.curDoc,"span");xtdom.addClassName(q,r);var h=xtdom.createElementNS(this.curDoc,"menu-marker",xtiger.parser.nsXTiger);q.appendChild(h);var w=xtdom.createElement(this.curDoc,"br");q.appendChild(w);q.appendChild(e);e=q}}b.appendChild(e);var n=new xtiger.editor.Choice();var p=xtdom.getTagNameXT(u);if(p&&(p.indexOf(" ")!=-1)){n.initFromTree(y,p.split(" "),this.curDoc)}else{n.initFromTree(y,m,this.curDoc)}this.savePendingEditor(n,y);n.awake(y);xtiger.cross.log("plant","Created a Choice editor for types /"+m+"/")}},genIteratedTypeContent:function(e,q,c,n,l){var j;if(j=this.plugins.getEditorFor(q,l)){var d=j.createModel(c,q,this.curDoc);var b=("attribute"===e)?q:this.peekTopContext();d.xttPrimitiveEditor=j.createEditorFromTree(d,b,this.curDoc)}else{for(var h=0;h<l.length;h++){var o=this.iterator.getComponentForType(l[h]);if(o){var m=o.getClone(this.curDoc);c.appendChild(m);n.push(m)}else{var p=xtdom.createElement(this.curDoc,"span");xtdom.addClassName(p,"axel-generator-error");var g=xtdom.createTextNode(this.curDoc,'ERROR: "'+l[h]+'" is undeclared or is terminal and part of a choice');p.appendChild(g);c.appendChild(p)}}}},finishIteratedTypeGeneration:function(h,g,b,e){var d=xtdom.getTagNameXT(g);if(!d){return}if(d.indexOf(" ")!=-1){return}if("attribute"===h){d="@"+d}if(!b.firstChild){xtiger.cross.log("warning",'XTiger component (label="'+d+'") definition is empty');return}this.verifyBoundaries(b,xtiger.editor.USE_MARK);xtiger.cross.log("plant","Planting use Start & End labels for "+d);if(b.firstChild.xttOpenLabel){xtiger.cross.log("warning",'use "'+d+'" and use "'+b.firstChild.xttOpenLabel+'" with same START !')}var c=g.getAttribute("flow");if(c){d="!"+c+"!"+d}b.firstChild.xttOpenLabel=d;if(b.lastChild.xttCloseLabel){xtiger.cross.log("warning",'use "'+d+'" and use "'+b.lastChild.xttCloseLabel+'" with same END !')}b.lastChild.xttCloseLabel=d},finishTransformation:function(c){var b=xtiger.cross.makeTreeWalker(c,xtdom.NodeFilter.SHOW_ELEMENT,function(d){return(d.markChoiceEditor)?xtdom.NodeFilter.FILTER_ACCEPT:xtdom.NodeFilter.FILTER_SKIP});while(b.nextNode()){if(b.currentNode.markChoiceEditor){b.currentNode.markChoiceEditor.initializeSelectedItem(0)}}},loadData:function(d,e,b){var c=b||this.defaultLoader;if(c){c.loadData(d,e)}else{alert("Default XML loader missing !")}},serializeData:function(b,c,e){var d=e?e:this.defaultSerializer;if(d){d.serializeData(b,c,this.headLabel)}else{alert("Default XML serializer missing !")}}};xtiger.editor.Repeat=function(){this.items=[];this.curDoc=null;this.originPosition=-1;this.tickCount=0};xtiger.editor.Repeat.autoSelectRepeatIter=function(d){var c;var e=d;var b=0;var g=0;while(e){if(e.startRepeatedItem){b++}if((e!=d)&&e.endRepeatedItem){g++}if(b>g){c=e.startRepeatedItem;if((0==c.min)&&(0==c.total)){c.unsetOption()}e=c.getFirstNodeForSlice(0);b=g=0}e=e.previousSibling}if(d.parentNode){xtiger.editor.Repeat.autoSelectRepeatIter(d.parentNode)}};xtiger.editor.Repeat.prototype={trash:[],hasLabel:function(){return(this.label!="repeat")},getRepeatableLabel:function(){return this.pseudoLabel},dump:function(){return this.label},getSize:function(){return this.total},getOriginPosition:function(){return this.originPosition},getClockCount:function(){return this.tickCount},getLastNodeForSlice:function(b){var c=(b<this.items.length)?b:this.items.length-1;return this.items[c][1]},getFirstNodeForSlice:function(c,b){var d;if(c<this.items.length){d=c}else{if(b&&(c==this.items.length)){this.appendSlice()}d=this.items.length-1}return this.items[d][0]},getSliceIndexForStartMarker:function(c){for(var b=0;b<this.items.length;b++){if(this.items[b][0]==c){return b}}return -1},makeSeed:function(c,e){if(this==c){xtiger.cross.log("clone-trace","*repeater* do not replicate top/master repeater",this.seed[3])}else{if(this.seed){if(this.seed[0]==-2){var b=e[this.seed[3]];if(!b){var d=xtdom.genId();xtiger.cross.log("clone-trace","*repeater* remaps a non top/master repeater",d);b=[-1,this.seed[1],this.seed[2],d,this.min,this.max,this.pseudoLabel];e[this.seed[3]]=b}return b}else{xtiger.cross.log("debug","*repeater* [should not happen] seed "+this.seed[3]+" already mapped as "+this.seed[0])}}else{var d=xtdom.genId();xtiger.cross.log("debug","*repeater*  [should not happen] making a entirely repeater seed",d);this.seed=[-1,c.label,c.model,d,this.min,this.max,this.pseudoLabel]}}return this.seed},initFromSeed:function(c,b){this.curDoc=b;this.label=c[1];this.model=c[2];this.min=c[4];this.max=c[5];this.pseudoLabel=c[6];this.total=(this.min>0)?1:0;this.items=[[null,null,null,null]]},setStartItem:function(b){this.items[0][0]=b},setEndItem:function(b){this.items[0][1]=b},setMarkItem:function(b){if(this.items[0][2]){this.items[0][3]=b}else{this.items[0][2]=b}var c=this;xtdom.addEventListener(b,"click",function(d){c.handleRepeat(d)},true);xtiger.cross.log("iter-trace","setMarkItem for repeater "+this.dump()+" on node "+b.tagName)},configureMenuForSlice:function(c){if(c>=this.items.length){xtiger.cross.log("error","Wrong menu configuration in repeater "+this.dump());return}var d=this.items[c][2];var e=this.items[c][3];var g=xtiger.bundles.repeat.checkedIconURL;if(0==this.min){if(0==this.total){g=xtiger.bundles.repeat.uncheckedIconURL}else{if(1==this.total){g=xtiger.bundles.repeat.checkedIconURL}else{g=xtiger.bundles.repeat.minusIconURL}}}else{if(this.total==this.min){g=xtiger.bundles.repeat.plusIconURL}else{g=xtiger.bundles.repeat.minusIconURL}}xtdom.setAttribute(d,"src",g);xtdom.setAttribute(e,"src",xtiger.bundles.repeat.plusIconURL);var b=false;if(0==this.min){if(((this.max>1)||(-1==this.max))&&(this.total>0)){b=true}}else{if((this.total>1)&&((this.max>1)||(-1==this.max))){b=true}}if(b){xtdom.removeClassName(e,"axel-core-off")}else{xtdom.addClassName(e,"axel-core-off")}},initFromTree:function(e,l,n){this.curDoc=n;this.label=l.getAttribute("label")||"repeat";this.pseudoLabel=l.getAttribute("pseudoLabel")||"repeat";var h=l.getAttribute("minOccurs")||0;this.min=isNaN(h)?1:parseInt(h);h=l.getAttribute("maxOccurs")||-1;this.max=isNaN(h)?-1:parseInt(h);this.total=(this.min>0)?1:0;xtiger.cross.log("plant","Create Repeat Editor "+this.min+"/"+this.max+"/"+this.label);var j=xtdom.createElement(this.curDoc,"img");var g="16";var i;if(i=xtdom.getMenuMarkerXT(e)){i.parentNode.replaceChild(j,i);g=i.getAttribute("size")||g}else{var d=0;var o=e.firstChild;while(o){if(o.nodeType==xtdom.ELEMENT_NODE){var c=o.className;if(c&&(-1!=c.indexOf("xtt-auto-wrapped"))){if(d==0){i=o}d++}}o=o.nextSibling}if(d==1){i.appendChild(j)}else{e.appendChild(j)}}xtdom.setAttribute(j,"width",g);xtdom.addClassName(j,"axel-repeat-right");var b=xtdom.createElement(this.curDoc,"img");xtdom.setAttribute(b,"width",g);xtdom.addClassName(b,"axel-repeat-left");j.parentNode.insertBefore(b,j,false);start=e.firstChild;end=e.lastChild;if(start.startRepeatedItem){xtiger.cross.log("warning",'Repeat "'+this.label+'" and repeat "'+start.startRepeatedItem.label+'" with same START boundaries !')}start.startRepeatedItem=this;if(end.endRepeatedItem){xtiger.cross.log("warning",'Repeat "'+this.label+'" and repeat "'+end.endRepeatedItem.label+'" with same END boundaries !')}end.endRepeatedItem=this;b.markRepeatedEditor=this;j.markRepeatedEditor=this;if(start.xttOpenLabel){xtiger.cross.log("warning",'Repeat "'+this.label+'" and use with same START boundaries !')}if(end.xttCloseLabel){xtiger.cross.log("warning",'Repeat "'+this.label+'" and use with same END boundaries !')}var m=this;xtdom.addEventListener(b,"click",function(p){m.handleRepeat(p)},true);xtdom.addEventListener(j,"click",function(p){m.handleRepeat(p)},true);this.model=this.shallowClone(e);this.items.push([start,end,b,j]);this.configureMenuForSlice(0);if(0==this.min){this.unactivateSliceAt(0)}},shallowFinishCloning:function(d,b,c){if(b.xttOpenLabel){d.xttOpenLabel=b.xttOpenLabel}if(b.xttCloseLabel){d.xttCloseLabel=b.xttCloseLabel}if(b.markRepeatedEditor){d.markRepeatedEditor=b.markRepeatedEditor.makeSeed(this,c)}if(b.startRepeatedItem){d.startRepeatedItem=b.startRepeatedItem.makeSeed(this,c)}if(b.endRepeatedItem){d.endRepeatedItem=b.endRepeatedItem.makeSeed(this,c)}if(b.markChoiceEditor){d.markChoiceEditor=b.markChoiceEditor.makeSeed()}if(b.beginChoiceItem){d.beginChoiceItem=b.beginChoiceItem.makeSeed()}if(b.endChoiceItem){d.endChoiceItem=b.endChoiceItem.makeSeed()}if(b.xttPrimitiveEditor){d.xttPrimitiveEditor=b.xttPrimitiveEditor.makeSeed()}if(b.xttService){d.xttService=b.xttService.makeSeed()}},shallowClone:function(c){var e={};var d=xtdom.cloneNode(this.curDoc,c,false);this.seed=[-2,this.label,d,xtdom.genId(),this.min,this.max,this.pseudoLabel];this.shallowFinishCloning(d,c,e);for(var b=0;b<c.childNodes.length;b++){this.shallowCloneIter(d,c.childNodes[b],e)}return d},shallowCloneIter:function(c,d,g){var e=xtdom.cloneNode(this.curDoc,d,false);this.shallowFinishCloning(e,d,g);c.appendChild(e);for(var b=0;b<d.childNodes.length;b++){this.shallowCloneIter(e,d.childNodes[b],g)}},getChoiceEditorClone:function(d,c){var b=d[c];if(!b){var b=new xtiger.editor.Choice();b.initFromSeed(c,this.curDoc);d[c]=b}return b},getRepeatEditorClone:function(d,c){var b=d[c[3]];if(!b){var b=new xtiger.editor.Repeat();b.initFromSeed(c,this.curDoc);d[c[3]]=b;xtiger.cross.log("stack-trace","cloning repeat editor",b.dump(),"("+c[3]+")")}return b},deepFinishCloning:function(i,c,l,b,j){if(c.xttOpenLabel){i.xttOpenLabel=c.xttOpenLabel}if(c.xttCloseLabel){i.xttCloseLabel=c.xttCloseLabel}if(c.startRepeatedItem){if(c.startRepeatedItem[0]==-1){var d=this.getRepeatEditorClone(l[0],c.startRepeatedItem);d.setStartItem(i);i.startRepeatedItem=d}else{i.startRepeatedItem=this;j[0]=i}}if(c.endRepeatedItem){if(c.endRepeatedItem[0]==-1){var d=this.getRepeatEditorClone(l[0],c.endRepeatedItem);d.setEndItem(i);i.endRepeatedItem=d}else{i.endRepeatedItem=this;j[1]=i}}if(c.markRepeatedEditor){if(c.markRepeatedEditor[0]==-1){var d=this.getRepeatEditorClone(l[0],c.markRepeatedEditor);d.setMarkItem(i);i.markRepeatedEditor=d}else{i.markRepeatedEditor=this;var h=this;xtdom.addEventListener(i,"click",function(m){h.handleRepeat(m)},true);if(j[2]){j[3]=i}else{j[2]=i}}}if(c.markChoiceEditor){var d=this.getChoiceEditorClone(l[1],c.markChoiceEditor);d.setChoiceMenu(i);i.markChoiceEditor=d}if(c.beginChoiceItem){var d=this.getChoiceEditorClone(l[1],c.beginChoiceItem);d.setBeginChoiceItem(i);i.beginChoiceItem=d}if(c.endChoiceItem){var d=this.getChoiceEditorClone(l[1],c.endChoiceItem);d.setEndChoiceItem(i);i.endChoiceItem=d}if(c.xttPrimitiveEditor){var g=c.xttPrimitiveEditor;var e=g[0];i.xttPrimitiveEditor=e.createEditorFromSeed(g,i,this.curDoc,this)}if(c.xttService){var g=c.xttService;var e=g[0];i.xttService=e.createServiceFromSeed(g,i,this.curDoc,this)}},deepClone:function(c,e){var g=xtdom.cloneNode(this.curDoc,c,false);var d=[{},{}];this.deepFinishCloning(g,c,d,this,e);for(var b=0;b<c.childNodes.length;b++){this.deepCloneIter(g,c.childNodes[b],d,this,e)}return g},deepCloneIter:function(c,d,g,e,h){if(d.xttPrimitiveEditor){var j=xtdom.cloneNode(this.curDoc,d,true);c.appendChild(j);this.deepFinishCloning(j,d,g,e,h);return}var j=xtdom.cloneNode(this.curDoc,d,false);c.appendChild(j);this.deepFinishCloning(j,d,g,e,h);for(var b=0;b<d.childNodes.length;b++){this.deepCloneIter(j,d.childNodes[b],g,e,h)}},getOneCopy:function(c,b){this.tickCount++;return this.deepClone(this.model,c)},reset:function(){var c=this.min+1;for(var b=c;b<this.total;b++){this.removeItemAtIndex(b,false)}this.total=this.min;this.configureMenuForSlice(0)},plantSlice:function(c,b){if(this.items.length==1){xtdom.removeClassName(this.items[0][2],"axel-core-off")}this.items.splice(b+1,0,c)},sliceLoaded:function(){this.total++;if((0==this.min)&&(1==this.total)){this.activateSliceAt(0)}if(((0==this.min)&&(2==this.total))||((this.min>0)&&(this.total==(this.min+1)))){for(var b=0;b<=this.min;b++){this.configureMenuForSlice(b)}}this.configureMenuForSlice(this.total-1)},appendSlice:function(){var e=this.items.length-1;var c=this.getLastNodeForSlice(e);var b=[null,null,null,null];this.originPosition=-1;var d=this.getOneCopy(b);xtdom.moveChildrenOfAfter(d,c);this.plantSlice(b,e);this.dispatchEvent(b,"duplicate");return e+1},handleRepeat:function(d){var c=false;var e=xtdom.getEventTarget(d);for(var b=0;b<this.items.length;b++){if(this.items[b][2]==e){if((0==this.min)&&(0==this.total)){this.unsetOption();c=true}else{if((this.min>0)&&(1==this.total)){this.addItem(e,b,d.shiftKey);c=true}else{if((0==this.min)&&(1==this.total)){this.setOption()}else{this.deleteItem(e,b,d.shiftKey)}}}break}else{if(this.items[b][3]==e){this.addItem(e,b,d.shiftKey);c=true;break}}}if(c){xtiger.editor.Repeat.autoSelectRepeatIter(this.getFirstNodeForSlice(0))}},unsetOption:function(){this.total++;this.configureMenuForSlice(0);this.activateSliceAt(0)},activateNodeIter:function(b,c){if((!c)||(c.total>=1)){xtdom.removeClassName(b,"axel-repeat-unset")}},activateSliceAt:function(b){this.mapFuncToSliceAt(xtiger.editor.Repeat.prototype.activateNodeIter,b,false)},setOption:function(){this.total--;this.configureMenuForSlice(0);this.unactivateSliceAt(0)},unactivateNodeIter:function(b,c){xtdom.addClassName(b,"axel-repeat-unset")},unactivateSliceAt:function(b){this.mapFuncToSliceAt(xtiger.editor.Repeat.prototype.unactivateNodeIter,b,true)},callPrimitiveEditors:function(d,b){var c=xtiger.cross.makeTreeWalker(d,xtdom.NodeFilter.SHOW_ELEMENT,function(e){if(e.xttPrimitiveEditor&&e.xttPrimitiveEditor.can(b)){return xtdom.NodeFilter.FILTER_ACCEPT}else{return xtdom.NodeFilter.FILTER_SKIP}});while(c.nextNode()){c.currentNode.xttPrimitiveEditor.execute(b,this)}},dispatchEvent:function(d,b){var c=d[0];do{this.callPrimitiveEditors(c,b);c=c.nextSibling}while(c&&(c!=d[1]))},addItem:function(d,h,j){var m,l,e,c,o,g;var b=this.items[h];if(j){for(g=0;g<this.trash.length;g++){if(this.trash[g][0]==this){m=this.trash[g];break}}}this.originPosition=h;if(m){o=m[2];l=m[1];xtdom.moveNodesAfter(l,b[1]);this.trash.splice(g,1)}else{o=[null,null,null,null];c=this.getOneCopy(o,h);xtdom.moveChildrenOfAfter(c,b[1])}this.originPosition=-1;this.plantSlice(o,h);this.total++;if(0==h){this.configureMenuForSlice(0)}this.configureMenuForSlice(h+1);this.configureMenuForSlice(this.total-1);this.dispatchEvent(o,"duplicate")},deleteItem:function(d,b,c){this.removeItemAtIndex(b,c);if(this.total<=1){this.configureMenuForSlice(0)}else{this.configureMenuForSlice(this.total-1)}},removeItemAtIndex:function(b,d){var h,e;this.originPosition=b;var c=this.items[b];var g=d?[]:null;if(c[0]==c[1]){if(d){g.push(c[0])}this.callPrimitiveEditors(c[0],"remove");c[0].parentNode.removeChild(c[0])}else{this.dispatchEvent(c,"remove");e=c[0].nextSibling;if(d){g.push(c[0])}c[0].parentNode.removeChild(c[0]);while(e&&(e!=c[1])){h=e;e=e.nextSibling;if(d){g.push(h)}c[1].parentNode.removeChild(h)}if(d){g.push(c[1])}c[1].parentNode.removeChild(c[1])}this.originPosition=-1;this.items.splice(b,1);if(d){this.trash.push([this,g,c])}this.total--},mapFuncToSliceAt:function(c,b){var i,h,g,e;var d=0;h=this.items[b];i=h[0];g=null;if(h[0]==h[1]){if(xtdom.ELEMENT_NODE==i.nodeType){c.call(this,i,g)}}else{while(i&&(i!=h[1])){if(i.startRepeatedItem&&(i.startRepeatedItem!=this)){if(g){if(!e){e=[g]}else{e.push(g)}}g=i.startRepeatedItem;if(i.endRepeatedItem&&(i.endRepeatedItem==i.startRepeatedItem)){if(!e){e=[g]}else{e.push(g)}}}if(i.endRepeatedItem&&(i.endRepeatedItem!=this)){if(e&&(e.length>0)){g=e.pop()}else{g=null}}if(xtdom.ELEMENT_NODE==i.nodeType){c.call(this,i,g)}i=i.nextSibling}}}};xtiger.resources.addBundle("repeat",{plusIconURL:"plus.png",minusIconURL:"minus.png",uncheckedIconURL:"unchecked.png",checkedIconURL:"checked.png"});xtiger.editor.Choice=function(){this.items=[];this.curItem=-1;this.curDoc=null;xtiger.editor.Choice.prototype.UID++};xtiger.editor.Choice.prototype={UID:0,initFromTree:function(d,b,c){this.curDoc=c;this.menu=d;d.markChoiceEditor=this;this.types=b},getTypes:function(){return this.types},getSelectedChoiceName:function(){return this.types[this.curItem]},makeSeed:function(){if(!this.seed){this.seed=[this.items.length,this.types,xtiger.editor.Choice.prototype.UID]}return this.seed},initFromSeed:function(b,c){this.curDoc=c;this.expectedLength=b[0];this.types=b[1]},setChoiceMenu:function(b){this.menu=b;this.awake(b)},setBeginChoiceItem:function(b){this.items.push([b,null])},setEndChoiceItem:function(b){this.items[this.items.length-1][1]=b;if(this.items.length==this.expectedLength){xtiger.cross.log("stack-trace","Choice initialization terminated after cloning, size="+this.expectedLength);this.initializeSelectedItem(0)}},awake:function(b){var c=this;xtdom.addEventListener(b,"change",function(d){c.handleSelect(d)},false);if(xtiger.cross.UA.IE){this.handleMouseEnter=function(d){var e=xtdom.getEventTarget(d).parentNode;while(e&&((!e.className)||e.className.search("ie-select-hack")===-1)){e=e.parentNode}if(e){xtdom.addClassName(e,"hover")}else{xtdom.removeEventListener(b,"mouseenter",c.handleMouseEnter,false)}};this.handleMouseLeave=function(d){var e=xtdom.getEventTarget(d).parentNode;while(e&&((!e.className)||e.className.search("ie-select-hack")===-1)){e=e.parentNode}if(e){xtdom.removeClassName(e,"hover")}else{xtdom.removeEventListener(b,"mouseleave",c.handleMouseEnter,false)}};xtdom.addEventListener(b,"mouseenter",this.handleMouseEnter,false);xtdom.addEventListener(b,"mouseleave",this.handleMouseLeave,false)}},addChoiceItem:function(c,d,b){this.items.push([d,b]);if(d.beginChoiceItem){xtiger.cross.log("warning","Choice <",c,"> ends with an already existing choice")}if(b.endChoiceItem){xtiger.cross.log("warning","Choice <",c,"> ends with an already existing choice end")}d.beginChoiceItem=this;b.endChoiceItem=this},initializeSelectedItem:function(j){for(var d=0;d<this.items.length;d++){var c=[];var g=this.items[d];var e=g[0];var b=g[1];var h=e;c.push(xtdom.getInlineDisplay(h));if(d!=j){if(h.nodeType==xtdom.ELEMENT_NODE){h.style.display="none"}}while(h!=b){h=h.nextSibling;c.push(xtdom.getInlineDisplay(h));if(d!=j){if(h.nodeType==xtdom.ELEMENT_NODE){h.style.display="none"}}}g.push(c)}this.curItem=j},selectChoiceItem:function(j){xtiger.cross.log("plant","Choice.selectChoiceItem "+j);if(this.curItem==j){return}if(this.curItem!=-1){var g=this.items[this.curItem];var e=g[0];var b=g[1];var c=[];var h=e;c.push(xtdom.getInlineDisplay(h));if(h.nodeType==xtdom.ELEMENT_NODE){h.style.display="none"}while(h!=b){h=h.nextSibling;c.push(xtdom.getInlineDisplay(h));if(h.nodeType==xtdom.ELEMENT_NODE){h.style.display="none"}}g[2]=c}var g=this.items[j];var e=g[0];var b=g[1];var c=g[2];var d=0;var h=e;if(h.nodeType==xtdom.ELEMENT_NODE){h.style.display=c[d]}while(h!=b){d++;h=h.nextSibling;if(h.nodeType==xtdom.ELEMENT_NODE){h.style.display=c[d]}}this.curItem=j},selectChoiceForName:function(b){var c;for(c=0;c<this.types.length;c++){if(this.types[c]==b){break}}if(c!=this.types.length){this.selectChoiceItem(c);xtdom.setSelectedOpt(this.menu,c);return c}else{return this.curItem}},handleSelect:function(c){var b=xtdom.getSelectedOpt(this.menu);this.selectChoiceItem(b)}};xtiger.editor.Keyboard=function(){this.tabGroupManager=false;this.currentDevice=false;this.allowRC=false};xtiger.editor.Keyboard.prototype={setTabGroupManager:function(b){this.tabGroupManager=b},register:function(d,e){var b=e?e:d.getHandle();var h=this;var g=d;var c={keydown:function(i){h.handleKeyDown(i,g)},keyup:function(i){h.handleKeyUp(i,g)}};xtdom.addEventListener(b,"keydown",c.keydown,false);xtdom.addEventListener(b,"keyup",c.keyup,false);return c},unregister:function(d,c,e){var b=e?e:d.getHandle();xtdom.removeEventListener(b,"keydown",c.keydown,false);xtdom.removeEventListener(b,"keyup",c.keyup,false)},handleKeyDown:function(c,b){if(b.isEditing()){if(this.tabGroupManager){this.tabGroupManager.filterKeyDown(c)}var d=(this.allowRC&&(c.keyCode==13)&&(!c.shiftKey))||((!this.allowRC)&&(c.keyCode==13));if(d){b.stopEditing(false);xtdom.preventDefault(c)}else{if(c.keyCode==27){b.cancelEditing()}}b.doKeyDown(c)}},handleKeyUp:function(c,b){if(b.isEditing()){if(this.tabGroupManager&&this.tabGroupManager.filterKeyPress(c)){xtdom.preventDefault(c);xtdom.stopPropagation(c)}else{b.doKeyUp(c)}}},grab:function(c,b){if(this.tabGroupManager){this.tabGroupManager.startEditingSession(b)}},release:function(c,b){if(this.tabGroupManager){this.tabGroupManager.stopEditingSession()}},enableRC:function(){this.allowRC=true},disableRC:function(){this.allowRC=false}};xtiger.editor.TabGroupManager=function(b){this.root=b;this.isChangingFocus=false;this.direction=0};xtiger.editor.TabGroupManager.prototype={startEditingSession:function(b){if(this.isChangingFocus){return}this.tabs=[];var c=xtiger.cross.makeTreeWalker(this.root,xtdom.NodeFilter.SHOW_ELEMENT,function(d){if(d.xttPrimitiveEditor&&d.xttPrimitiveEditor.isFocusable()){return xtdom.NodeFilter.FILTER_ACCEPT}else{return xtdom.NodeFilter.FILTER_SKIP}});while(c.nextNode()){this.tabs.push(c.currentNode.xttPrimitiveEditor)}this.curEditor=b},stopEditingSession:function(){if(this.isChangingFocus){return}this.tabs=undefined;this.curEditor=undefined},filterKeyDown:function(b){this.direction=0;if(b.keyCode==9){if(xtiger.cross.UA.gecko){this.direction=b.shiftKey?-1:1}else{this._focusNextInput(b.shiftKey?-1:1)}try{xtdom.preventDefault(b);xtdom.stopPropagation(b)}catch(c){}return true}else{return false}},filterKeyPress:function(b){if(xtiger.cross.UA.gecko&&(this.direction!=0)){return(this._focusNextInput(this.direction))}return false},_focusNextInput:function(e){var c=false;if(!this.tabs){return}for(var b=0;b<this.tabs.length;b++){if(this.tabs[b]==this.curEditor){break}}if(b<this.tabs.length){var d;if((b+e)<0){d=this.tabs.length-1}else{d=(b+e)%this.tabs.length}this.isChangingFocus=true;this.tabs[b].unfocus();this.tabs[d].focus();this.isChangingFocus=false;this.curEditor=this.tabs[d];c=true}this.direction=0;return c}};xtiger.editor.StringModel=function(){};xtiger.editor.StringModel.prototype={createModel:function(c,i,g){var b=i.getAttribute("wrapper");var o=xtdom.createElement(g,"span");var j=xtdom.createTextNode(g,"");var m=xtdom.createElement(g,"input");o.appendChild(j);xtdom.addClassName(o,"axel-core-on");xtdom.addClassName(o,"axel-core-editable");xtdom.addClassName(m,"axel-core-off");var e=b&&("embedded"!=b);if(e){var n=b;if("auto"==b){n=i.getAttribute("types")}var l=xtdom.createElement(g,n);if("auto"==b){xtdom.addClassName(l,"xtt-auto-wrapped")}l.appendChild(o);l.appendChild(m);c.appendChild(l)}else{c.appendChild(o);c.appendChild(m)}var h=i.getAttribute("option");if(h){var d=xtdom.createElement(g,"input");xtdom.setAttribute(d,"type","checkbox");xtdom.addClassName(d,"axel-option-checkbox");o.parentNode.insertBefore(d,o)}return m},createEditorFromTree:function(e,c,d){var b,h,i,g=xtdom.extractDefaultContentXT(c);if(h){b=h.match(/^\s*\<.*\>(.*?)\<\/\w*\>\s*$/);if(b){h=b[1]}}i=c.getAttribute("param");g=new xtiger.editor.String();g.initFromTree(e,d,h,i,c.getAttribute("option")||false);return g},createEditorFromSeed:function(b,e,c){var d=new xtiger.editor.String();d.initFromSeed(b,e,c);return d}};xtiger.editor.String=function(){this.defaultContent=null;this.param=null;this.isOptional=null;this.isSelected=false;this.doEdit=false;var b=this;this.lostFocusHandler=function(c){b.unfocus()}};xtiger.editor.String.prototype={isEditing:function(){return this.doEdit},startEditing:function(b,d){var c=this.editor.value.length;this.doEdit=true;this.keyboard.grab(this,this);xtdom.setAttribute(this.editor,"size",c+Number(this.param.lookahead));xtdom.replaceClassNameBy(this.handle,"axel-core-on","axel-core-off");xtdom.replaceClassNameBy(this.editor,"axel-core-off","axel-core-on");if(d||(this.editor.value==this.defaultContent)){xtdom.focusAndSelect(this.editor)}else{xtdom.focusAndMoveCaretTo(this.editor,c)}xtdom.addEventListener(this.editor,"blur",this.lostFocusHandler,true)},stopEditing:function(g,e,b){this.doEdit=false;var c=e||this.editor.value;if(c.search(/\S/)==-1){c=this.defaultContent}var d=(c!=this.defaultContent);this.setData(c);xtdom.replaceClassNameBy(this.handle,"axel-core-off","axel-core-on");xtdom.replaceClassNameBy(this.editor,"axel-core-on","axel-core-off");this.keyboard.release(this,this);xtdom.removeEventListener(this.editor,"blur",this.lostFocusHandler,true);if((!b)&&d){if((this.isOptional)&&(!this.isSelected)){this.setSelectionState(true)}xtiger.editor.Repeat.autoSelectRepeatIter(this.getHandle())}if(!d){this.setSelectionState(false)}if(xtiger.cross.UA.IE){this.editor.blur()}},cancelEditing:function(){this.stopEditing(false,this.dump(),true)},doKeyDown:function(b){},doKeyUp:function(b){},getHandle:function(b){return this.editor},decodeParameters:function(c,g){var e=g.split(";");for(var b=0;b<e.length;b++){var d=e[b].split("=");if(d.length==2){c[d[0]]=d[1]}}},initFromTree:function(c,g,b,e,d){this.param={lookahead:2};this.curDoc=g;this.handle=c.previousSibling;this.editor=c;this.defaultContent=b||"click to edit";if(e){this.decodeParameters(this.param,e)}if(d){this.isOptional=d.toLowerCase()}this.awake()},awake:function(){this.keyboard=xtiger.session(this.curDoc).load("keyboard");var c=this;xtdom.addEventListener(this.handle,"click",function(d){c.handleClick(d)},true);this.setData(this.defaultContent);this.editor.defaultValue=this.defaultContent;this.keyboard.register(this);if(this.isOptional){var b=this.handle.previousSibling;xtdom.addEventListener(b,"click",function(d){c.handleSelect(d)},true);this.setSelectionState("set"==this.isOptional)}},makeSeed:function(){if(!this.seed){var b=xtiger.editor.Plugin.prototype.pluginEditors.string;this.seed=[b,this.defaultContent,this.param,this.isOptional]}return this.seed},initFromSeed:function(b,d,c){this.curDoc=c;this.handle=d.previousSibling;this.editor=d;this.defaultContent=b[1];this.param=b[2];this.isOptional=b[3];this.awake()},setSelectionState:function(c){if(this.isOptional){var b=this.handle.previousSibling;this.isSelected=c;b.checked=c;if(c){xtdom.replaceClassNameBy(this.handle,"axel-option-unset","axel-option-set")}else{xtdom.replaceClassNameBy(this.handle,"axel-option-set","axel-option-unset")}}},load:function(b,c){if(b!==-1){var d=c.getDataFor(b);this.setData(d);this.setSelectionState(true)}else{this.setData(this.defaultContent);this.setSelectionState(false)}},save:function(b){if((!this.isOptional)||(this.isSelected)){b.write(this.dump())}else{b.discardNodeIfEmpty()}},dump:function(){return this.handle.firstChild.data},setData:function(c){var b=c?c.replace(/\s+/g," "):"click to edit";this.handle.firstChild.data=b;this.editor.value=b;this.editor.size=b.length},can:function(b){return false},handleClick:function(b){this.startEditing(true,b.shiftKey)},handleSelect:function(b){this.isSelected=this.handle.previousSibling.checked;if(this.isSelected){xtdom.replaceClassNameBy(this.handle,"axel-option-unset","axel-option-set");xtiger.editor.Repeat.autoSelectRepeatIter(this.getHandle())}else{xtdom.replaceClassNameBy(this.handle,"axel-option-set","axel-option-unset")}},isFocusable:function(){return true},focus:function(){this.startEditing(false,false)},unfocus:function(){this.stopEditing(false)}};xtiger.editor.Plugin.prototype.pluginEditors.string=new xtiger.editor.StringModel();xtiger.editor.RobustLoader=function(){};xtiger.editor.RobustLoader.prototype={WARN_REPEAT_COUNT:250,_dumpStackPath:function(d,c,b){},_dumpPointName:function(b){if(b){if(b instanceof Array){return b[0].localName}else{return"-1"}}else{return"null"}},_empile:function(c,b){var d=this._dumpStackPath("Empile",c,b);c.push(b)},_replaceTop:function(c,b){var d=this._dumpStackPath("Remplace",c,b);c[c.length-1]=b},_depile:function(b){var d=b.pop();var c=this._dumpStackPath("Depile",b,d);return b[b.length-1]},loadData:function(e,c){var d=c.getRootVector();var b=[d];this.loadDataIter(e,c,b)},makeRepeatState:function(d,c,b,e){return[d,c,b,e]},loadDataSlice:function(w,e,o,i,q,y,j){var l=[];var d=w;var r=true;var p;var s,h,w,e;while(d&&r){if(d.startRepeatedItem&&(d.startRepeatedItem!=j)){if((l.length==0)||((l[l.length-1][0])!=d.startRepeatedItem)){var g;if(d.startRepeatedItem.hasLabel()){var u=o.getVectorFor(d.startRepeatedItem.dump(),q);if((u instanceof Array)&&(o.lengthFor(u)>0)){this._empile(i,u);q=u;g=this.makeRepeatState(d.startRepeatedItem,d.startRepeatedItem.getSize(),true,true)}else{d=d.startRepeatedItem.getLastNodeForSlice(d.startRepeatedItem.getSize());d=d.nextSibling;continue}}else{if(this.repeatWouldLDS(d.startRepeatedItem,o,q)){g=this.makeRepeatState(d.startRepeatedItem,d.startRepeatedItem.getSize(),false,true)}else{d=d.startRepeatedItem.getLastNodeForSlice(d.startRepeatedItem.getSize());d=d.nextSibling;continue}}l.push(g)}}if(d.beginChoiceItem&&(d.beginChoiceItem!=y)){var v=d.beginChoiceItem;q=o.getVectorForAnyOf(v.getTypes(),q);if(q instanceof Array){this._empile(i,q);var x=v.selectChoiceForName(o.nameFor(q));if(v.items[x][0]!=v.items[x][1]){this.loadDataSlice(v.items[x][0],v.items[x][1],o,i,q,v);d=v.items[v.items.length-1][1];if((d.xttCloseLabel&&(!d.xttOpenLabel))&&(x!=(v.items.length-1))){q=this._depile(i)}}else{this.loadDataIter(v.items[x][0],o,i);q=this._depile(i);d=v.items[v.items.length-1][1]}}}else{this.loadDataIter(d,o,i);q=i[i.length-1];if(y){if(d==y.items[y.curItem][1]){q=this._depile(i);return}}}if(d==e){r=false}p=d.nextSibling;if(d.endRepeatedItem&&(d.endRepeatedItem!=j)){var g=l[l.length-1];--(g[1]);if(g[1]<0){if(d.endRepeatedItem.getSize()==0){d.endRepeatedItem.sliceLoaded()}}if(g[1]<=0){if(g[3]){var m=0;var b=d.endRepeatedItem;while(this.repeatWouldLDS(b,o,q)){if(++m>this.WARN_REPEAT_COUNT){var n=confirm("Too many repetitions, data seems corrupted, abort ?");if(n){break}}s=[q];h=b.appendSlice();w=b.getFirstNodeForSlice(h);e=b.getLastNodeForSlice(h);this.loadDataSlice(w,e,o,s,q,undefined,b);b.sliceLoaded()}}if(g[2]){q=this._depile(i)}l.pop()}}d=p}},loadDataIter:function(j,h,e){var g,i;var d=e[e.length-1];if(j.xttOpenLabel){i=j.xttOpenLabel;if(i.charAt(0)=="!"){var c=i.match(/^!(.*?)!(.*)$/);g=c[1];i=c[2];d=h.openFlow(g,d,i)||d}var b=false;if(i.charAt(0)=="@"){d=h.getAttributeFor(i.substr(1,i.length-1),d);b=true}else{d=h.getVectorFor(i,d)}if(b||((d instanceof Array)&&(h.lengthFor(d)>0))){this._empile(e,d)}else{d=-1;this._empile(e,d)}}if(j.xttPrimitiveEditor){j.xttPrimitiveEditor.load(d,h);d=-1}if(j.firstChild){this.loadDataSlice(j.firstChild,j.lastChild,h,e,d)}if(j.xttCloseLabel){i=j.xttCloseLabel;if(i.charAt(0)=="!"){var c=i.match(/^!(.*?)!(.*)$/);g=c[1];i=c[2];h.closeFlow(g,d)}this._depile(e)}},repeatWouldLDS:function(e,d,b){var h=[b];var g=e.getFirstNodeForSlice(0);var c=e.getLastNodeForSlice(0);return this.wouldLoadDataSlice(g,c,d,h,b,undefined,e)},wouldLoadDataSlice:function(d,g,j,m,o,n,q){var i=[];var p=d;var e=true;var h;while(p&&e){if(p.startRepeatedItem&&(p.startRepeatedItem!=q)){if((i.length==0)||((i[i.length-1][0])!=p.startRepeatedItem)){var b;if(p.startRepeatedItem.hasLabel()){if(j.hasVectorFor(p.startRepeatedItem.dump(),o)){return true}else{p=p.startRepeatedItem.getLastNodeForSlice(p.startRepeatedItem.getSize());p=p.nextSibling;continue}}else{if(this.repeatWouldLDS(p.startRepeatedItem,j,o)){return true}else{p=p.startRepeatedItem.getLastNodeForSlice(p.startRepeatedItem.getSize());p=p.nextSibling;continue}}i.push(b)}}if(p.beginChoiceItem&&(p.beginChoiceItem!=n)){var l=p.beginChoiceItem;if(j.hasVectorForAnyOf(l.getTypes(),o)){return true}}else{if(this.wouldLoadDataIter(p,j,m)){return true}o=m[m.length-1]}if(p==g){e=false}h=p.nextSibling;if(p.endRepeatedItem&&(p.endRepeatedItem!=q)){var b=i[i.length-1];if(true||(p.endRepeatedItem==b[0])){--(b[1]);if(b[1]<=0){i.pop()}}}p=h}},wouldLoadDataIter:function(j,h,e){var g,i;var d=e[e.length-1];if(j.xttOpenLabel){i=j.xttOpenLabel;if(i.charAt(0)=="!"){var c=i.match(/^!(.*?)!(.*)$/);g=c[1];i=c[2];d=h.openFlow(g,d,i)||d}var b=false;if(i.charAt(0)=="@"){b=true;if(h.hasAttributeFor(i.substr(1,i.length-1),d)){return true}}else{if(h.hasVectorFor(i,d)){return true}else{d=-1}}if(b||((d instanceof Array)&&(h.lengthFor(d)>0))){this._empile(e,d)}else{d=-1;this._empile(e,d)}}if(j.xttPrimitiveEditor){d=-1}if(j.firstChild){if(this.wouldLoadDataSlice(j.firstChild,j.lastChild,h,e,d)){return true}}if(j.xttCloseLabel){i=j.xttCloseLabel;if(i.charAt(0)=="!"){var c=i.match(/^!(.*?)!(.*)$/);g=c[1];i=c[2];h.closeFlow(g,d)}else{this._depile(e)}}return false}};xtiger.editor.Generator.prototype.defaultLoader=new xtiger.editor.RobustLoader();xtiger.editor.BasicLoader=function(){};xtiger.editor.BasicLoader.prototype={loadData:function(e,c){var d=c.getRootVector();var b=[d];this.loadDataIter(e,c,b)},hasDataFor:function(d,b,c){var e=false;if(d.hasLabel()){e=(0!=c.lengthFor(b))}else{e=c.hasDataFor(d.getRepeatableLabel(),b)}return e},makeRepeatState:function(d,c,b,e){return[d,c,b,e]},loadDataSlice:function(u,e,l,h,o,w,i){var j=[];var d=u;var p=true;var m;var n;while(d&&p){if(d.startRepeatedItem&&(d.startRepeatedItem!=i)){if((j.length==0)||((j[j.length-1][0])!=d.startRepeatedItem)){if(d.startRepeatedItem.hasLabel()){var r=l.getVectorFor(d.startRepeatedItem.dump(),o);if((r instanceof Array)&&(l.lengthFor(r)>0)){h.push(r);o=r;n=this.makeRepeatState(d.startRepeatedItem,d.startRepeatedItem.getSize(),true,true)}else{d=d.startRepeatedItem.getLastNodeForSlice(d.startRepeatedItem.getSize());d=d.nextSibling;continue}}else{if(this.hasDataFor(d.startRepeatedItem,o,l)){n=this.makeRepeatState(d.startRepeatedItem,d.startRepeatedItem.getSize(),false,true)}else{d=d.startRepeatedItem.getLastNodeForSlice(d.startRepeatedItem.getSize());d=d.nextSibling;continue}}j.push(n)}}if(d.beginChoiceItem&&(d.beginChoiceItem!=w)){var s=d.beginChoiceItem;o=l.getVectorForAnyOf(s.getTypes(),o);if(o instanceof Array){h.push(o);var v=s.selectChoiceForName(l.nameFor(o));if(s.items[v][0]!=s.items[v][1]){this.loadDataSlice(s.items[v][0],s.items[v][1],l,h,o,s);d=s.items[s.items.length-1][1];if((d.xttCloseLabel&&(!d.xttOpenLabel))&&(v!=(s.items.length-1))){h.pop();o=h[h.length-1]}}else{this.loadDataIter(s.items[v][0],l,h);h.pop();o=h[h.length-1];d=s.items[s.items.length-1][1]}}}else{this.loadDataIter(d,l,h);o=h[h.length-1];if(w){if(d==w.items[w.curItem][1]){h.pop();o=h[h.length-1];return}}}if(d==e){p=false}m=d.nextSibling;if(d.endRepeatedItem&&(d.endRepeatedItem!=i)){n=j[j.length-1];if(true||(d.endRepeatedItem==n[0])){--(n[1]);if(n[1]<0){if(d.endRepeatedItem.getSize()==0){d.endRepeatedItem.sliceLoaded()}}if(n[1]<=0){if(n[3]&&this.hasDataFor(d.endRepeatedItem,o,l)){var b=d.endRepeatedItem;while(this.hasDataFor(b,o,l)){xtiger.cross.log("stack-trace",">>[ extra ]>> start repetition for",b.dump());var q=[o];var g=b.appendSlice();var u=b.getFirstNodeForSlice(g);var e=b.getLastNodeForSlice(g);this.loadDataSlice(u,e,l,q,o,undefined,b);b.sliceLoaded()}}if(n[2]){h.pop();o=h[h.length-1]}j.pop()}}}d=m}},loadDataIter:function(j,h,e){var g,i;var d=e[e.length-1];if(j.xttOpenLabel){i=j.xttOpenLabel;if(i.charAt(0)=="!"){var c=i.match(/^!(.*?)!(.*)$/);g=c[1];i=c[2];d=h.openFlow(g,d,i)||d}var b=false;if(i.charAt(0)=="@"){d=h.getAttributeFor(i.substr(1,i.length-1),d);b=true}else{d=h.getVectorFor(i,d)}if(b||((d instanceof Array)&&(h.lengthFor(d)>0))){e.push(d)}else{d=-1;e.push(d)}}if(j.xttPrimitiveEditor){j.xttPrimitiveEditor.load(d,h);d=-1}if(j.firstChild){this.loadDataSlice(j.firstChild,j.lastChild,h,e,d)}if(j.xttCloseLabel){i=j.xttCloseLabel;if(i.charAt(0)=="!"){var c=i.match(/^!(.*?)!(.*)$/);g=c[1];i=c[2];h.closeFlow(g,d)}e.pop()}}};xtiger.editor.Generator.prototype.defaultLoader=new xtiger.editor.BasicLoader();xtiger.editor.BasicSerializer=function(b){};xtiger.editor.BasicSerializer.prototype={serializeData:function(d,c,b){c.openTag(b||"document");this.serializeDataIter(d,c);c.closeTag(b||"document")},serializeDataSlice:function(h,d,g,e){var b=[];var j=h;var i=true;while(j&&i){if(j.startRepeatedItem){if((b.length==0)||((b[b.length-1][0])!=j.startRepeatedItem)){if(j.startRepeatedItem.getSize()==0){j=j.startRepeatedItem.getLastNodeForSlice(0);j=j.nextSibling;continue}else{if(j.startRepeatedItem.hasLabel()){g.openTag(j.startRepeatedItem.dump())}}b.push([j.startRepeatedItem,j.startRepeatedItem.getSize()])}}if(j.beginChoiceItem&&(j.beginChoiceItem!=e)){var l=j.beginChoiceItem;g.openTag(l.getSelectedChoiceName());if(l.items[l.curItem][0]!=l.items[l.curItem][1]){this.serializeDataSlice(l.items[l.curItem][0],l.items[l.curItem][1],g,l)}else{this.serializeDataIter(l.items[l.curItem][0],g);g.closeTag(l.getSelectedChoiceName())}j=l.items[l.items.length-1][1];if(j.xttCloseLabel&&(l.curItem!=(l.items.length-1))){g.closeTag(j.xttCloseLabel)}}else{this.serializeDataIter(j,g);if(e){if(j==e.items[e.curItem][1]){g.closeTag(e.getSelectedChoiceName())}}}if(j.endRepeatedItem){if(true||(j.endRepeatedItem==b[b.length-1][0])){--(b[b.length-1][1]);if(b[b.length-1][1]<=0){if((j.endRepeatedItem.getSize()!=0)&&(j.endRepeatedItem.hasLabel())){g.closeTag(j.endRepeatedItem.dump())}b.pop()}}}if(j==d){i=false}j=j.nextSibling}},serializeDataIter:function(g,d){var c,e;if(g.xttOpenLabel){e=g.xttOpenLabel;if(e.charAt(0)=="!"){var b=e.match(/^!(.*?)!(.*)$/);c=b[1];e=b[2];d.openFlow(c,e)}if(e.charAt(0)=="@"){d.openAttribute(e.substr(1,e.length-1))}else{d.openTag(e)}}if(g.xttPrimitiveEditor){g.xttPrimitiveEditor.save(d)}if(g.firstChild){this.serializeDataSlice(g.firstChild,g.lastChild,d)}if(g.xttCloseLabel){c=false;e=g.xttCloseLabel;if(e.charAt(0)=="!"){var b=e.match(/^!(.*?)!(.*)$/);c=b[1];e=b[2]}if(e.charAt(0)=="@"){d.closeAttribute(e.substr(1,e.length-1))}else{d.closeTag(e)}if(c){d.closeFlow(c)}}}};xtiger.editor.Generator.prototype.defaultSerializer=new xtiger.editor.BasicSerializer();(function(){var _TextMetrics=function _TextMetrics(doc){this.div=xtdom.createElement(doc,"div");xtdom.addClassName(this.div,"axel-text-shadowbuffer");this.divText=xtdom.createTextNode(doc,"");this.div.appendChild(this.divText)};_TextMetrics.prototype={setBBox:function setBBox(w,h,handle,shape,type){var wpx=(w>0)?w+"px":"0px";var hpx=(h>0)?h+"px":"0px";this.lastWidth=w;this.lastHeight=h;if((type=="input")||(shape=="self")){this.div.style.width="";this.div.style.height=""}else{this.div.style.width=wpx;this.div.style.height="auto"}handle.style.width=wpx;handle.style.height=hpx},setText:function setText(text){this.divText.data=text+"m"},adjustWidth:function adjustWidth(handle,exactMath){var w=wimp=Math.max(this.div.offsetWidth,this.div.clientWidth,this.div.scrollWidth);if(w>this.lastWidth){if(!exactMath){wimp=w-(w%20)+20}else{if(!xtiger.cross.UA.webKit){wimp+=4}}handle.style.width=wimp+"px";this.lastWidth=w}},adjustHeight:function adjustHeight(handle,init){var h=Math.max(this.div.offsetHeight,this.div.clientHeight,this.div.scrollHeight);if(h>this.lastHeight){handle.style.height=h+"px";this.lastHeight=h}},grab:function grab(field){field.hook.appendChild(this.div)},release:function(field,willEditAgain){if(this.div.parentNode===field.hook){field.hook.removeChild(this.div)}}};xtiger.editor.TextDevice=function(input,kbd,doc){this.keyboard=kbd;this.field=input;this.metrics=xtiger.session(doc).load("metrics");if(!this.metrics){this.metrics=new _TextMetrics(doc);xtiger.session(doc).save("metrics",this.metrics)}this.currentEditor=null;var _this=this;this.blurHandler=function(ev){_this.handleBlur(ev)}};xtiger.editor.TextDevice.prototype={getHandle:function(){return this.field.getHandle()},isEditing:function(){return(null!=this.currentEditor)},_computeOffset:function(mouseEvent,editor){var offset=-1;var selObj,selRange;if(mouseEvent&&window.getSelection&&(editor.getParam("clickthrough")=="true")){selObj=window.getSelection();if(selObj&&(selObj.rangeCount>0)){selRange=selObj.getRangeAt(0);if(selRange){offset=selRange.startOffset}}}return offset},startEditing:function(editor,mouseEvent,doSelectAll){var ghost,offset;var constw,consth;var shape;var redux=false;var handle=this.field.getHandle();var coldStart=false;if(this.currentEditor){this.stopEditing(true)}else{this._kbdHandlers=this.keyboard.register(this);this.keyboard.grab(this,editor);if(editor.getParam("hasClass")){xtdom.addClassName(handle,editor.getParam("hasClass"))}if(!doSelectAll){offset=this._computeOffset(mouseEvent,editor)}coldStart=true;this.field.show(editor)}this.currentEditor=editor;ghost=editor.getGhost();constw=Math.max(ghost.offsetWidth,ghost.clientWidth,ghost.scrollWidth);consth=Math.max(ghost.offsetHeight,ghost.clientHeight,ghost.scrollHeight);this.field.grab(editor);this.metrics.grab(this.field);if(editor.getParam("enablelinebreak")=="true"){this.keyboard.enableRC()}if(doSelectAll){xtdom.focusAndSelect(handle)}else{if(offset){xtdom.focusAndMoveCaretTo(handle,(offset==-1)?handle.value.length:offset)}else{xtdom.focusAndMoveCaretTo(handle,handle.value.length)}}shape=this.currentEditor.getParam("shape");if(shape.charAt(shape.length-1)=="x"){var m=shape.match(/\d+/);if(m){constw=constw-parseInt(m[0]);redux=true}}this.metrics.setBBox(constw,consth,handle,shape,this.field.deviceType);this.metrics.setText(this.field.getValue());this.metrics.adjustWidth(handle,((this.field.deviceType==="textarea")&&(shape==="parent")));this.metrics.adjustHeight(handle);handle.style.top=(shape==="parent")?"-2px":"0";if(coldStart){xtdom.addEventListener(handle,"blur",this.blurHandler,false)}},stopEditing:function(willEditAgain,isCancel){if(!this.currentEditor){return}if(!this.stopInProgress){this.stopInProgress=true;var model=this.currentEditor;this.currentEditor=null;this.field.release(model,willEditAgain);this.metrics.release(this.field);if(!isCancel){model.update(this.field.getValue())}if(!willEditAgain){if(model.getParam("enablelinebreak")=="true"){this.keyboard.disableRC()}this.keyboard.unregister(this,this._kbdHandlers);this.keyboard.release(this,model);xtdom.removeEventListener(this.getHandle(),"blur",this.blurHandler,false);if(model.getParam("hasClass")){xtdom.removeClassName(this.getHandle(),model.getParam("hasClass"))}}this.stopInProgress=false}},getCurrentModel:function(){return this.currentEditor},cancelEditing:function(){this.stopEditing(false,true)},handleBlur:function(ev){this.stopEditing(false)},doKeyDown:function(ev){if(this.currentEditor&&(this.currentEditor.getParam("expansion")=="grow")){this.curLength=this.field.getValue().length;this.adjustShape()}},doKeyUp:function(ev){if(this.currentEditor&&this.currentEditor.can("onkeyup")){this.currentEditor.execute("onkeyup",this.field.getHandle())}if(this.currentEditor&&(this.currentEditor.getParam("expansion")=="grow")){if(this.field.getValue().length>(this.curLength+1)){this.adjustShape()}}},adjustShape:function(){this.metrics.setText(this.field.getValue());var h=this.field.getHandle();this.metrics.adjustWidth(h);if(this.field.deviceType=="textarea"){this.metrics.adjustHeight(h)}}};xtiger.editor.FloatingField=function(kind,doc){this.deviceType=kind;this.handle=this.createHandleForDoc(kind,doc);this.hook=xtdom.createElement(doc,"div");xtdom.addClassName(this.hook,"axel-text-container");this.hook.appendChild(this.handle);this.hook.style.display="none"};xtiger.editor.FloatingField.prototype={createHandleForDoc:function(kind,doc){var device=xtiger.session(doc).load("ff_"+kind);if(!device){device=xtdom.createElement(doc,kind);xtdom.addClassName(device,"axel-text-float");xtiger.session(doc).save("ff_"+kind,device)}return device},getHandle:function(){return this.handle},getValue:function(){return this.handle.value},show:function(){this.hook.style.display="inline"},grab:function(editor){var delta;this.handle.value=editor.getData();this.editorHandle=editor.getHandle();if(this.editorHandle.getClientRects){delta=this.editorHandle.getClientRects()["0"].left-this.editorHandle.parentNode.getBoundingClientRect().left;this.handle.style.left=(0-delta)+"px"}this.editorHandle.parentNode.insertBefore(this.hook,this.editorHandle);this.editorHandle.style.visibility="hidden"},release:function(editor,willEditAgain){if(this.hook.parentNode===this.editorHandle.parentNode){this.editorHandle.parentNode.removeChild(this.hook)}editor.getHandle().style.visibility="visible";if(!willEditAgain){this.hook.style.display="none"}},setPosition:function(ghost){var pos=xtdom.findPos(ghost);with(this.handle.style){left=pos[0]+"px";top=pos[1]+"px"}}};xtiger.editor.PlacedField=function(kind,doc){this.myDoc=doc;this.deviceType=kind;this.handle=this.createHandleForDoc(kind,doc);this.handle.style.display="none";this.cache={};this.hook};xtiger.editor.PlacedField.prototype={createHandleForDoc:function(kind,doc){var device=xtiger.session(doc).load("pf_"+kind);if(!device){device=xtdom.createElement(doc,kind);xtdom.addClassName(device,"axel-text-placed");xtiger.session(doc).save("pf_"+kind,device)}return device},getHandle:function(){return this.handle},getValue:function(){return this.handle.value},show:function(editor){this.handle.style.display="inline"},grab:function(editor){var _htag;this.handle.value=editor.getData();this.editorHandle=editor.getHandle();_htag=xtdom.getLocalName(this.editorHandle);if(!this.cache[_htag]){this.hook=xtdom.createElement(this.myDoc,_htag);this.cache[_htag]=this.hook}else{this.hook=this.cache[_htag]}var parent=this.editorHandle.parentNode;if(this.hook.firstChild!=this.handle){this.hook.appendChild(this.handle)}parent.insertBefore(this.hook,this.editorHandle,true);parent.removeChild(this.editorHandle)},release:function(editor,willEditAgain){var parent=this.hook.parentNode;parent.insertBefore(this.editorHandle,this.hook,true);parent.removeChild(this.hook);if(!willEditAgain){this.handle.style.display="none"}}};xtiger.editor.TextDeviceFactory=function(){this.devKey="TextDeviceCache"};xtiger.editor.TextDeviceFactory.prototype={_getCache:function(doc){var cache=xtiger.session(doc).load(this.devKey);if(!cache){cache={input:{"float":null,placed:null},textarea:{"float":null,placed:null},filtered:{}};xtiger.session(doc).save(this.devKey,cache)}return cache},getInstance:function(doc,type,layout){var t=type||"input";if((t!="input")&&(t!="textarea")){xtiger.cross.log("error","AXEL error : unkown text device type '"+t+"' requested !");t="input"}var l=layout||"placed";if((l!="float")&&(l!="placed")){xtiger.cross.log("error","AXEL error : unkown text device layout '"+l+"' requested !");l="float"}var cache=this._getCache(doc);var fConstructor;var device=cache[t][l];if(!device){var wrapper=(l=="float")?new xtiger.editor.FloatingField(t,doc):new xtiger.editor.PlacedField(t,doc);device=new xtiger.editor.TextDevice(wrapper,xtiger.session(doc).load("keyboard"),doc);if(fConstructor){device.addFilter(fConstructor(doc))}cache[t][l]=device}return device}};xtiger.registry.registerFactory("text-device",new xtiger.editor.TextDeviceFactory())})();xtiger.editor.PopupDevice=function(b){this._document=b;this._menu=xtiger.session(b).load("popupmenu");if(!this._menu){this._menu=new xtiger.editor.PopupMenu(b);xtiger.session(b).save("popupmenu",this._menu)}this._keyboard=xtiger.session(b).load("keyboard");this._currentModel=null;this._keyboardHandlers=null;this._currentSelection=null;var c=this;this.clickHandler=function(d){c.handleClick(d)}};xtiger.editor.PopupDevice.prototype={MAX_HEIGHT:150,startEditing:function(b,d,i,g){var c=true;var h=this._menu.getHandle();if(this._currentModel!=null){this.stopEditing(true);c=false}h.style.width="";h.style.maxHeight=this.MAX_HEIGHT+"px";this._menu.setOptions(d,i);this._menu.setPosition(g);if(c){this._menu.show();xtdom.addEventListener(this._document,xtiger.cross.events.DOWN,this.clickHandler,true);this._keyboardHandlers=this._keyboard.register(this,this._document)}this._currentModel=b;this._currentSelection=null;try{this._menu.adjustHeight(h,this.MAX_HEIGHT);if(this._menu.isScrollbarInside()){this._menu.adjustWidthToScrollbar(h)}}catch(j){}},stopEditing:function(c,b){if(!this._currentModel){return}if(!b){if(this.getSelection()){if(this._currentModel.onMenuSelection){this._currentModel.onMenuSelection(this.getSelection())}else{this._currentModel.update(this.getSelection())}}}if(!c){xtdom.removeEventListener(this._document,xtiger.cross.events.DOWN,this.clickHandler,true);this._menu.hide();this._keyboard.unregister(this,this._keyboardHandlers,this._document)}if((!b)&&(this._currentModel.isOptional)&&(!this._currentModel.isSelected)){if(this._currentModel.setSelectionState){this._currentModel.setSelectionState(true)}else{this._currentModel.set()}}this._currentModel=null},cancelEditing:function(){this.stopEditing(false,true)},isEditing:function(){return this._currentModel?true:false},getSelection:function(){return this._currentSelection},setSelection:function(b){this._currentSelection=b},getHandle:function(){return this._menu.getHandle()},handleClick:function(b){this._menu.handleClick(b,this)},doKeyDown:function(b){switch(b.keyCode){case 38:this._menu.selectPrev();xtdom.preventDefault(b);xtdom.stopPropagation(b);break;case 40:this._menu.selectNext();xtdom.preventDefault(b);xtdom.stopPropagation(b);break;default:}this._currentSelection=this._menu.getSelected()},doKeyUp:function(b){}};xtiger.editor.PopupMenu=function(b){this._document=b;this._handle=this._createMenuForDoc(b);this._handle.style.visibility="hidden";this._currentSelection=-1;this._options=null};xtiger.editor.PopupMenu.prototype={_createMenuForDoc:function(c){var b=c.getElementsByTagName("body")[0];var d=xtdom.createElement(c,"div");xtdom.addClassName(d,"axel-popup-container");b.appendChild(d);return d},_createMenuElement:function(c,e){var d=xtdom.createElement(this._document,"li");d.isNestedList=false;switch(typeof c){case"object":if(c.value&&c.display){d.selectionvalue=c.value;xtdom.addClassName(d,"axel-popup-selectable");e.push(d);try{d.innerHTML=c.display}catch(i){xtiger.cross.log("warning",'The following text is not proper HTML code \n\t"'+c.display+'"\n\tCause : '+i.message);var h=xtdom.createTextNode(this._document,c.display);d.appendChild(h)}break}else{if(c.section){d.selectionvalue=null;d.isNestedList=true;try{d.innerHTML='<table class="axel-popup-sublist"><tbody><tr><td class="axel-popup-sublistheader"></td><td class="axel-popup-sublistbody"><ul style="margin-left:0"></ul></td></tr></tbody></table>';_header=d.firstChild.firstChild.firstChild.firstChild;_body=_header.nextSibling.firstChild;if(c.header){_header.innerHTML=c.header}for(var g=0;g<c.section.length;g++){var b=this._createMenuElement(c.section[g],e);_body.appendChild(b)}}catch(i){xtiger.cross.log("warning",'The following text is not proper HTML code \n\t"'+c.header+'"\n\tCause : '+i.message);var h=xtdom.createTextNode(this._document,c.display);d.appendChild(h)}break}}case"string":default:h=xtdom.createTextNode(this._document,c);d.selectionvalue=c;d.appendChild(h);xtdom.addClassName(d,"axel-popup-selectable");e.push(d)}return d},_setPositionXY:function(x,y){with(this._handle.style){left=x+"px";top=y+"px"}},getHandle:function(){return this._handle},isScrollbarInside:function(){return xtiger.cross.UA.gecko||xtiger.cross.UA.webKit||xtiger.cross.UA.IE},adjustWidthToScrollbar:function(i){var d,g=20,e=10+g;if(i.scrollHeight>i.clientHeight){var h=xtdom.findPos(i);var c=xtdom.getWindowLimitFrom(i);var b=c[0]-h[0]-e;d=((i.scrollWidth+g)<b)?i.scrollWidth+g:b;i.style.width=d+"px"}},adjustHeight:function(j,c){var d,e=20,b=c;var i=xtdom.findPos(j);var g=xtdom.getWindowLimitFrom(j);var h=g[1]-i[1]-e;if((h<j.clientHeight)||(j.scrollHeight>j.clientHeight)){b=(h>c)?h:c;b=b+"px";d=j.style.maxHeight||"";if(d!=b){j.style.maxHeight=b}}},setOptions:function(e,d){this._currentSelection=-1;this._options=[];this._handle.innerHTML='<ul style="margin-left:0"></ul>';for(var c=0;c<e.length;c++){var b=this._createMenuElement(e[c],this._options);if(d&&b.selectionvalue==d){xtdom.addClassName(b,"selected")}else{xtdom.removeClassName(b,"selected")}this._handle.firstChild.appendChild(b)}},setPosition:function(b){var c=xtdom.findPos(b);this._setPositionXY(c[0],b.offsetHeight+c[1])},selectNext:function(){if(this._currentSelection!=-1){xtdom.removeClassName(this._options[this._currentSelection],"selected")}this._currentSelection++;this._currentSelection%=(this._options.length);xtdom.addClassName(this._options[this._currentSelection],"selected")},selectPrev:function(){if(this._currentSelection!=-1){xtdom.removeClassName(this._options[this._currentSelection],"selected")}else{this._currentSelection=1}this._currentSelection--;if(this._currentSelection<0){this._currentSelection=this._options.length-1}xtdom.addClassName(this._options[this._currentSelection],"selected")},getSelected:function(){if(this._currentSelection==-1){return false}var b=this._options[this._currentSelection];if(b.value){return b.selectionvalue}return b.firstChild.data},show:function(){this._handle.style.visibility="visible"},hide:function(){this._handle.style.visibility="hidden"},handleClick:function(c,b){var d=xtdom.getEventTarget(c);while(d.parentNode){if(xtdom.getLocalName(d).toLowerCase()==="li"&&d.selectionvalue){b.setSelection(d.selectionvalue);xtdom.preventDefault(c);xtdom.stopPropagation(c);b.stopEditing(false,false);return}if(d==this._handle){return}d=d.parentNode}xtdom.preventDefault(c);xtdom.stopPropagation(c);b.stopEditing(false,true)}};xtiger.editor.LayoutManager=(function LayoutManager(){var e;var c;var b;var d=function d(){e=xtdom.createElement(b,"img");e.setAttribute("src",xtiger.bundles.lens.whiteIconURL)};return function(g){b=g;c=xtdom.createElement(g,"div");xtdom.addClassName(c,"axel-layout-container");this.getFakeDiv=function(){if(!e){d()}return e};this.getLayoutHandle=function(){return c}}})();xtiger.editor.LayoutManager.prototype={_getDistanceFor:function(b,g){var d=xtdom.getComputedStyle(b,g),c=d.match(/\d*/),e=(c&&c[0]&&(c[0]!=""))?parseInt(c):0;return(!isNaN(e))?e:0},_getOffset:function(g){var e=0,d=0,c,b;switch(xtdom.getComputedStyle(g,"position")){case"absolute":case"fixed":break;case"relative":e=this._getDistanceFor(g,"top");d=this._getDistanceFor(g,"left");case"static":default:c=this._getDistanceFor(g,"margin-top");b=this._getDistanceFor(g,"margin-left");e+=(c>0)?c:0;d+=(b>0)?b:0}return[d,e]},_confirmInsertion:function(c){var b=(!this.curHandle)||(this.curHandle!=c);if(this.curHandle&&(this.curHandle!=c)){this.restoreHandle()}return b},_setDisplay:function(d,c){var b=xtdom.getComputedStyle(c,"display");b=(/^block$|^inline$/.test(b))?b:"block";d.style.display=b},_setOrigin:function(c,d,b){c.style.left=""+(d[0]-b[0])+"px";c.style.top=""+(d[1]-b[1])+"px"},_insert:function(i,j,h,c,b){var l,d,e,m=c,g=this._confirmInsertion(j);if(g){l=this.getLayoutHandle();d=this._getOffset(j);this._setDisplay(l,j);l.style.visibility="hidden";if(i=="above"){j.parentNode.insertBefore(l,j)}else{e=this.getFakeDiv();j.parentNode.replaceChild(e,j);e.parentNode.insertBefore(l,e)}l.appendChild(h);if(b){m=b()}this._setOrigin(l,d,m);l.style.visibility="visible";this.curDisplay=i;this.curHandle=j;this.curLensContent=h}return g},insertAbove:function(d,c,b,e){this._insert("above",d,c,b,e)},insertInline:function(g,e,d,j){var l,b,i,c;if(this._insert("inline",g,e,d,j)){l=e.getBoundingClientRect();b=l?(l.right-l.left):1;i=l?(l.bottom-l.top):1;c=this.getFakeDiv();c.style.width=b+"px";c.style.height=i+"px"}},restoreHandle:function(){var b;if(this.curHandle){if(this.curDisplay=="inline"){b=this.getFakeDiv();b.parentNode.replaceChild(this.curHandle,b)}else{this.curHandle.style.visibility="visible"}xtdom.removeElement(this.curLensContent);xtdom.removeElement(this.getLayoutHandle());this.curHandle=this.curDisplay=this.curLensContent=undefined}}};xtiger.editor.LensDevice=function(A){var z=A;var i=xtiger.session(A).load("keyboard");var h;var c;var j;var n;var b={trigger:"click",display:"above",padding:"10px"};var l=false;var x=false;var w=this;var C={click:["click",function(F){w._onClick(F)}],mouseover:["mousemove",function(F){w._onMouseMove(F)}]};var D=function(G,F){return(F.getParam&&F.getParam(G))||b[G]};var v=function(){if(!n){n=new xtiger.editor.LayoutManager(z)}return n};var g=function(G){var F=xtiger.factory("lens").getWrapper(z,G);if(!F){xtiger.cross.log("warning",'Missing wrapper "'+aWrapperName+'" in lens device, startEditing aborted')}return F};var e=function(J,G,F,H){var I;try{I=c.grab(J,F,H)}catch(K){xtiger.cross.log("error ( "+K.message+' ) "',G+'" failed to grab the lens device, startEditing compromised')}return I||H};var d=function(F,H){if(!F.isEditing()){return}if(c.isFocusable()){i.unregister(F,F._handlers)}v().restoreHandle();var G=D("trigger",h);if(C[G]){xtdom.removeEventListener(z,C[G][0],C[G][1],true);l=false}if(H){h.update(c.getData())}c.release();h=null;c=null;j=null};this.startEditing=function E(I,H,G){var L,J,K,M;var F=G?true:false;if(this.isEditing()){this.stopEditing()}c=g(H);if(c){h=I;if(c.isFocusable()){this._handlers=i.register(this);i.grab(this,I)}J=D("padding",I).match(/\d*/)[0];J=(K&&K!="")?parseInt(K):10;K=[J,J];j=c.getHandle();L=D("display",h);if(L=="above"){v().insertAbove(h.getHandle(),j,K,function(){return e(w,H,F,K)})}else{if(L=="inline"){v().insertInline(h.getHandle(),j,K,function(){return e(w,H,F,K)})}else{xtiger.cross.log("error",'unkown display "'+L+'" in lens device, startEditing compromised')}}c.activate(this,G);M=D("trigger",I);if(C[M]){xtdom.addEventListener(z,C[M][0],C[M][1],true);l=false}else{xtiger.cross.log("error",'unkown trigger mode "'+M+'" in lens device, startEditing compromised')}}};this.stopEditing=function p(){d(this,true)};this.cancelEditing=function r(){d(this,false)};this.isEditing=function u(){return h?true:false};this.getHandle=function y(){if(c){return c.getHandle()}return null};this.getCurrentModel=function B(){if(h){return h}return null};this.keepAlive=function o(F){x=F};this._onClick=function(F){if(x){return}var H=true;var G=xtdom.getEventTarget(F);while(G.parentNode){if(G==j){H=false;break}G=G.parentNode}if(H){this.stopEditing()}};this._onMouseMove=function(G){if(x||(!j)){return}var I=G.clientX;var H=G.clientY;var F=j.getBoundingClientRect();if(l){if(!(F.left>I||F.top>H||F.right<=I||F.bottom<=H)){l=false}}else{if(F.left>I||F.top>H||F.right<=I||F.bottom<=H){this.stopEditing();xtdom.stopPropagation(G)}}};this.doKeyUp=function q(F){};this.doKeyDown=function m(F){if(!this.isEditing()){return}if(F.keyCode=="38"||F.keyCode=="40"){c.toggleField()}if(F.keyCode=="27"){this.cancelEditing()}xtdom.stopPropagation(F)};this.mouseMayLeave=function s(){l=true}};xtiger.editor.LensDeviceFactory=function(){this.devKey="LensDeviceCache";this.wrappers={}};xtiger.editor.LensDeviceFactory.prototype={_getCache:function(c){var b=xtiger.session(c).load(this.devKey);if(!b){b={device:null,wrappers:{}};xtiger.session(c).save(this.devKey,b)}return b},registerWrapper:function(c,b){if(this.wrappers[c]){xtiger.cross.log("error","Error (AXEL) attempt to register an already registered wrapper : '"+c+"' with 'lens' device !")}else{this.wrappers[c]=b}},getWrapper:function(b,e){var c=this._getCache(b);var g=c.wrappers[e];if(!g){var d=this.wrappers[e];if(d){g=c.wrappers[e]=d(b)}}if(!g){xtiger.cross.log("error","Error (AXEL) : unkown wrapper '"+e+"' requested in 'lens' device !")}return g},getInstance:function(b){var c=this._getCache(b);var d=c.device;if(!d){d=c.device=new xtiger.editor.LensDevice(b)}return d}};xtiger.resources.addBundle("lens",{whiteIconURL:"white.png"});xtiger.registry.registerFactory("lens",new xtiger.editor.LensDeviceFactory());(function(){function b(c){var d=this;this.inProgress=null;this.available=[];this.curDoc=c;this.polllCounter=-1;this.onPoll=function(){d.poll()}}b.prototype={_reset:function(c){if(this.inProgress!==c){alert("Warning: attempt to close an unkown transmission !")}c.reset();this.available.push(c);this.inProgress=null},getUploader:function(){return(this.available.length>0)?this.available.pop():new FileUpload(this)},isReady:function(){return(null===this.inProgress)},isTransmitting:function(c){return(c&&(c===this.inProgress))},startPolling:function(){var c=frames["xt-photo-target"];if(c&&c.document&&c.document.body){c.document.body.innerHTML="WAITING";setTimeout(this.onPoll,500);this.polllCounter=0}},poll:function(){var c,d=frames["xt-photo-target"];if(this.pollCounter!==-1){if(d&&d.document&&d.document.body){c=d.document.body.textContent||d.document.body.innerText}if(c!="WAITING"){this.reportEoT(0,c)}else{setTimeout(this.onPoll,500)}}},stopPolling:function(){this.pollCounter=-1},startTransmission:function(d,c){this.inProgress=d;if(d.dataType==="form"){this.startPolling()}d.start(c)},startPreflight:function(d,c){this.inProgress=d;d.preflight(c)},reportEoT:function(d,c){this.stopPolling();if(this.inProgress===null){}else{if(d==1){this.notifyComplete(this.inProgress,c)}else{this.notifyError(this.inProgress,0,c)}}},notifyComplete:function(e,c){var d=e.client;this._reset(e);d.onComplete(c)},notifyError:function(g,e,d){var c=g.client;this._reset(g);c.onError(d,e)},cancelTransmission:function(d){var c=d.client;d.cancel();this._reset(d);c.onCancel()}};FileUpload=function(c){this.manager=c;this.xhr=null;this.defaultUrl="/upload"};FileUpload.prototype={reset:function(){delete this.url},setDataType:function(c){this.dataType=c},setAction:function(c){this.url=c},getClient:function(){return this.client},setClient:function(d){this.client=d},start:function(c){this.client=c;try{if(this.dataType==="formdata"){this.startXHRForm()}else{var d=this.client.getPayload();if(this.url){xtdom.setAttribute(d,"action",this.url)}else{if(!d.getAttribute("action")){xtdom.setAttribute(d,"action",this.defaultUrl)}}d.documentId.value=this.client.getDocumentId()||"noid";d.submit()}}catch(g){this.manager.notifyError(this,g.name,g.message)}},preflight:function(c){this.client=c;var i,l,g,d;this.xhr=new XMLHttpRequest();this.isCancelled=false;var j=this;this.xhr.onreadystatechange=function(){if(j.isCancelled){return}if(4===j.xhr.readyState){if(200===j.xhr.status){j.manager.notifyComplete(j,j.xhr.responseText)}else{j.manager.notifyError(j,j.xhr.status,j.xhr.responseText)}}};try{this.xhr.open("POST",this.url||this.defaultUrl,true);i=new FormData();var d=c.getPreflightOptions();for(k in d){i.append(k,d[k])}this.xhr.send(i)}catch(h){this.manager.notifyError(this,h.name,h.message)}},startXHRForm:function(){var g,i;this.xhr=new XMLHttpRequest();this.isCancelled=false;var h=this;this.xhr.onreadystatechange=function(){if(h.isCancelled){return}if(4===h.xhr.readyState){if(201===h.xhr.status){h.manager.notifyComplete(h,h.xhr.responseText)}else{h.manager.notifyError(h,h.xhr.status,h.xhr.responseText)}}};try{this.xhr.open("POST",this.url||this.defaultUrl,true);g=new FormData();var c=this.client.getPayload();for(k in c){g.append(k,c[k])}this.xhr.send(g)}catch(d){this.manager.notifyError(this,d.name,d.message)}},cancel:function(){if(this.xhr){this.isCancelled=true;this.xhr.abort()}else{var c=this.client.getPayload();c.reset()}}};xtiger.registry.registerFactory("upload",{getInstance:function(d){var c=xtiger.session(d).load("upload");if(!c){c=new b(d);xtiger.session(d).save("upload",c)}return c}})}());(function(){function b(d,j){var o=this,g,m,h,l,c;function n(i){if(o.targetModel!==undefined){o.commands[i.data][0].call(o.targetModel)}}function e(r){var p,s,q,i;if(o.targetNode){p=$(o.targetNode);s=p.offset();if(s){q=s.left+p.width();i=s.top+p.height();if((r.pageX>q)||(r.pageX<s.left)||(r.pageY<s.top)||(r.pageY>i)){o.stopEditing()}}else{xtiger.cross.log("debug","[Tracker menu] moveCb cannot find position for element")}}else{xtiger.cross.log("debug","[Tracker menu] calling move with no target")}}this.targetModel=undefined;this.targetNode=undefined;this.commands={};this.menuDiv=xtdom.createElement(d,"div");xtdom.addClassName(this.menuDiv,"axel-tracker-menu");c=$(this.menuDiv);for(g=0;g<j.length;g++){for(m in j[g]){h=j[g][m][0];l=xtdom.createElement(d,"button");this.menuDiv.appendChild(l);$(l).text(h).bind("click",m,n);this.commands[m]=[j[g][m][1],l,true]}}c.appendTo($("body",d));this.menuWidth=c.width();this.menuHeight=c.height();c.hide();this.startEditing=function(q,i,s){var r;var p=$(i);var u=p.offset();this.targetModel=q;this.targetNode=i;$("body",q.getDocument()).bind("mousemove",e);$(this.menuDiv).css({top:u.top+(p.height()/2)-(this.menuHeight/2),left:u.left+(p.width()/2)-(this.menuWidth/2)}).show();for(r in s){s[r]?this.enable(r):this.disable(r)}};this.stopEditing=function(){if(this.targetModel){$("body",this.targetModel.getDocument()).unbind("mousemove",e);this.targetModel=undefined;this.targetNode=undefined;$(this.menuDiv).hide()}}}b.prototype={isTracking:function(){return(this.targetModel!==undefined)},disable:function(c){if(this.commands[c][2]){this.commands[c][1].disabled=true;$(this.commands[c][1]).addClass("off");this.commands[c][2]=false}},enable:function(c){if(this.commands[c][2]===false){this.commands[c][1].disabled=false;$(this.commands[c][1]).removeClass("off");this.commands[c][2]=true}}};xtiger.editor.TrackerMenu=b})();(function(b){var d=function(i,h,e){var g=xtdom.createElement(e,"span");var j=xtdom.createTextNode(e,"");g.appendChild(j);xtdom.addClassName(g,"axel-core-editable");i.appendChild(g);return g};var c=(function(){function e(j){var h="popupdevice";var i=xtiger.session(j).load(h);if(!i){i=new xtiger.editor.PopupDevice(j);xtiger.session(j).save(h,i)}return i}function g(i){var h;if(i.indexOf("\\ ")===-1){return i.split(" ")}else{h=i.replace(/\\ /g,"&nbsp;");return xtiger.util.array_map(h.split(" "),function(j){return j.replace(/&nbsp;/g," ")})}}return{onInit:function(j,h,i){this.defaultScreenData=j;this.device=e(this.getDocument());if(this.getParam("hasClass")){xtdom.addClassName(this._handle,this.getParam("hasClass"))}this._setData(this.i18nFilter(this.defaultScreenData,false),this.defaultScreenData)},onAwake:function(){var h=this;xtdom.addEventListener(this._handle,"click",function(i){h.startEditing(i)},true)},onLoad:function(j,i){var h;if(j!==-1){h=i.getDataFor(j);if(h){this._setData(h)}this.set(false)}else{this.clear(false)}},onSave:function(h){if((!this.isOptional())||this.isSet()){h.write(this._data)}else{h.discardNodeIfEmpty()}},api:{_parseFromTemplate:function(i){var j;this._param={};xtiger.util.decodeParameters(i.getAttribute("param"),this._param);this._content=xtdom.extractDefaultContentXT(i);j=i.getAttribute("option");this._option=j?j.toLowerCase():null;var h=i.getAttribute("values");var n=i.getAttribute("i18n");var m=h?g(h):"null";var l=n?g(n):false;this._param.values=l?[l,m]:m}},methods:{_setData:function(h,i){var j=i||this.i18nFilter(h,true);if(this._handle.firstChild){this._handle.firstChild.data=j}this._data=h},getData:function(){var h=(this.getParam("select_dispatch")==="value")?this._data:this.i18nFilter(this._data,true);return h},startEditing:function(j){var h,i=this.getParam("values");if(i){h=("string"!==typeof(i[0]))?i[0]:i;this.device.startEditing(this,h,this.i18nFilter(this._data,true),this.getHandle())}},stopEditing:function(){},update:function(h){var i=(this.getParam("select_dispatch")==="value")?h:this.i18nFilter(h,false);if(i===this._data){return}this._setData(i);this.set(true)},clear:function(h){this._setData(this.i18nFilter(this.defaultScreenData,false),this.defaultScreenData);if(this.isOptional()){this.unset(h)}},onMenuSelection:function(h){if(this.getParam("select_dispatch")==="value"){this.update(this.i18nFilter(h,false))}else{this.update(h)}},i18nFilter:function(n,h){var l,m=n,j=this.getParam("values");if(!j){xtiger.cross.log("error",'missing "values" attribute in "select" plugin declaration')}else{if("string"!==typeof(j[0])){var p=j[h?1:0];var o=j[h?0:1];for(l=0;l<p.length;l++){if(n===p[l]){if(l<o.length){m=o[l]}else{m="**Error**"}break}}}}return m}}}}());b.plugin.register("select",{filterable:true,optional:true},{select_dispatch:"value"},d,c)}($axel));(function(b){var d=function(i,g,e){var m=g.getAttribute("handle")||"span",l=xtdom.createElement(e,m),j=xtdom.createTextNode(e,"");l.appendChild(j);xtdom.addClassName(l,"axel-core-on");i.appendChild(l);return l};var c={onInit:function(j,h,i){var g,e=this.getParam("device");if((!j)||(typeof j!=="string")){this._content="click to edit"}this._data=this.getDefaultData();this._setData(this._data);if(this.getParam("hasClass")){xtdom.addClassName(this._handle,this.getParam("hasClass"))}g=e?xtiger.factory(e):xtiger.factory(this.getParam("defaultDevice"));this._device=g.getInstance(this.getDocument(),this.getParam("type"),this.getParam("layout"));this._noData=this._handle.firstChild},onAwake:function(){var e=this;if(!this.getParam("noedit")){xtdom.addClassName(this._handle,"axel-core-editable");xtdom.addEventListener(this._handle,"click",function(g){e.startEditing(g)},true)}},onLoad:function(i,h){var g,e;if(i!==-1){g=h.getDataFor(i);e=this.getDefaultData();this._setData(g||e);this.setModified(g!==e);this.set(false)}else{this.clear(false)}},onSave:function(e){if(this.isOptional()&&(!this.isSet())){e.discardNodeIfEmpty();return}if(this._data){e.write(this._data)}},api:{isFocusable:function(){return !this.getParam("noedit")},focus:function(){this.startEditing({shiftKey:!this.isModified()})},unfocus:function(){this.stopEditing()},getHandle:function(e){if(e){if(this.getParam("layout")==="placed"&&this._device&&this._device.getCurrentModel()===this){return this._device.getHandle()}}return this._handle}},methods:{_setData:function(e){if(this._handle.firstChild){this._handle.firstChild.data=e}this._data=e},getData:function(){return this._data},getGhost:function(){var e=this.getParam("shape");return(e&&e.charAt(0)==="p")?this._handle.parentNode:this._handle},startEditing:function(g){var e=g?(!this.isModified()||g.shiftKey):false;this._device.startEditing(this,g,e)},stopEditing:function(){this._device.stopEditing(false,false)},update:function(e){if(e===this._data){return}if(e.search(/\S/)===-1||(e===this.getDefaultData())){this.clear(true);return}this._setData(e);this.setModified(true);this.set(true)},clear:function(e){this._setData(this.getDefaultData());this.setModified(false);if(this.isOptional()&&this.isSet()){this.unset(e)}}}};b.plugin.register("text",{filterable:true,optional:true},{device:"text-device",type:"input",layout:"placed",shape:"self",expansion:"grow",clickthrough:"true",enablelinebreak:"false"},d,c)}($axel));(function(b){var d=function(i,g,e){var m=g.getAttribute("handle")||"span",l=xtdom.createElement(e,m),j=xtdom.createTextNode(e,"");l.appendChild(j);xtdom.addClassName(l,"axel-core-on");i.appendChild(l);return l};var c=(function(){var h=-1;function e(j){try{j.getDocument().execCommand("selectAll",false,"")}catch(l){}}function i(l){var j=l.replace(/\s+/gi," ");if(/\s/.test(j.charAt(0))){j=j.substr(1)}if(/\s$/.test(j)){j=j.substr(0,j.length-1)}return j}function g(l,m){var j="";if((l.children.length>1)||(l.firstChild&&(l.firstChild.nodeType!==xtdom.TEXT_NODE))){if(typeof l.textContent==="string"){j=l.textContent}else{if(typeof l.innerText==="string"){j=l.innerText}}l.innerHTML="";t=xtdom.createTextNode(m,j?i(j):j);l.appendChild(t)}}return{onInit:function(m,j,l){if((!m)||(typeof m!=="string")){this._content="click to edit"}this.model=m;this._setData(this.model);if(this.getParam("hasClass")){xtdom.addClassName(this._handle,this.getParam("hasClass"))}this.keyboard=xtiger.session(this.getDocument()).load("keyboard");this.editInProgress=false},onAwake:function(){var j=this;if(this.getParam("noedit")!=="true"){xtdom.setAttribute(this._handle,"contenteditable","true");xtdom.addClassName(this._handle,"axel-core-editable");xtdom.addEventListener(this._handle,"mousedown",function(l){if(l.shiftKey){h=new Date().getTime()}},true);xtdom.addEventListener(this._handle,"focus",function(l){j.startEditing()},true);if(xtiger.cross.UA.gecko){xtdom.addEventListener(this._handle,"mousedown",function(l){if(l.detail>=3){xtdom.preventDefault(l);xtdom.stopPropagation(l);j._handle.focus();e(j)}},true)}if(xtiger.cross.UA.webKit){this.doSelectAllCb=function(){e(j)}}}this.blurHandler=function(l){j.handleBlur(l)}},onLoad:function(n,m){var l,j;if(n!==-1){l=m.getDataFor(n);j=this.getDefaultData();this._setData(l||j);this.setModified(l!==j);this.set(false)}else{this.clear(false)}},onSave:function(j){if(this.isOptional()&&(!this.isSet())){j.discardNodeIfEmpty();return}if(this.model){j.write(this.model)}},api:{isFocusable:function(){return this.getParam("noedit")!=="true"},focus:function(){this._handle.focus()},unfocus:function(){this.stopEditing(false)}},methods:{_setData:function(j){var l;if(this._handle.firstChild){this._handle.firstChild.data=j}else{l=xtdom.createTextNode(this.getDocument(),j);this._handle.appendChild(l)}this.model=j},isEditing:function(){return this.editInProgress!==false},cancelEditing:function(){this.stopEditing(true)},doKeyDown:function(j){},doKeyUp:function(j){},startEditing:function(){if(this.editInProgress===false){this.editInProgress=true;this.kbdHandlers=this.keyboard.register(this);this.keyboard.grab(this,this);if((!this.isModified())||((h!==-1)&&((h-new Date().getTime())<100))){if(xtiger.cross.UA.webKit){setTimeout(this.doSelectAllCb,100)}else{e(this)}}xtdom.addEventListener(this._handle,"blur",this.blurHandler,false)}},stopEditing:function(j){if((!this.stopInProgress)&&(this.editInProgress!==false)){this.stopInProgress=true;h=-1;this.keyboard.unregister(this,this.kbdHandlers);this.keyboard.release(this,this);xtdom.removeEventListener(this._handle,"blur",this.blurHandler,false);g(this._handle,this.doc);if(!j){this.update(this._handle.firstChild?this._handle.firstChild.data:null)}else{if(this._handle.firstChild){this._handle.firstChild.data=this.model}}this._handle.blur();this.stopInProgress=false;this.editInProgress=false}},update:function(j){if(j===this.model){return}if((!j)||(j.search(/\S/)===-1)||(j===this.getDefaultData())){this.clear(true);return}this._setData(j);this.setModified(true);this.set(true)},clear:function(j){this._setData(this.getDefaultData());this.setModified(false);if(this.isOptional()&&this.isSet()){this.unset(j)}},handleBlur:function(j){this.stopEditing(false)}}}}());b.plugin.register("content",{filterable:false,optional:true},{noedit:"false"},d,c)}($axel));(function(b){var d=function(i,h,e){var g=xtdom.createElement(e,"img");xtdom.setAttribute(g,"src",xtiger.bundles.photo.photoIconURL);xtdom.addClassName(g,"axel-drop-target");xtdom.addClassName(g,"axel-photo-model");i.appendChild(g);return g};var c={onInit:function(i,e,g){var h=this.getParam("photo_base");if(h&&(h.charAt(h.length-1)!=="/")){h=h+"/";this._param.photo_base=h}this.state=new xtiger.editor.PhotoState(this);if(h){this.state.base=h}},onAwake:function(){this.device=xtiger.factory("lens").getInstance(this.getDocument());var e=this;xtdom.addEventListener(this._handle,"error",function(g){e.state.onError("Broken Image",true)},false);xtdom.addEventListener(this._handle,this.getParam("trigger"),function(g){e.device.startEditing(e,"photo");xtdom.preventDefault(g);xtdom.stopPropagation(g)},false);this._constructStateFromUrl(this.getDefaultData());this.redraw(false)},onLoad:function(i,h){var g,e=(i!==-1)?h.getDataFor(i):this.getDefaultData();this._constructStateFromUrl(e);if(h.hasAttributeFor("resource_id",i)){g=h.getAttributeFor("resource_id",i);this.state.resourceId=h.getDataFor(g)}this.redraw(false)},onSave:function(e){e.write(this._dump());if(this.state.resourceId){e.writeAttribute("resource_id",this.state.resourceId)}},api:{},methods:{getData:function(){return this.state},getFile:function(){return this.file},_constructStateFromUrl:function(e){this.state.resourceId=null;if(e&&(e.search(/\S/)!==-1)){this.state.status=xtiger.editor.PhotoState.prototype.COMPLETE;this.state.photoUrl=e}else{this.state.status=xtiger.editor.PhotoState.prototype.READY;this.state.photoUrl=null}},_dump:function(){return(this.state.photoUrl)?this.state.photoUrl:""},redraw:function(g){var e,l,i,h=false;switch(this.state.status){case xtiger.editor.PhotoState.prototype.READY:l=xtiger.bundles.photo.photoIconURL;break;case xtiger.editor.PhotoState.prototype.ERROR:l=xtiger.bundles.photo.photoBrokenIconURL;break;case xtiger.editor.PhotoState.prototype.UPLOADING:l=xtiger.bundles.photo.spiningWheelIconURL;break;case xtiger.editor.PhotoState.prototype.COMPLETE:if(g){var j=this._handle.getAttribute("src");if(j!==this.state.photoUrl){xtiger.editor.Repeat.autoSelectRepeatIter(this._handle)}}h=true;l=this.state.genPhotoUrl();break;default:l=xtiger.bundles.photo.photoBrokenIconURL}if((this._handle.getAttribute("src")!==l)||h){xtdom.setAttribute(this._handle,"src",i?i+l:l);if(xtiger.cross.UA.IE){this._handle.removeAttribute("width");this._handle.removeAttribute("height")}e=this.getParam("photo_class");if(e){if(xtiger.editor.PhotoState.prototype.COMPLETE===this.state.status){xtdom.addClassName(this._handle,e)}else{xtdom.removeClassName(this._handle,e)}}}},update:function(e){if(e.isPhotoStateObject===undefined){if(e.photoUrl){this._constructStateFromUrl(e.photoUrl);if(e.resource_id){this.state.resourceId=e.resource_id}}else{this._constructStateFromUrl(e)}this.redraw(true)}}}};b.plugin.register("photo",{filterable:true,optional:true},{trigger:"click"},d,c);xtiger.resources.addBundle("photo",{photoIconURL:"icons/photo.png",photoBrokenIconURL:"icons/photobroken.png",spiningWheelIconURL:"icons/spiningwheel.gif",lensBoxURL:"photo.xhtml"});xtiger.editor.PhotoState=function(e){this.status=this.READY;this.photoUrl=null;this.resourceId=null;this.errMsg=null;this.transmission=null;this.delegate=e};xtiger.editor.PhotoState.prototype={READY:0,ERROR:1,UPLOADING:2,COMPLETE:3,isPhotoStateObject:true,genPhotoUrl:function(){return(this.base?this.base+this.photoUrl:this.photoUrl)},setDelegate:function(e){this.delegate=e},getPayload:function(){return this.payload},getDocumentId:function(){return xtiger.session(this.myDoc).load("documentId")},startTransmission:function(j,h,i,e){this.cached=[this.status,this.photoUrl,this.resourceId,this.errMsg];var g=xtiger.factory("upload").getInstance(j);this.myDoc=j;this.transmission=g.getUploader();this.transmission.setDataType(h);if(e){this.transmission.setAction(e)}this.payload=i;this.status=this.UPLOADING;g.startTransmission(this.transmission,this);this.delegate.redraw()},cancelTransmission:function(){if(this.transmission){var e=xtiger.factory("upload").getInstance(this.myDoc);e.cancelTransmission(this.transmission)}},onComplete:function(e){this.status=this.COMPLETE;if(typeof(e)==="string"){this.photoUrl=e;this.resourceId=null}else{this.photoUrl=e.url;this.resourceId=e.resource_id}this.errMsg=null;this.transmission=null;this.delegate.redraw()},onError:function(e,g){this.status=this.ERROR;if(!g){this.photoUrl=null}this.errMsg=e;this.transmission=null;this.delegate.redraw()},onCancel:function(){this.status=this.cached[0];this.photoUrl=this.cached[1];this.resourceId=this.cached[2];this.errMsg=this.cached[3];this.transmission=null;this.delegate.redraw()}};xtiger.editor.PhotoViewer=function(h,o,n,g){var q,j,l=this;var i=this.view=xtdom.createElement(o,"div");xtdom.setAttribute(i,"id","xt-photo");xtdom.addClassName(i,"axel-lens-container");xtdom.addClassName(i,"axel-lens-containerstyle");n.appendChild(this.view);try{var p=xtiger.cross.getXHRObject();p.open("GET",h,false);p.send(null);if((p.status===200)||(p.status===0)){if(p.responseText){i.innerHTML=p.responseText}else{throw {name:"Error",message:"Photo plugin initialization failed : empty lens bundle content"}}}else{throw {name:"Error",message:"Photo plugin initialization failed : HTTP error ("+p.status+")"}}this.formular=o.getElementById("xt-photo-form");this.icon=o.getElementById("xt-photo-icon");this.infobox=o.getElementById("xt-photo-info");this.errorbox=o.getElementById("xt-photo-error");this.filemenu=o.getElementById("xt-photo-form-body");this.btnselfile=o.getElementById("xt-photo-file");this.btnupload=o.getElementById("xt-photo-save");this.btncancel=o.getElementById("xt-photo-cancel");q=this.formular.getAttribute("target")||"xt-photo-target";j=xtdom.createElement(o,"iframe");xtdom.setAttribute(j,"id",q);xtdom.setAttribute(j,"name",q);xtdom.setAttribute(j,"src","javascript:false;");j.style.display="none";n.appendChild(j);xtdom.addEventListener(this.btnselfile,"click",function(){l.startSelectCb()},false);xtdom.addEventListener(this.btnupload,"click",function(){l.saveCb()},false);xtdom.addEventListener(this.btncancel,"click",function(){l.cancelCb()},false);this.btncancel.style.display="none";this.failed=false;this.hide()}catch(m){this.view.innerHTML="<p>File Upload is not available...<br/><br/>Failed to make lens with '"+h+"'.<br/><br/>"+m.name+" : "+m.message+"</p>";this.failed=true}this.ready();this.wrapper=g};xtiger.editor.PhotoViewer.prototype={showPhoto:function(e){if(!this.failed){if(this.btnselfile.value.length>0){this.formular.reset()}this.icon.setAttribute("src",e);this.icon.style.visibility="visible";if(e===xtiger.bundles.photo.spiningWheelIconURL){this.btncancel.style.display="block"}else{this.btncancel.style.display="none"}}},hideError:function(){if(!this.failed){this.errorbox.style.display="none"}},hideMessage:function(){if(!this.failed){this.infobox.style.display="none"}},showError:function(e){if(!this.failed){this.errorbox.style.display="block";this.errorbox.firstChild.data=e}},showUplButtons:function(){if(!this.failed){this.filemenu.style.display=""}},hideUplButtons:function(){if(!this.failed){this.filemenu.style.display="none"}},hide:function(){this.view.style.display="none"},show:function(){this.view.style.display=""},showMessage:function(e){if(!this.failed){this.infobox.style.display="block";this.infobox.firstChild.data=e}},getTopDiv:function(){return this.view},ready:function(){this.showPhoto(xtiger.bundles.photo.photoIconURL);this.showMessage("You can select a file and upload it");this.hideError();this.showUplButtons()},complete:function(e){this.showPhoto(e);this.hideMessage();this.hideError();this.showUplButtons()},loading:function(){this.showPhoto(xtiger.bundles.photo.spiningWheelIconURL);this.showMessage("Wait while loading");this.hideError();this.hideUplButtons()},error:function(e){this.showPhoto(xtiger.bundles.photo.photoBrokenIconURL);this.showError(e);this.hideMessage();this.showUplButtons()},busy:function(){this.btncancel.style.display="none";this.icon.style.visibility="hidden";this.hideError();this.showMessage("Another upload is in progress, please wait until it finishes.");this.hideUplButtons()},activateUpload:function(){this.btnupload.removeAttribute("disabled")},deactivateUpload:function(){xtdom.setAttribute(this.btnupload,"disabled","true")},startSelectCb:function(){this.wrapper.onStartSelect()},saveCb:function(){if(this.btnselfile.value.length>0){this.wrapper.onStartUpload(this.formular)}},cancelCb:function(){this.wrapper.onCancelUpload()}};xtiger.editor.PhotoWrapper=function(h){this.myDoc=h;var g=xtiger.session(h).load("form");var e=(g&&g.getRoot())||h.getElementsByTagName("body")[0];this.view=new xtiger.editor.PhotoViewer(xtiger.bundles.photo.lensBoxURL,h,e,this);this.state=null};xtiger.editor.PhotoWrapper.prototype={isFocusable:function(){return false},getHandle:function(){return this.view.getTopDiv()},getData:function(){return this.state},grab:function(h,e,g){this.device=h;this.editor=h.getCurrentModel();this.state=this.editor.getData();this.state.setDelegate(this);this.redraw();this.view.show();if(g[0]>0){this.view.getTopDiv().style.padding=g[0]+"px"}},activate:function(g,e){},release:function(){this.view.hide();this.device=null;this.state.setDelegate(this.editor);this.editor.redraw(true)},onStartSelect:function(){this.device.mouseMayLeave()},onStartUpload:function(e){this.state.startTransmission(this.myDoc,"form",e,this.editor.getParam("photo_URL"))},onCancelUpload:function(e){this.state.cancelTransmission()},redraw:function(){var e=xtiger.factory("upload").getInstance(this.myDoc);if(e.isReady()||e.isTransmitting(this.state.transmission)){switch(this.state.status){case xtiger.editor.PhotoState.prototype.READY:this.view.ready();break;case xtiger.editor.PhotoState.prototype.ERROR:this.view.error(this.state.errMsg);break;case xtiger.editor.PhotoState.prototype.UPLOADING:this.view.loading();break;case xtiger.editor.PhotoState.prototype.COMPLETE:this.view.complete(this.state.genPhotoUrl());break;default:this.view.error("Unkown Photo status "+this.state.status);break}}else{this.view.busy()}}};xtiger.factory("lens").registerWrapper("photo",function(e){return new xtiger.editor.PhotoWrapper(e)})}($axel));(function(r){var p=function(w,v,s){var u;u=xtdom.createElement(s,"span");xtdom.addClassName(u,"xt-file");$(u).html('<img class="xt-file-icon1"/><span class="xt-file-trans"/><input class="xt-file-id" type="text" value="nom"/><input class="xt-file-save" type="button" value="Enregistrer"/><span class="xt-file-perm"/><img class="xt-file-icon2"/>');w.appendChild(u);return u};var d=0;var m=1;var o=2;var h=3;var l=4;var j=5;var i={fr:[null,null,"enregistrement en cours","échec de l'enregistrement","enregistrement réussi",null]};var q={fr:["cliquez pour choisir un fichier",["cliquez sur “Enregistrer” pour sauvegarder “%” (%)","cliquez sur “Enregistrer” pour sauvegarder “%” (%)<br/>sous “%” (vous pouvez éditer le nom avant)"],"enregistrement de “%” (%) en cours","échec de l'enregistrement de “%”<br/>%",'“%” a été enregistré en tant que <a target="_blank" href="%">%</a>','cliquez pour remplacer <a target="_blank" href="%">%</a>']};function g(s){var v=$.trim(s).toLowerCase(),u=(v.indexOf(".pdf")!==-1)?v.substring(0,v.indexOf(".pdf")):v;u=u.replace(/(\s{2,}|_)/g," ");u=u.replace(/\s/g,"-");u=u.replace(/[éè]/g,"e");u=u.replace(/[^a-z0-9-_]/g,"");return u}var e={onInit:function(w,s,u){var v=this.getParam("file_base");if(v&&(v.charAt(v.length-1)!=="/")){this._param.file_base=v+"/"}},onAwake:function(){this.vIcon1=$(".xt-file-icon1",this._handle);this.vTrans=$(".xt-file-trans",this._handle);this.vPerm=$(".xt-file-perm",this._handle);this.vIcon2=$(".xt-file-icon2",this._handle);this.vSave=$(".xt-file-save",this._handle).hide();this.vId=$(".xt-file-id",this._handle).hide();this.vIcon1.bind({click:$.proxy(_FileEditor.prototype.onActivate,this),mouseenter:$.proxy(_FileEditor.prototype.onEnterIcon,this),mouseleave:$.proxy(_FileEditor.prototype.onLeaveIcon,this)});this.vIcon2.click($.proxy(_FileEditor.prototype.onDismiss,this));this.vSave.click($.proxy(_FileEditor.prototype.onSave,this));this.vId.change($.proxy(_FileEditor.prototype.onChangeId,this));$(this._handle).bind({mouseleave:function(s){$(s.currentTarget).removeClass("over")}});this.model.reset(this.getDefaultData());this.redraw(false)},onLoad:function(x,w){var v,u,s=(x!==-1)?w.getDataFor(x):this.getDefaultData();if(w.hasAttributeFor("data-input",x)){v=w.getAttributeFor("data-input",x);u=w.getDataFor(v)}this.model.reset(s,u);this.redraw(false)},onSave:function(s){var u;s.write(this._dump());if((this.model.legacy&&this.model.legacy[2])||(!this.model.legacy&&this.model.name)){u=this.model.legacy?this.model.legacy[2]:this.model.name;s.writeAttribute("data-input",u)}},api:{},methods:{getData:function(){return this.model},_dump:function(){if(this.model.legacy){return(this.model.legacy[1])?this.model.legacy[1]:""}else{return(this.model.url)?this.model.url:""}},redraw:function(v){var w=[[xtiger.bundles.file.noFileIconURL,true,null],[xtiger.bundles.file.saveIconURL,false,xtiger.bundles.file.cancelIconURL],[xtiger.bundles.file.spiningWheelIconURL,false,xtiger.bundles.file.cancelIconURL],[xtiger.bundles.file.errorIconURL,false,xtiger.bundles.file.cancelIconURL],[xtiger.bundles.file.pdfIconURL,false,xtiger.bundles.file.dismissIconURL],[xtiger.bundles.file.pdfIconURL,true,null]];var u;var s=w[this.model.state];var x=i.fr[this.model.state];this.vIcon1.attr("src",s[0]);if((this.model.state===d)||(this.model.state===j)){this.vIcon1.addClass("xt-file-editable")}else{this.vIcon1.removeClass("xt-file-editable")}if(s[1]){u="“"+(this.model.name||"pas de fichier")+"”";this.vTrans.text(u)}else{this.vTrans.text("")}if(this.model.state===m){if(this.getParam("file_gen_name")!=="auto"){this.vId.val(this.model.name);this.onChangeId();this.vId.show()}this.vSave.show()}else{this.vSave.hide();this.vId.hide()}this.vPerm.text(x||"");this.configureHints();if(s[2]){this.vIcon2.attr("src",s[2]);this.vIcon2.removeClass("axel-core-off")}else{this.vIcon2.addClass("axel-core-off")}if((this.model.state===l)&&(v)){xtiger.editor.Repeat.autoSelectRepeatIter(this._handle)}},configureHints:function(){var s,w,v,z,y,A,x,u=q.fr[this.model.state];if(this.model.state===m){u=u[(this.getParam("file_gen_name")==="auto")?0:1]}if(u.indexOf("%")!==-1){s=[];if((this.model.state===m)||(this.model.state===o)){if(this.model.size>1024){x=this.model.size>>10;if(x>1024){A=this.model.size>>20;x=(this.model.size-(A<<20))>>10}else{A=0}v=A>=1?A+"."+x+" MB":x+" KB"}else{v=this.model.size}y=[this.model.name,v,this.vId.val()]}else{if(this.model.state===h){y=[this.model.name,this.model.err]}else{if(this.model.state===l){y=[this.model.name,this.model.genFileURL(),this.model.url]}else{y=[this.model.genFileURL(),this.model.url]}}}z=u.split("%");for(w=0;w<z.length;w++){s.push(z[w]);if(w<y.length){s.push(y[w])}}this.model.hints=s.join("")}else{this.model.hints=u}},update:function(s){this.model.reset(s);this.redraw(true)},onEnterIcon:function(s){$(s.target.parentNode).addClass("over");if(this.model.hints){tooltip=xtiger.factory("tooltipdev").getInstance(this.getDocument());if(tooltip){tooltip.show(this.vIcon1,this.model.hints,(this.model.hints.indexOf("<a")!==-1))}}},onLeaveIcon:function(){tooltip=xtiger.factory("tooltipdev").getInstance(this.getDocument());if(tooltip){tooltip.hide()}},onActivate:function(s){var u;if((this.model.state===d)||(this.model.state===j)){u=xtiger.factory("fileinputsel").getInstance(this.getDocument());if(u){this.onLeaveIcon();u.showFileSelectionDialog(this)}}},doSelectFile:function(s){this.model.gotoSelected(s)},onDismiss:function(s){if(this.model.state===o){this.model.cancelTransmission()}else{if((this.model.state===m)||(this.model.state===h)){this.model.rollback((this.model.state===h))}else{if(this.model.state===l){this.model.gotoReady()}}}},onChangeId:function(){this.vId.val(g(this.vId.val()));this.vId.attr("size",this.vId.val().length+2);this.configureHints();this.vId.blur()},onSave:function(s){this.model.gotoLoading()}}};r.plugin.register("file",{filterable:false,optional:true},{file_URL:"/fileUpload",file_type:"application/pdf",file_gen_name:"auto"},p,e);xtiger.resources.addBundle("file",{noFileIconURL:"nofile32.png",saveIconURL:"save32.png",spiningWheelIconURL:"spiningwheel.gif",errorIconURL:"bug48.png",dismissIconURL:"ok16.png",cancelIconURL:"cancel32.png",pdfIconURL:"pdf32.png"});var n=function(s){this.selector=xtdom.createElement(s,"input");$(this.selector).attr({id:"xt-file-input",type:"file"}).change($.proxy(n.prototype.onChange,this));$("body",s).append(this.selector)};n.prototype={showFileSelectionDialog:function(s){this.delegate=s;this.selector.click()},onChange:function(u){var s=(u.target.files.length>0)?u.target.files[0]:null;var v=this.delegate.getParam("file_type");if(s){if(v.indexOf(s.type)!==-1){if(this.delegate){this.delegate.doSelectFile(s)}}else{alert("Vous devez sélectionner un fichier PDF")}}}};xtiger.registry.registerFactory("fileinputsel",{getInstance:function(u){var s=xtiger.session(u).load("fileinputsel");if(!s){s=new n(u);xtiger.session(u).save("fileinputsel",s)}return s}});var c=function(u){var s=xtdom.createElement(u,"p");$(s).attr("id","xt-tooltip");$("body",u).append(s);this.tooltip=$(s);this.tooltip.mouseleave($.proxy(c.prototype.onLeaveTooltip,this));this.tooltip.mouseenter($.proxy(c.prototype.onEnterTooltip,this));this.doHideCb=$.proxy(c.prototype.doHide,this)};c.prototype={show:function(s,v,u){var x,w;this.tooltip.html(v);x=$(s).offset();w=this.tooltip.height()+$(s).height();this.tooltip.css({left:x.left,top:(x.top-w)}).show();this.isInside=true;this.isSticky=true},hide:function(){this.isInside=false;setTimeout(this.doHideCb,500)},doHide:function(){if(!this.isInside||!this.isSticky){this.tooltip.hide();this.inhibated=true}},onLeaveTooltip:function(s){if(this.isInside&&this.isSticky){this.isInside=false;this.tooltip.hide()}},onEnterTooltip:function(s){this.isInside=true}};xtiger.registry.registerFactory("tooltipdev",{getInstance:function(u){var s=xtiger.session(u).load("tooltipdev");if(!s){s=new c(u);xtiger.session(u).save("tooltipdev",s)}return s}});function b(s){this.state=j;this.url=null;this.name=null;this.file=null;this.delegate=s;this.legacy=null;this.preflighting=false}b.prototype={reset:function(u,s){if(u&&(u.search(/\S/)!==-1)){this.state=j;this.url=u;this.name=s}else{this.state=d;this.url=this.name=null}},genFileURL:function(){var s=this.delegate.getParam("file_base");return(s?s+this.url:this.url)},getPayload:function(){var u,s={"xt-file":this.file};if(this.preflighting){s["xt-file-id"]=this.delegate.vId.val();this.preflighting=false}return s},getPreflightOptions:function(){return{"xt-file-preflight":this.delegate.vId.val()}},rollback:function(s){if(s&&(this.preflighting)){this.state=m}else{if(this.legacy){this.state=this.legacy[0];this.url=this.legacy[1];this.name=this.legacy[2];this.legacy=null}}this.preflighting=false;this.delegate.redraw()},gotoSelected:function(s){this.legacy=[this.state,this.url,this.name];this.state=m;this.url=null;this.name=s.name;this.size=s.size;this.file=s;this.delegate.redraw()},gotoLoading:function(){var s=xtiger.factory("upload").getInstance(this.delegate.curDoc);if(s&&s.isReady()){this.state=o;if(this.preflighting||(this.delegate.getParam("file_gen_name")==="auto")){this.startTransmission(s,s.getUploader())}else{this.preflighting=true;this.startPreflight(s,s.getUploader())}this.delegate.redraw()}else{alert("D'autre(s) téléchargement(s) sont en cours, attendez qu'ils se terminent ou bien annulez en un pour pouvoir démarrer un nouveau téléchargement")}},gotoComplete:function(s){this.legacy=null;this.url=s;this.state=l;this.delegate.redraw(true)},gotoError:function(){this.state=h;this.delegate.redraw()},gotoReady:function(){this.state=j;this.delegate.redraw()},getDocumentId:function(){return xtiger.session(this.delegate.curDoc).load("documentId")},startTransmission:function(s,u){this.transmission=u;this.transmission.setDataType("formdata");this.transmission.setAction(this.delegate.getParam("file_URL"));s.startTransmission(this.transmission,this)},startPreflight:function(s,u){this.transmission=u;this.transmission.setDataType("formdata");this.transmission.setAction(this.delegate.getParam("file_URL"));s.startPreflight(this.transmission,this)},cancelTransmission:function(){if(this.transmission){var s=xtiger.factory("upload").getInstance(this.delegate.curDoc);s.cancelTransmission(this.transmission)}},onComplete:function(s){if(this.preflighting){this.gotoLoading()}else{this.gotoComplete($.trim(s));this.transmission=null}},onError:function(s,u){this.err=s;this.gotoError();this.transmission=null},onCancel:function(){this.preflighting=false;this.transmission=null;if(this.legacy){this.rollback()}else{this.reset();this.delegate.redraw()}}}}($axel));(function($axel){var _Generator=function(aContainer,aXTUse,aDocument){var _h=xtdom.createElement(aDocument,"span");xtdom.addClassName(_h,"axel-core-on");xtdom.addClassName(_h,"axel-core-editable");xtdom.addClassName(_h,"axel-link-handle");_h.appendChild(xtdom.createTextNode(aDocument,""));aContainer.appendChild(_h);return _h};var _Editor={onInit:function(aDefaultData,anOptionAttr,aRepeater){var devname=this.getParam("device")||this.getParam("defaultDevice");if(aDefaultData&&aDefaultData.text&&aDefaultData.url){this._setData(aDefaultData.text,aDefaultData.url)}else{this._setData("empty","http://")}this._device=xtiger.factory(devname).getInstance(this.getDocument())},onAwake:function(){var _this=this;xtdom.addEventListener(this._handle,this.getParam("trigger"),function(ev){_this.startEditing(ev)},true)},onLoad:function(aPoint,aDataSrc){var _default,_url=aDataSrc.getDataFor(aDataSrc.getVectorFor("linkRef",aPoint)),_text=aDataSrc.getDataFor(aDataSrc.getVectorFor("linkText",aPoint));this._setData(_text,_url);if(this.isOptional()){if(_url||_text){this.set()}else{this.unset()}}_default=this.getDefaultData();this.setModified((_text&&_text!==_default.text)||(_url&&_url!==_default.url))},onSave:function(aLogger){if(this.isOptional()&&!this.isSet()){aLogger.discardNodeIfEmpty();return}var _data=this.getData();aLogger.openTag(this.getParam("linkRefTagName"));aLogger.write(_data.url);aLogger.closeTag(this.getParam("linkRefTagName"));aLogger.openTag(this.getParam("linkTextTagName"));aLogger.write(_data.text);aLogger.closeTag(this.getParam("linkTextTagName"))},api:{_parseFromTemplate:function(aXTNode){var tmp;this._param={};xtiger.util.decodeParameters(aXTNode.getAttribute("param"),this._param);tmp=aXTNode.getAttribute("option");this._option=tmp?tmp.toLowerCase():null;var _aXTContent=aXTNode.childNodes;switch(_aXTContent.length){case 2:if(_aXTContent[0].nodeType==xtdom.ELEMENT_NODE&&_aXTContent[1].nodeType==xtdom.ELEMENT_NODE&&_aXTContent[0].nodeName=="linkText"&&_aXTContent[1].nodeName=="linkRef"){this._content={text:_aXTContent[0].nodeValue,url:_aXTContent[1].nodeValue}}break;case 1:if(_aXTContent[0].nodeType==xtdom.ELEMENT_NODE&&(/^a$/i).test(_aXTContent[0].nodeName)){this._content={text:_aXTContent[0].firstChild.nodeValue,url:_aXTContent[0].getAttribute("href")}}else{if(_aXTContent[0].nodeType==xtdom.TEXT_NODE){this._content={text:_aXTContent[0].nodeValue,url:"http://"}}}break;default:this._content={text:this.getParam("defaultText"),url:this.getParam("defaultUrl")}}},isFocusable:function(){return true},focus:function(){this.startEditing(null)},unfocus:function(){this.stopEditing()}},methods:{_setData:function(aText,aUrl){var _default;if(!aText||!aUrl){_default=this.getDefaultData();this._data={text:aText||_default.text,url:aUrl||_default.url}}else{this._data={text:aText,url:aUrl}}this._handle.firstChild.data=this._data.text},getData:function(){return this._data},update:function(aData){if(aData&&(aData.text!==this._data.text||aData.url!==this._data.url)){if(!(aData.text||aData.url)){this.clear(true)}else{this._setData(aData.text,aData.url);this.setModified(true);this.set(true)}}},clear:function(doPropagate){var tmp=this.getDefaultData();this._setData(tmp.text,tmp.url);this.setModified(false);if(this.isOptional()&&this.isSet()){this.unset(doPropagate)}},startEditing:function(aEvent){var _doSelect=aEvent?(!this.isModified()||aEvent.shiftKey):false;this._device.startEditing(this,"linkLensWrapper",_doSelect);if(aEvent){xtdom.stopPropagation(aEvent)}},stopEditing:function(){this._device.stopEditing()}}};$axel.plugin.register("link",{filterable:true,optional:true},{defaultText:"enter link's text here",defaultUrl:"http://",defaultDevice:"lens",wrapper:"togglewrapper",linkRefTagName:"linkRef",linkTextTagName:"linkText",trigger:"click",padding:"10"},_Generator,_Editor);xtiger.resources.addBundle("link",{gotoURL:"goto.png"});var _LinkLensWrapper=function(aDocument){this._handle;this._handleToRestore;this._document=aDocument;this._isFocused=false;this._build()};_LinkLensWrapper.prototype={_build:function(){this._topDiv=xtdom.createElement(this._document,"div");xtdom.addClassName(this._topDiv,"axel-lens-container");xtdom.addClassName(this._topDiv,"axel-lens-containerstyle");this._topDiv.style.display="block";this._upperP=xtdom.createElement(this._document,"p");with(this._upperP){style.margin="0 0 15px 0";style.padding="0px";style.width="100%"}this._anchorInput=xtdom.createElement(this._document,"input");with(this._anchorInput){type="text"}xtdom.addClassName(this._anchorInput,"axel-link-handle");this._upperP.appendChild(this._anchorInput);this._topDiv.appendChild(this._upperP);this._lowerP=xtdom.createElement(this._document,"p");with(this._lowerP){style.margin="0px";style.padding="0px";style.width="100%"}this._urlInput=xtdom.createElement(this._document,"input");with(this._urlInput){style.width="75%"}this._goButtonLink=xtdom.createElement(this._document,"a");with(this._goButtonLink){href="";target="_blank";style.margin="0 10px";style.width="25%"}this._goButton=xtdom.createElement(this._document,"img");with(this._goButton){src=xtiger.bundles.link.gotoURL;style.height="20px";style.width="30px";style.display="inline";style.verticalAlign="bottom"}this._goButtonLink.appendChild(this._goButton);this._lowerP.appendChild(this._urlInput);this._lowerP.appendChild(this._goButtonLink);this._topDiv.appendChild(this._lowerP)},_setData:function(aText,aUrl){if(aText&&typeof(aText)==="string"){this._anchorInput.value=aText}if(aUrl&&typeof(aUrl)==="string"){this._urlInput.value=aUrl;this._goButtonLink.href=aUrl}},getHandle:function(){return this._topDiv},grab:function(aDevice,aDoSelect,aPadding){this._currentDevice=aDevice;var _data=this._currentDevice.getCurrentModel().getData();this._setData(_data.text,_data.url);var _handle=this._currentDevice.getCurrentModel().getHandle();this._topDiv.style.padding=aPadding[0]+"px "+aPadding[1]+"px";var _this=this;xtdom.addEventListener(this._anchorInput,"focus",function(ev){_this.onFocus(ev)},false);xtdom.addEventListener(this._urlInput,"focus",function(ev){_this.onFocus(ev)},false);xtdom.addEventListener(this._anchorInput,"blur",function(ev){_this.onBlur(ev)},false);xtdom.addEventListener(this._urlInput,"blur",function(ev){_this.onBlur(ev)},false);return[aPadding[0],aPadding[1]+4]},activate:function(aDevice,doSelectAll){if(doSelectAll){xtdom.focusAndSelect(this._anchorInput)}else{this._anchorInput.focus()}},release:function(){this._isFocused=false;xtdom.removeElement(this._topDiv);this._currentDevice=null},toggleField:function(){if(this._isFocused){if(this._focusedField==this._anchorInput){this._anchorInput.blur();xtdom.focusAndMoveCaretTo(this._urlInput,this._urlInput.value.length)}else{this._urlInput.blur();xtdom.focusAndMoveCaretTo(this._anchorInput,this._anchorInput.value.length)}}},getData:function(){return{url:this._urlInput.value,text:this._anchorInput.value}},isFocusable:function(){return true},onBlur:function(ev){var _target=xtdom.getEventTarget(ev);if(_target==this._urlInput){this._goButtonLink.href=this._urlInput.value}this._isFocused=false;this._focusedField=null;this._currentDevice.keepAlive(false)},onFocus:function(ev){this._isFocused=true;this._currentDevice.keepAlive(true);this._focusedField=xtdom.getEventTarget(ev)}};xtiger.factory("lens").registerWrapper("linkLensWrapper",function(aDocument){return new _LinkLensWrapper(aDocument)})}($axel));(function($axel){var _Generator=function(aContainer,aXTUse,aDocument){var _width,_height,_img,_tmp,_h=xtdom.createElement(aDocument,"div");xtdom.addClassName(_h,"axel-core-on");xtdom.addClassName(_h,"axel-core-editable");_img=xtdom.createElement(aDocument,"img");_img.src=xtiger.bundles.video.tvIconURL;_h.appendChild(_img);_tmp=xtdom.createElement(aDocument,"div");_tmp.style.visibility="hidden";aDocument.getElementsByTagName("body")[0].appendChild(_tmp);_tmp.appendChild(_h);_width=_img.offsetWidth;_height=_img.offsetHeight;_h.style.width=(_width>2?_width:80)+"px";_h.style.height=(_height>2?_height:80)+"px";aContainer.appendChild(_h);xtdom.removeElement(_tmp);return _h};var _Editor={onInit:function(aDefaultData,anOptionAttr,aRepeater){if(aDefaultData){if(this._isValidUrl(aDefaultData)||this._isCodeSnippet(aDefaultData)){this._setData(aDefaultData)}else{this._data="";this._param.inputFieldMessage=aDefaultData}}var devname=this.getParam("device")||this.getParam("defaultDevice");this._device=xtiger.factory(devname).getInstance(this.getDocument());this._noData=this._handle.firstChild},onAwake:function(){var _this=this;xtdom.addEventListener(this._handle,"mouseover",function(ev){_this.startEditing(ev)},true)},onLoad:function(aPoint,aDataSrc){if(aPoint!==-1){var _value=aDataSrc.getDataFor(aPoint);this._setData(_value)||this.clear();this.set(false)}else{this.clear();this.unset(false)}},onSave:function(aLogger){if(this.isOptional()&&!this.isSet()){aLogger.discardNodeIfEmpty()}if(this._data){aLogger.write(this._data)}},api:{_parseFromTemplate:function(aXTNode){var tmp,_cur,_data;this._param={};xtiger.util.decodeParameters(aXTNode.getAttribute("param"),this._param);tmp=aXTNode.getAttribute("option");this._option=tmp?tmp.toLowerCase():null;_cur=aXTNode.firstChild;while(_cur&&!_data){switch(_cur.nodeType){case xtdom.TEXT_NODE:if((/\w+/).test(_cur.nodeValue)){_data=_cur.nodeValue}break;case xtdom.ELEMENT_NODE:if(_cur.localName="object"){_data=_cur}}_cur=_cur.nextSibling}this._content=_data},isFocusable:function(){return true},focus:function(){this.startEditing(null)},unfocus:function(){this._device.stopEditing()}},methods:{_isValidUrl:function(aInput){var _URL_R=/^(http\:\/\/|~\/|\/)?(\w+:\w+@)?(([-\w\d{1-3}]+\.)+(com|org|net|gov|mil|biz|info|mobi|name|aero|jobs|edu|co\.uk|ac\.uk|it|fr|tv|museum|asia|local|travel|[a-z]{2})?)(?::[\d]{1,5})?(?:(?:(?:\/(?:[-\w~!$+|.,=]|%[a-f\d]{2})+)+|\/)+|\?|#)?(?:(?:[\?&](?:[-\w~!$+|.,*:]|%[a-f\d{2}])+=?(?:[-\w~!$+|.,*:=]|%[a-f\d]{2})*)(?:&(?:[-\w~!$+|.,*:]|%[a-f\d{2}])+=?(?:[-\w~!$+|.,*:=]|%[a-f\d]{2})*)*)*(?:#(?:[-\w~!$+|.,*:=]|%[a-f\d]{2})*)?(?:&)?$/;return _URL_R.test(aInput)},_removeLTSpaces:function(aInput){if(!aInput||aInput==""){return""}return aInput.replace(/^\s+|\s+$/g,"")},_buildYoutubeSnippet:function(aVideoID,aSize,aParams){var _params=aParams?aParams:{};_params.movie=aVideoID;if(!_params.allowFullScreen){_params.allowFullScreen="true"}if(!_params.alloscriptaccess){_params.alloscriptaccess="always"}var _obj=xtdom.createElement(this._document,"object");if(aSize){_obj.height=aSize[0];_obj.width=aSize[1]}else{_obj.height=this.getParam("height");_obj.width=this.getParam("width")}_obj.style.zIndex=1000;for(var _param in _params){var _p=xtdom.createElement(this._document,"param");_p.name=_param;_p.value=_params[_param];_obj.appendChild(_p)}var _embed=xtdom.createElement(this._document,"embed");xtdom.setAttribute(_embed,"src",aVideoID);xtdom.setAttribute(_embed,"type","application/x-shockwave-flash");xtdom.setAttribute(_embed,"allowfullscreen","true");xtdom.setAttribute(_embed,"allowscriptaccess","always");xtdom.setAttribute(_embed,"width",this.getParam("width"));xtdom.setAttribute(_embed,"height",this.getParam("height"));_embed.style.zIndex=1000;if(xtiger.cross.UA.IE){_obj=_embed}else{_obj.appendChild(_embed)}return _obj},_extractVideoId:function(aValidUrl){var _tmp=aValidUrl.match(/^[^&]*/)[0];return _tmp.match(/[^\=\/]*$/)[0]},_isCodeSnippet:function(aInput){var _SNIPPET_O_R=/(<object>).*(<param[^>]*(name\="movie"))/;var _SNIPPET_E_R=/(<embed\s)([^>]+)(\ssrc\=")([^"]+)"/;return _SNIPPET_O_R.test(aInput)||_SNIPPET_E_R.test(aInput)},_setData:function(aData){var _newContent,_tmp,_type="youtube",_tdata=this._removeLTSpaces(aData);if(!this._isValidUrl(_tdata)){if(this._isCodeSnippet(_tdata)){_tdata=this._extractUrlFromSnippet(_tdata)}else{return false}}switch(_type){case"youtube":var _videoID=this._extractVideoId(_tdata);var _newdata="http://www.youtube.com/v/"+_videoID;if(this._data===_newdata){return false}this._data=_newdata;_newdata+="&hl="+this.getParam("lang")+"&fs=1&";_newContent=this._buildYoutubeSnippet(this._data,null,null);try{_tmp=xtdom.createElement(this._document,"div");_tmp.style.visibility="hidden";this._document.getElementsByTagName("body")[0].appendChild(_tmp);_tmp.appendChild(_newContent);with(this._handle.style){width=this.getParam("width")+"px";height=this.getParam("height")+"px"}this._handle.replaceChild(_newContent,this._handle.firstChild);this.setModified(true);xtdom.removeElement(_tmp)}catch(err){xtiger.cross.log("warning",err);return false}break;default:xtiger.cross.log("warning","Video type "+type+" is currently unsupported");return false}return true},update:function(aData){var _success=false;if(aData&&(typeof(aData)=="string")&&(aData.search(/\S/)!=-1)){_success=(aData===this._data)||this._setData(aData)}if(_success){this.set(true)}},clear:function(){this._data="";this.setModified(false);this._handle.replaceChild(this._noData,this._handle.firstChild);var _width=this._noData.offsetWidth;var _height=this._noData.offsetHeight;with(this._handle.style){width=(_width>2?_width:80)+"px";height=(_height>2?_height:80)+"px"}},getData:function(){if(this._data&&this._data!==""){return this._data}else{return null}},startEditing:function(aEvent){var _doSelect=aEvent?(!this.isModified()||aEvent.shiftKey):false;this._device.startEditing(this,"videoLensWrapper",_doSelect)},stopEditing:function(){this._device.stopEditing()}}};$axel.plugin.register("video",{filterable:true,optional:true},{defaultDevice:"lens",trigger:"mouseover",lang:"fr_FR",inputFieldMessage:"Paste the video's link here",width:425,height:344},_Generator,_Editor);xtiger.resources.addBundle("video",{tvIconURL:"tv.png"});var _VideoLensWrapper=function(aDocument){this._handle;this._handleToRestore;this._document=aDocument;this._isFocused=false;this._loaded=false;this.build()};_VideoLensWrapper.prototype={build:function(){this._topdiv=xtdom.createElement(this._document,"div");xtdom.addClassName(this._topdiv,"axel-lens-container");with(this._topdiv){style.display="none";style.minWidth="200px"}var _innerHTML="";_innerHTML+='<div style="background: none; position: relative"> </div>';_innerHTML+='<div class="axel-lens-containerstyle" style="width: 410px; padding: 5px; position: relative">';_innerHTML+='<p style="';_innerHTML+="display: none; font-size: 7pt; cursor: pointer; ";_innerHTML+="text-decoration:underline; text-align: right; margin: 0;";_innerHTML+='">delete</p>';_innerHTML+="<div>";_innerHTML+='<label for="videolensinput" style="display: block">Paste url here</label>';_innerHTML+='<input type="text" name="videolensinput" value="" style="width: 90%"></input>';_innerHTML+="</div>";_innerHTML+='<div style="text-align: center">';_innerHTML+="<button>Cancel</button>";_innerHTML+="<button>Save</button>";_innerHTML+="</div></div>";this._topdiv.innerHTML=_innerHTML;this._maskdiv=this._topdiv.firstChild;this._contentdiv=this._maskdiv.nextSibling;this._deletespan=this._contentdiv.firstChild;this._inputdiv=this._deletespan.nextSibling;this._input=this._inputdiv.firstChild.nextSibling;this._buttondiv=this._inputdiv.nextSibling;this._cancelbutton=this._buttondiv.firstChild;this._savebutton=this._buttondiv.firstChild.nextSibling;var _this=this;this._handlers={clearModel:[this._deletespan,"click",function(ev){_this.clearModel()}],onInputBlur:[this._input,"blur",function(ev){_this._onInputBlur(ev)}],onInputFocus:[this._input,"focus",function(ev){_this._onInputFocus(ev)}],onInputKeyDown:[this._input,"keydown",function(ev){_this._onInputKeyDown(ev)}],onInputKeyUp:[this._input,"keyup",function(ev){_this._onInputKeyUp(ev)}],onCancel:[this._cancelbutton,"click",function(ev){_this._onCancel(ev)}],onSave:[this._savebutton,"click",function(ev){_this._onSave(ev)}]}},grab:function(aDevice,aDoSelect,aPadding){if(this._currentDevice){this.release()}this._currentDevice=aDevice;var _handle=this._currentDevice.getCurrentModel().getHandle();_pad=(aPadding[0]>=10)?aPadding[0]:10;var _width=_handle.offsetWidth;var _height=_handle.offsetHeight;if(xtiger.cross.UA.IE){_width+=2*_pad;_height+=2*_pad}with(this._topdiv.style){display="block";width=_width+"px";padding=_pad+"px"}with(this._maskdiv.style){border=""+_pad+"px solid rgb(115, 166, 42)";width=_width+"px";height=_height+"px";if(!xtiger.cross.UA.IE){left="-"+_pad+"px";top="-"+_pad+"px"}}with(this._contentdiv.style){if(!xtiger.cross.UA.IE){left="-"+_pad+"px";top="-"+_pad+"px"}}this._cancelbutton.disabled=false;this._savebutton.disabled=true;if(this._currentDevice.getCurrentModel().isModified()){this.setData(this._currentDevice.getCurrentModel().getData());this._deletespan.style.display="block";this._loaded=true}else{var _message=this._currentDevice.getCurrentModel().getParam("inputFieldMessage");this.setData(_message);this._loaded=false}for(var k in this._handlers){xtdom.addEventListener(this._handlers[k][0],this._handlers[k][1],this._handlers[k][2],true)}},activate:function(aDevice,doSelectAll){},release:function(){if(!this._currentDevice){return}for(var k in this._handlers){xtdom.removeEventListener(this._handlers[k][0],this._handlers[k][1],this._handlers[k][2],true)}this._deletespan.style.display="none";this._currentDevice=null;xtdom.removeElement(this._topdiv)},getHandle:function(){return this._topdiv},getData:function(){return this._input.value},setData:function(aData){this._input.value=(aData&&typeof(aData)=="string")?aData:""},isFocusable:function(){return true},clearModel:function(){if(this._currentDevice){this._input.value="";this._currentDevice.getCurrentModel().clear();this._currentDevice.keepAlive(false);this._currentDevice.getCurrentModel().unfocus()}},toggleField:function(){},_onInputBlur:function(ev){this._currentDevice.keepAlive(false)},_onInputFocus:function(ev){if(this._loaded){var _aStartPos=0;var _aEndPos=this._input.value.length;if(this._input.setSelectionRange){this._input.setSelectionRange(_aStartPos,_aEndPos)}else{if(this._input.createTextRange){var oRange=this._input.createTextRange();oRange.moveStart("character",_aStartPos);oRange.moveEnd("character",_aEndPos);oRange.select()}}}else{this._input.value=""}this._currentDevice.keepAlive(true)},_onInputKeyDown:function(ev){this._savedValue=this._input.value},_onInputKeyUp:function(ev){if(this._input.value!=this._savedValue){this._cancelbutton.disabled=false;this._savebutton.disabled=false}},_onCancel:function(ev){if(!this._currentDevice){return}this._currentDevice.cancelEditing();xtdom.stopPropagation(ev)},_onSave:function(ev){if(!this._currentDevice){return}this._currentDevice.stopEditing();xtdom.stopPropagation(ev)}};xtiger.factory("lens").registerWrapper("videoLensWrapper",function(aDocument){return new _VideoLensWrapper(aDocument)})}($axel));(function(b){var c={"->":{update:"__evt__update"},update:function(d){this.__evt__update(d);$(this.getHandle()).trigger("axel-update",this)}};b.filter.register("event",c);b.filter.applyTo({event:"text"})}($axel));(function(b){var c={"->":{onSave:"__opt__onSave"},onSave:function(d){if(this.isModified()){this.__opt__onSave(d)}else{d.discardNodeIfEmpty()}}};b.filter.register("optional",c);b.filter.applyTo({optional:"text"})}($axel));(function(n){var j=function j(s,p,r){var o="trackerdevice";var q=xtiger.session(s).load(o);if((!q)&&(!r)){q=new xtiger.editor.TrackerMenu(s,[{zoomout:["---",p.zoomOut],zoomin:["+++",p.zoomIn]}]);xtiger.session(s).save(o,q)}return q};function i(q,v,o,p){var s=q.getHandle(),r=q.getParam("base"),u=xtdom.createElement(q.getDocument(),"img");if(q.image_resizable){$("img",s).unbind("mouseenter")}xtdom.removeChildrenOf(s);if((o!==undefined)||(p!==undefined)){$(u).one("load",[s,o,p],c)}xtdom.setAttribute(u,"src",r?r+v:v);xtdom.setAttribute(u,"alt","image "+v);s.appendChild(u);if(q.image_maxWidth!==undefined){$(u).css("max-width",q.image_maxWidth)}if(q.image_maxHeight!==undefined){$(u).css("max-height",q.image_maxHeight)}if(q.image_resizable){$(u).bind("mouseenter",q,b)}}function c(q){var r=q.data[0],s=$("img",r),o=q.data[1],p=q.data[2];if(o&&(!isNaN(o))&&(o>0)){s.width(o)}if(p&&(!isNaN(p))&&(p>0)){s.height(p)}$(r).width(s.width())}function h(q){var o;var p=q.getHandle();var r=q.getParam("base");var s=p.firstChild;if(s.nodeType!==xtdom.TEXT_NODE){o=s.getAttribute("src")}else{o=s.data}return(r&&(o.indexOf(r)!==-1))?o.substr(r.length,o.length):o}function d(q){var o,p=undefined;if((typeof q)==="string"){o=q.match(/\d+/);if(o){p=parseInt(o[0])}}return p}function m(o){var p;if(o.dataTransfer.types.contains){p=o.dataTransfer.types.contains("text/uri-list")}else{p=($.inArray("text/uri-list",o.dataTransfer.types)!==-1)}if(p){o.dataTransfer.dropEffect=xtiger.cross.UA.webKit?"copy":"link";xtdom.preventDefault(o);xtdom.stopPropagation(o)}}function l(o){o.dataTransfer.dropEffect=xtiger.cross.UA.webKit?"copy":"link";xtdom.preventDefault(o);xtdom.stopPropagation(o)}function g(q){var r=false;var o=q.target.xttPrimitiveEditor||q.target.parentNode.xttPrimitiveEditor;if(o){var p=q.dataTransfer.getData("URL");if(!p){p=q.dataTransfer.getData("text/plain")}if(p&&(p.search(/(png|jpg|jpeg|gif)$/i)!==-1)){o.update(p)}else{xtiger.cross.log("warning","Not a supported image link (must end with png, jpg, jpeg or gif) !\n")}}xtdom.stopPropagation(q);xtdom.preventDefault(q)}function b(v){var o,s,u={},r;var p=v.data,q=j(p.getDocument(),p);if(!q.isTracking()){o=$(this).width();s=$(this).height();if(p.image_minWidth&&p.image_minHeight){u.zoomout=(o>p.image_minWidth)&&(s>p.image_minHeight)}else{if(p.image_minWidth){u.zoomout=(o>p.image_minWidth)}else{if(p.image_minHeight){u.zoomout=(s>p.image_minHeight)}else{u.zoomout=false}}}if(p.image_maxWidth&&p.image_maxHeight){u.zoomin=(o<p.image_maxWidth)&&(s<p.image_maxHeight)}else{if(p.image_maxWidth){u.zoomin=(o<p.image_maxWidth)}else{if(p.image_maxHeight){u.zoomin=(s<p.image_maxHeight)}else{u.zoomin=false}}}q.startEditing(p,this,u)}else{xtiger.cross.log("debug","[Image filter] avoiding reentrant MouseEnter call")}}var e={"->":{onAwake:"__img__onAwake",onLoad:"__img__onLoad",update:"__img__update",_setData:"__img__setData",startEditing:"__img__startEditing"},onAwake:function(){var p;this.__img__onAwake();var o=this.getHandle();xtdom.addEventListener(o,"dragenter",m,false);xtdom.addEventListener(o,"dragover",l,false);xtdom.addEventListener(o,"drop",g,true);this.image_maxWidth=d(this.getParam("image_maxwidth"));this.image_maxHeight=d(this.getParam("image_maxheight"));this.image_minWidth=d(this.getParam("image_minwidth"));this.image_minHeight=d(this.getParam("image_minheight"));this.image_resizable=this.image_maxWidth||this.image_maxHeight||this.image_minWidth||this.image_minHeight;xtiger.cross.log("debug","[Image filter] awake maxW="+this.image_maxWidth+" minW="+this.image_minWidth+"maxH="+this.image_maxHeight+" minH="+this.image_minHeight)},onLoad:function(o,q){var u,s=this.getParam("image-tag")||"Source",p,r;var v=o[0];if(this.getParam("image_lang")==="html"){v=o[1];s="src"}if(v&&xtdom.hasAttribute(v,s)){u=v.getAttribute(s)}if((!u)||(u.search(/(png|jpg|jpeg|gif)$/i)===-1)){this.__img__onLoad(o,q)}else{if(this.image_resizable){p=parseInt(v.getAttribute("width"));r=parseInt(v.getAttribute("height"));i(this,u,p,r)}else{i(this,u)}this._data=u;this.setModified(true);this.set(false)}},onSave:function(p){var u=h(this),q=(this.getParam("image_lang")==="html"),s=this.getParam("image-tag")||"Source",r,o;if(q){p.openTag("img");s="src"}p.openAttribute(s);p.write(u);p.closeAttribute(s);if(this.image_resizable){r=this.getHandle();o=$("img",r);if(o){p.openAttribute("width");p.write($(o).width());p.closeAttribute("width");p.openAttribute("height");p.write($(o).height());p.closeAttribute("height")}}if(q){p.closeTag("img")}},getData:function(){return h(this)},_setData:function(o){if(o.search&&(o.search(/(png|jpg|jpeg|gif)$/i)!==-1)){i(this,o);this._data=o}else{var q=this.getHandle();if(q.firstChild.nodeType!==xtdom.TEXT_NODE){xtdom.removeChildrenOf(q);var p=xtdom.createTextNode(this.getDocument(),"");q.appendChild(p)}this.__img__setData(o)}},update:function(o){if((o.search(/\S/)!==-1)&&(o!==this.getDefaultData())&&(o.search(/(png|jpg|jpeg|gif)$/i)===-1)){this.__img__update("Not a supported image file (must end with png, jpg, jpeg or gif)")}else{this.__img__update(o)}},startEditing:function(o){var p;if(this.image_resizable){p=j(this.getDocument(),this,true);if(p){p.stopEditing()}}this.__img__startEditing(o)},zoomIn:function(){var r=this.getHandle(),v=$("img",r),o,q,u,p,s;if(v.size()>0){o=v.width();q=v.height();u=this.image_maxWidth?this.image_maxWidth/o:undefined;p=this.image_maxHeight?this.image_maxHeight/q:undefined;s=u?(p?(p>u?u:p):u):p;if(s){if(s>1){if(s>1.1){s=1.1}else{j(this.getDocument(),this,true).disable("zoomin")}v.width(o*s).height(q*s);$(r).width(o*s).height(q*s);j(this.getDocument(),this,true).enable("zoomout")}else{j(this.getDocument(),this,true).disable("zoomin")}}}},zoomOut:function(){var r=this.getHandle(),v=$("img",r),o,q,u,p,s;if(v.size()>0){o=v.width();q=v.height();u=this.image_minWidth?this.image_minWidth/o:undefined;p=this.image_minHeight?this.image_minHeight/q:undefined;s=u?(p?(p>u?p:u):u):p;if(s){if(s<1){if(s<0.9){s=0.9}else{j(this.getDocument(),this,true).disable("zoomout")}v.width(o*s).height(q*s);$(r).width(o*s).height(q*s);j(this.getDocument(),this,true).enable("zoomin")}else{j(this.getDocument(),this,true).disable("zoomout")}}}}};n.filter.register("image",e);n.filter.applyTo({image:"text"})}($axel));(function(g){var w="\\*|'|_";var z=new RegExp("(http://[\\.\\w/\\-\\?\\=_&;#]*)\\[([^\\]]*)\\]|("+w+"){2}(.*?)\\3{2}|(#[\\.\\w/\\-_]*)\\[([^\\]]*)\\]|==(.*?)==\\((.*?)\\)","g");var i=new RegExp("^(mailto|http|https):?(//)?","i");var c=new RegExp("^(\\w+\\.)+[a-z]+(.*?)$","i");var H={important:"strong",emphasize:"em",verbatim:"tt"};var x={strong:"important",em:"emphasize",tt:"verbatim",STRONG:"important",EM:"verbatim",TT:"verbatim"};var y={"*":"strong",_:"em","'":"tt"};var v={"*":"important",_:"emphasize","'":"verbatim"};var n={strong:"**",em:"__",tt:"''",STRONG:"**",EM:"__",TT:"''"};var m={important:"**",emphasize:"__",verbatim:"''"};var q=function q(I){return I};var d=function d(K,L){var J,P,M,O,N;var I=i.exec(K);if(I){if(I[0].length==K.length){if(I[1].toLowerCase()=="mailto"){J=K+((K.indexOf(":")!=-1)?"":":")+L}else{J=K+((K.indexOf(":")!=-1)?"//":"://")+L}P=I[1]}else{J=K}}else{if(K.charAt(0)=="/"){J=q(K);M=true;P=K}else{if(K.indexOf("@")!=-1){J="mailto:"+K;P=K}else{if(c.test(K)){J="http://"+K;P=K}else{J=q(K);M=true;P=K}}}}O=P?"data-input ='"+P+"' ":"";N=M?"data-rewritten ='1' ":"";return"<a href='"+J+"' "+O+N+"target='_blank'>"+L+"</a>"};var F=function F(R,J,N,O,I,S,Q,P,M,L){var V,T,K,U;if(J){return d(J,N)}else{if(S){return d(S,Q)}else{if(M){return d(M,P)}else{if(O){if(L!=="span"){V=y[O];return"<"+V+">"+I+"</"+V+">"}else{T=v[O];return'<span class="'+T+'">'+I+"</span>"}}}}}};var A=function(I){return function(Q,K,M,N,J,R,P,O,L){return F(Q,K,M,N,J,R,P,O,L,I)}};var j=function j(I){var K=[];var M=I.childNodes;var J,L;for(J=0;J<M.length;J++){L=M.item(J);if(L.nodeType==xtdom.ELEMENT_NODE){K.push(L)}}return K};var B=function B(J,K,I){if(K&&(K.search(/\S/)!=-1)){if(J.lastChild&&(J.lastChild.nodeType===xtdom.TEXT_NODE)){J.lastChild.appendData(K)}else{J.appendChild(xtdom.createTextNode(I,K))}}};var r=function r(K,J,L,I){var O,P,Q,M,N=K;if(I==="default"){P=J.getAttribute("FragmentKind"),Q=P?H[P]:undefined}else{Q=xtdom.getLocalName(J)}M=J.firstChild?J.firstChild.nodeValue:undefined;if(Q){O=xtdom.createElement(L,Q);N.appendChild(O);N=O;if((I==="span")&&xtdom.hasAttribute(J,"class")){xtdom.addClassName(O,J.getAttribute("class"))}}B(N,M,L)};var u=function u(M,Q,N,K){var R,J,L;if(K!=="default"){R=Q;J=Q.getAttribute("href");L=xtdom.hasAttribute(Q,"data-input")?Q.getAttribute("data-input"):null}else{var S=j(Q);var I=xtdom.getLocalName(S[0]);var U=0,V=0;if(I==="LinkText"){V=1}else{U=1}R=S[U];J=S[V].firstChild?S[V].firstChild.nodeValue:"...";L=xtdom.hasAttribute(S[V],"data-input")?S[V].getAttribute("data-input"):null}var T=xtdom.createElement(N,"a");var P=R.firstChild?R.firstChild.nodeValue:"...";var O=xtdom.createTextNode(N,P);T.appendChild(O);T.setAttribute("href",J);if(L){T.setAttribute("data-input",L)}M.appendChild(T)};var h=function h(O,N,I,M){var J,K,L=N.firstChild;while(L){if(L.nodeType===xtdom.ELEMENT_NODE){J=xtdom.getLocalName(L);if((J==="Link")||(J==="a")||(J==="A")){u(O,L,I,M)}else{r(O,L,I,M)}}else{if(M==="html"){if(L===N.firstChild){K=L.nodeValue.replace(/^\s+/g,"")}else{if(L.nextSibling){K=L.nodeValue}else{K=L.nodeValue.replace(/\s+$/g,"")}}B(O,K,I)}}L=L.nextSibling}};var D=function D(J){var I="popupdevice";var K=xtiger.session(J).load(I);if(!K){K=new xtiger.editor.PopupDevice(J);xtiger.session(J).save(I,K)}return K};var p=function p(J,I){var L,K;var M=J.firstChild;while(M){K=M.nextSibling;if(M.nodeType==xtdom.TEXT_NODE){L=xtdom.createElement(I,"span");J.replaceChild(L,M);L.appendChild(M)}M=K}};var b={"->":{onLoad:"_wiki__onLoad",startEditing:"_wiki__startEditing"},onLoad:function o(K,J){if(J.isEmpty(K)){this._wiki__onLoad(K,J)}else{var I=this.getHandle();xtdom.removeChildrenOf(I);h(I,K[0],this.getDocument(),this.getParam("wiki_lang")||"default");this.setModified(true);this.set(false)}},onSave:function C(I){var J;if(this.isOptional()&&!this._isOptionSet){I.discardNodeIfEmpty();return}J=this.getParam("wiki_lang")||"default";if(J==="html"){I.allowMixedContent()}return(J==="default")?this._saveHandleAsFragment(I):this._saveHandleAsIs(I)},_setData:function e(I){var J=this.getParam("wiki_lang")||"default";try{this.getHandle().innerHTML=xtiger.util.encodeEntities(I).replace(z,A(J));if(J=="span"){p(this.getHandle(),this.getDocument())}}catch(K){xtiger.cross.log("error","Exception "+K.name+"\n"+K.message);try{this.getHandle().innerHTML=xtiger.util.encodeEntities(I)+" (Exception : "+K.name+" - "+K.message+")"}catch(K){}}},_saveHandleAsIs:function(J){var N,M,L,I,K;var O=this.getHandle().firstChild;while(O){if(O.nodeType==xtdom.ELEMENT_NODE){if(O.firstChild){N=xtdom.getLocalName(O);J.openTag(N);if((N=="a")||(N=="A")){if(O.getAttribute("data-rewritten")){L=O.getAttribute("data-input")||"..."}else{L=O.getAttribute("href")||"..."}J.openAttribute("href");J.write(L);J.closeAttribute("href")}if(xtdom.hasAttribute(O,"data-input")&&!(xtdom.hasAttribute(O,"data-rewritten"))){J.openAttribute("data-input");J.write(O.getAttribute("data-input"));J.closeAttribute("data-input")}if(xtdom.hasAttribute(O,"class")){J.openAttribute("class");J.write(O.getAttribute("class"));J.closeAttribute("class")}J.write(O.firstChild.data);J.closeTag(N)}}else{if(O.data&&(O.data.search(/\S/)!=-1)){J.write(O.data)}}O=O.nextSibling}},_saveHandleAsFragment:function(J,O){var M,L,K,I;var N=this.getHandle().firstChild;while(N){if(N.nodeType==xtdom.ELEMENT_NODE){M=xtdom.getLocalName(N);I=x[M];if(I){if(N.firstChild){J.openTag("Fragment");J.openAttribute("FragmentKind");J.write(I);J.closeAttribute("FragmentKind");J.write(N.firstChild.data);J.closeTag("Fragment")}}else{if((M=="a")||(M=="A")){L=(N.firstChild)?N.firstChild.data:"...";if(xtdom.hasAttribute(N,"data-rewritten")){K=N.getAttribute("data-input")||"..."}else{K=N.getAttribute("href")||"..."}J.openTag("Link");if(O=="html"){J.write(L);J.openAttribute("href");J.write(K);J.closeAttribute("href")}else{J.openTag("LinkText");J.write(L);J.closeTag("LinkText");J.openTag("LinkRef");if(xtdom.hasAttribute(N,"data-input")&&!(xtdom.hasAttribute(N,"data-rewritten"))){J.openAttribute("data-input");J.write(N.getAttribute("data-input"));J.closeAttribute("data-input")}J.write(K);J.closeTag("LinkRef")}J.closeTag("Link")}else{J.openTag(M);J.write(N.firstChild.data);J.closeTag(M)}}}else{if(N.data&&(N.data.search(/\S/)!=-1)){J.openTag("Fragment");J.write(N.data);J.closeTag("Fragment")}}N=N.nextSibling}},getData:function s(){var L,K,J;var I="";var M=this.getHandle().firstChild;while(M){if(M.nodeType==xtdom.ELEMENT_NODE){if(this.getParam("wiki_lang")==="span"){L=M.getAttribute("class");K=L?m[L]:undefined;L=xtdom.getLocalName(M)}else{L=xtdom.getLocalName(M);K=n[L]}if((L==="a")||(L==="A")){J=M.getAttribute("data-input")||M.getAttribute("href")||"...";I+="=="+(M.firstChild?M.firstChild.data:"...")+"==("+J+")"}else{if(M.firstChild){if(K===undefined){I+=M.firstChild.data}else{I+=K+M.firstChild.data+K}}}}else{I+=M.data}M=M.nextSibling}return I},startEditing:function G(L,M){if(L){var K=xtdom.getEventTarget(L);var J=xtdom.getLocalName(K);if(/^a$/i.test(J)){xtdom.preventDefault(L);xtdom.stopPropagation(L);var I=D(this.getDocument());this._url=K.getAttribute("href");if((!this._url)||(this._url=="")){this._url=K.getAttribute("HREF")}I.startEditing(this,["edit","open"],"edit",K);return}}this._wiki__startEditing(L,M)},onMenuSelection:function E(I){if(I=="edit"){this._wiki__startEditing()}else{if(I=="open"){window.open(this._url)}}},setSelectionState:function l(I){return I?this.set():this.unset()}};g.filter.register("wiki",b);g.filter.applyTo({wiki:"text"})}($axel));(function(c){var i="fr";var h="ISO_8601";var g={fr:{closeText:"Fermer",prevText:"Précédent",nextText:"Suivant",currentText:"Aujourd'hui",monthNames:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],monthNamesShort:["Janv.","Févr.","Mars","Avril","Mai","Juin","Juil.","Août","Sept.","Oct.","Nov.","Déc."],dayNames:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],dayNamesShort:["Dim.","Lun.","Mar.","Mer.","Jeu.","Ven.","Sam."],dayNamesMin:["D","L","M","M","J","V","S"],weekHeader:"Sem.",dateFormat:"dd/mm/yy",firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:""}};var b=function(p,l,q,m){var j=p.getParam(q)||i;var o=p.getParam(m)||h;if(q==="date_region"){j=g[j]?g[j].dateFormat:$.datepicker.regional[""].dateFormat;o=$.datepicker[o]}if(m==="date_region"){j=$.datepicker[j];o=g[o]?g[o].dateFormat:$.datepicker.regional[""].dateFormat}var n=null;try{n=$.datepicker.formatDate(o,$.datepicker.parseDate(j,l))}catch(r){n=l}return n};var d=function(j){var l=this;this.handle=xtdom.createElement(j,"input");xtdom.setAttribute(this.handle,"id","xt-date-datepicker");xtdom.setAttribute(this.handle,"size",10);$("body",j).append(this.handle);this.jhandle=$("body > #xt-date-datepicker",j);this.jhandle.datepicker().datepicker("option","onClose",function(){l.onClose()});this.myDoc=j;this.cache={}};d.prototype={grab:function(o,j){var l,n,p=o.getParam("date_region")||i;$.datepicker.setDefaults((p==="fr")?g.fr:$.datepicker.regional[""]);this.jhandle.val(o.getData());this.editorHandle=o.getHandle();this.model=o;n=xtdom.getLocalName(this.editorHandle);if(!this.cache[n]){this.hook=xtdom.createElement(this.myDoc,n);this.cache[n]=this.hook}else{this.hook=this.cache[n]}l=o.getParam("minDate");this.jhandle.datepicker("option","minDate",l||null);l=o.getParam("maxDate");this.jhandle.datepicker("option","maxDate",l||null);l=o.getParam("beforeShow");if(l){this.jhandle.datepicker("option","beforeShow",l)}else{this.jhandle.datepicker("option","beforeShow",l)}var m=this.editorHandle.parentNode;if(this.hook.firstChild!=this.handle){this.hook.appendChild(this.handle)}m.insertBefore(this.hook,this.editorHandle,true);m.removeChild(this.editorHandle);if(j){xtdom.focusAndSelect(this.handle)}else{this.jhandle.datepicker("show")}this.closingInProgress=false},release:function(j){var l=this.hook.parentNode;l.insertBefore(this.editorHandle,this.hook,true);l.removeChild(this.hook);if(!j){this.model.update(this.jhandle.val())}if(!this.closingInProgress){this.closingInProgress=true;this.jhandle.datepicker("hide")}},onClose:function(){if(!this.closingInProgress){this.release()}}};xtiger.registry.registerFactory("datepickerdev",{getInstance:function(l){var j=xtiger.session(l).load("datepickerdev");if(!j){j=new d(l);xtiger.session(l).save("datepickerdev",j)}return j}});var e={"->":{onLoad:"__dpkr_onLoad",onSave:"__dpkr_onSave"},onLoad:function(l,j){this.__dpkr_onLoad(l,j);this._setData(b(this,this._data,"date_format","date_region"))},onSave:function(j){var l=this._data;this._data=b(this,l,"date_region","date_format");this.__dpkr_onSave(j);this._data=l},startEditing:function(m){var j=m?(!this.isModified()||m.shiftKey):false;var l=xtiger.factory("datepickerdev").getInstance(this.getDocument());l.grab(this,j)},stopEditing:function(l){var j=xtiger.factory("datepickerdev").getInstance(this.getDocument());j.release(l)},configure:function(j,l){if((l===undefined)||(((j==="minDate")||(j==="maxDate"))&&isNaN(new Date(l).getDay()))){delete this._param[j]}else{this._param[j]=l}}};c.filter.register("date",e);c.filter.applyTo({date:"text"})}($axel));